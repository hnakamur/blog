<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.84.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>d3.jsを使ったツールチップあり複数折れ線グラフのサンプルを作った &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53263855-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53263855-1');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2021. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>d3.jsを使ったツールチップあり複数折れ線グラフのサンプルを作った</h1>
  <time datetime=2013-03-02T00:00:00Z class="post-date">2013-03-02</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#x軸のラベルを回転">X軸のラベルを回転</a></li>
    <li><a href="#ツールチップを出す">ツールチップを出す</a></li>
    <li><a href="#線のデータ補完を止める">線のデータ補完を止める</a></li>
  </ul>
</nav>
  <p><a href="http://d3js.org/">D3.js - Data-Driven Documents</a>を使ってツールチップあり複数折れ線グラフのサンプルを作ったのでメモ。</p>
<p><!-- raw HTML omitted -->サンプル<!-- raw HTML omitted --></p>
<p><a href="http://bl.ocks.org/mbostock/3884955">Multi-Series Line Chart</a>のサンプルをベースに改良しました。</p>
<h2 id="x軸のラベルを回転">X軸のラベルを回転</h2>
<p><a href="http://www.d3noob.org/2013/01/how-to-rotate-text-labels-for-x-axis-of.html">D3.js Tips and Tricks: How to rotate the text labels for the x Axis of a d3.js graph</a>を参考にして回転させました。</p>
<pre><code>  svg.append(&quot;g&quot;)
      .attr(&quot;class&quot;, &quot;x axis&quot;)
      .attr(&quot;transform&quot;, &quot;translate(0,&quot; + height + &quot;)&quot;)
      .call(xAxis)
      .selectAll(&quot;text&quot;)
        .style(&quot;text-anchor&quot;, &quot;end&quot;)
        .attr(&quot;dx&quot;, &quot;-.8em&quot;)
        .attr(&quot;dy&quot;, &quot;-.6em&quot;)
        .attr(&quot;transform&quot;, &quot;rotate(-90)&quot;);
</code></pre><h2 id="ツールチップを出す">ツールチップを出す</h2>
<p><a href="https://gist.github.com/biovisualize/1016860#gistcomment-61316">Simple D3 tooltip</a>の手法で、線でもツールチップは出せなくはないのですが、カーソル位置のデータが取れないので、データの点に円を作成することにしました。</p>
<p><a href="https://groups.google.com/forum/?fromgroups=#!topic/d3-js/8XLzUYLoFnY">multi-line chart with circle points - Google グループ</a>を参考に以下の様なコードで円を作成しました。</p>
<p>ツールチップを出す部分は<a href="https://gist.github.com/biovisualize/1016860#gistcomment-61316">Simple D3 tooltip</a>を参考にしました。元のコードではイベントを<code>event</code>で参照していましたが、ChromeとSafariでは動くもののFirefoxではundefinedになっていました。<a href="https://github.com/mbostock/d3/wiki/Selections#wiki-on">Selections · mbostock/d3 Wiki</a>を見ると、<code>d3.event</code>で参照するのが正しいので修正しました。</p>
<pre><code> city. selectAll(&quot;circle&quot;)
      .data(function(d) { return d.values.map(function(v) {
              return {date: v.date, temperature: v.temperature, name: d.name};
            }); })
    .enter().append(&quot;circle&quot;)
      .attr(&quot;cx&quot;, function(d, i) { return x(d.date); })
      .attr(&quot;cy&quot;, function(d, i) { return y(d.temperature); })
      .style(&quot;fill&quot;, function(d) { return color(d.name); })
      .attr(&quot;r&quot;, 1)
      .on(&quot;mouseover&quot;, function(){
        return tooltip.style(&quot;visibility&quot;, &quot;visible&quot;);
      })
      .on(&quot;mousemove&quot;, function(d){
        return tooltip
          .style(&quot;top&quot;, (d3.event.pageY-10)+&quot;px&quot;)
          .style(&quot;left&quot;,(d3.event.pageX+10)+&quot;px&quot;)
          .html(&quot;&lt;dl&gt;&lt;dt&gt;date&lt;/dt&gt;&lt;dd&gt;&quot; + d3.time.format(&quot;%Y-%m-%d&quot;)(d.date) + &quot;&lt;/dd&gt;&lt;dt&gt;temperature&lt;/dt&gt;&lt;dd&gt;&quot; + d.temperature + &quot;&lt;/dd&gt;&lt;dt&gt;name&lt;/dt&gt;&lt;dd&gt;&quot; + d.name + &quot;&lt;/dd&gt;&lt;/dl&gt;&quot;);
      })
      .on(&quot;mouseout&quot;, function(){
        return tooltip.style(&quot;visibility&quot;, &quot;hidden&quot;);
      });
</code></pre><p>見た目がうるさくないように円の半径は1とし、線だけ見えるような感じにしています。すると点にカーソルでポイントするのが大変なので、太めのストロークを透明色で指定して、ポイントしやすくしています。</p>
<pre><code>.tooltip {
  border: 1px solid black;
  background-color: white;
  padding: 5px 8px 4px 8px;
  border-radius: 4px;
  -moz-border-radius: 4px;
  -webkit-border-radius: 4px;
}
</code></pre><h2 id="線のデータ補完を止める">線のデータ補完を止める</h2>
<p>データ補完してしまうと、線とデータ点がずれてしまうので、補完は止めます。
interpolate()を呼ばなければOK。</p>
<pre><code>var line = d3.svg.line()
    //.interpolate(&quot;basis&quot;)
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.temperature); });
</code></pre>
</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-53263855-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
