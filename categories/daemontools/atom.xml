<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: daemontools | hnakamur's blog at github]]></title>
  <link href="http://hnakamur.github.com/blog/categories/daemontools/atom.xml" rel="self"/>
  <link href="http://hnakamur.github.com/blog/"/>
  <updated>2013-09-02T00:47:05+09:00</updated>
  <id>http://hnakamur.github.com/blog/</id>
  <author>
    <name><![CDATA[Hiroaki Nakamura]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[daemontoolsの使い方]]></title>
    <link href="http://hnakamur.github.com/blog/2012/06/21/how-to-use-daemontools/"/>
    <updated>2012-06-21T17:48:00+09:00</updated>
    <id>http://hnakamur.github.com/blog/2012/06/21/how-to-use-daemontools</id>
    <content type="html"><![CDATA[<p><a href="http://www.nslabs.jp/daemontools.rhtml">daemontoolsを使う | Netsphere Laboratories</a>を参考にしました。ありがとうございます。</p>

<h2>私的ルール</h2>

<h3>無効化したサービスは/service/.disabled/に移動</h3>

<p>/service/以下に.で始まるフォルダ名にすると無視されるということですが、my_service_nameを.my_service_nameと変えるのはタイプが面倒なので、/service/.disabledというフォルダを作って無効化するときはその下に移動することにしました。</p>

<h3>作業するときは/serviceに移動</h3>

<p>svcやsvstatにフルパスを指定しても動くのですが、/service/と/service/.disabled間で移動するときにタイプ量が増えるので、最初にcd /serviceしてから作業することにしました。</p>

<h2>手順</h2>

<h3>サービス追加</h3>

<p>node-virtualhost1.example.comという名前でサービスを追加する例。
exec -cの後はサービスに応じて変更します。</p>

<p>```
cd /service
mkdir -p .disabled/node-virtualhost1.example.com
cat &lt;<EOF > .disabled/node-virtualhost1.example.com/run</p>

<h1>!/bin/sh</h1>

<p>exec -c /usr/local/node-v0.6.19/bin/node /var/www/app/virtualhost1.example.com/hello.js
EOF
chmod 755 .disabled/node-virtualhost1.example.com/run
```</p>

<h3>サービス有効化</h3>

<p><code>
cd /service
mv .disabled/node-virtualhost1.example.com .
</code></p>

<h4>状態確認</h4>

<p>```</p>

<h1>svstat node-virtualhost1.example.com/</h1>

<p>node-virtualhost1.example.com/: up (pid 1493) 3 seconds
```</p>

<h3>サービス無効化</h3>

<p><code>
cd /service
mv node-virtualhost1.example.com .disabled/
svc -tx .disabled/node-virtualhost1.example.com
</code></p>

<h4>状態確認</h4>

<p>```</p>

<h1>svstat .disabled/node-virtualhost1.example.com/</h1>

<p>.disabled/node-virtualhost1.example.com/: supervise not running
```</p>

<h3>サービス一時停止(Down)</h3>

<p><code>
cd /service
svc -d node-virtualhost1.example.com
</code></p>

<h4>状態確認</h4>

<p>```</p>

<h1>svstat node-virtualhost1.example.com/</h1>

<p>node-virtualhost1.example.com/: down 1 seconds, normally up
```</p>

<h3>サービス一時停止からの再開(Up)</h3>

<p><code>
cd /service
svc -u node-virtualhost1.example.com
</code></p>

<h4>状態確認</h4>

<p>```</p>

<h1>svstat node-virtualhost1.example.com/</h1>

<p>node-virtualhost1.example.com/: up (pid 1512) 1 seconds
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[daemontoolsのインストール手順]]></title>
    <link href="http://hnakamur.github.com/blog/2012/06/21/how-to-install-daemontools/"/>
    <updated>2012-06-21T17:36:00+09:00</updated>
    <id>http://hnakamur.github.com/blog/2012/06/21/how-to-install-daemontools</id>
    <content type="html"><![CDATA[<p>CentOS6.2で確認。</p>

<p>OS起動時にdaemontoolsを起動する設定は<a href="http://cr.yp.to/daemontools/start.html">How to start daemontools</a>を参照。</p>

<p><code>
yum install -y make gcc rpm-build &amp;&amp;
rpm -ivh http://mirrors.qmailtoaster.com/daemontools-toaster-0.76-1.3.6.src.rpm &amp;&amp;
rpmbuild -ba /root/rpmbuild/SPECS/daemontools-toaster.spec &amp;&amp;
rpm -ivh /root/rpmbuild/RPMS/x86_64/daemontools-toaster-0.76-1.3.6.x86_64.rpm &amp;&amp;
cat &gt; /etc/init/svscan.conf &lt;&lt;EOF &amp;&amp;
start on runlevel [12345]
stop on runlevel [^12345]
respawn
exec /command/svscanboot
EOF
/command/svscanboot &amp;
</code></p>
]]></content>
  </entry>
  
</feed>
