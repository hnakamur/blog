<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Daemontools on hnakamur&#39;s blog at github</title>
    <link>https://hnakamur.github.io/blog/categories/daemontools/index.xml</link>
    <description>Recent content in Daemontools on hnakamur&#39;s blog at github</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <atom:link href="https://hnakamur.github.io/blog/categories/daemontools/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>daemontoolsのインストール手順</title>
      <link>https://hnakamur.github.io/blog/2012/06/21/how-to-install-daemontools/</link>
      <pubDate>Thu, 21 Jun 2012 00:00:00 +0000</pubDate>
      
      <guid>https://hnakamur.github.io/blog/2012/06/21/how-to-install-daemontools/</guid>
      <description>&lt;p&gt;CentOS6.2で確認。&lt;/p&gt;

&lt;p&gt;OS起動時にdaemontoolsを起動する設定は&lt;a href=&#34;http://cr.yp.to/daemontools/start.html&#34;&gt;How to start daemontools&lt;/a&gt;を参照。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;yum install -y make gcc rpm-build &amp;amp;&amp;amp;
rpm -ivh http://mirrors.qmailtoaster.com/daemontools-toaster-0.76-1.3.6.src.rpm &amp;amp;&amp;amp;
rpmbuild -ba /root/rpmbuild/SPECS/daemontools-toaster.spec &amp;amp;&amp;amp;
rpm -ivh /root/rpmbuild/RPMS/x86_64/daemontools-toaster-0.76-1.3.6.x86_64.rpm &amp;amp;&amp;amp;
cat &amp;gt; /etc/init/svscan.conf &amp;lt;&amp;lt;EOF &amp;amp;&amp;amp;
start on runlevel [12345]
stop on runlevel [^12345]
respawn
exec /command/svscanboot
EOF
/command/svscanboot &amp;amp;
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>daemontoolsの使い方</title>
      <link>https://hnakamur.github.io/blog/2012/06/21/how-to-use-daemontools/</link>
      <pubDate>Thu, 21 Jun 2012 00:00:00 +0000</pubDate>
      
      <guid>https://hnakamur.github.io/blog/2012/06/21/how-to-use-daemontools/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://www.nslabs.jp/daemontools.rhtml&#34;&gt;daemontoolsを使う | Netsphere Laboratories&lt;/a&gt;を参考にしました。ありがとうございます。&lt;/p&gt;

&lt;h2 id=&#34;私的ルール&#34;&gt;私的ルール&lt;/h2&gt;

&lt;h3 id=&#34;無効化したサービスは-service-disabled-に移動&#34;&gt;無効化したサービスは/service/.disabled/に移動&lt;/h3&gt;

&lt;p&gt;/service/以下に.で始まるフォルダ名にすると無視されるということですが、my_service_nameを.my_service_nameと変えるのはタイプが面倒なので、/service/.disabledというフォルダを作って無効化するときはその下に移動することにしました。&lt;/p&gt;

&lt;h3 id=&#34;作業するときは-serviceに移動&#34;&gt;作業するときは/serviceに移動&lt;/h3&gt;

&lt;p&gt;svcやsvstatにフルパスを指定しても動くのですが、/service/と/service/.disabled間で移動するときにタイプ量が増えるので、最初にcd /serviceしてから作業することにしました。&lt;/p&gt;

&lt;h2 id=&#34;手順&#34;&gt;手順&lt;/h2&gt;

&lt;h3 id=&#34;サービス追加&#34;&gt;サービス追加&lt;/h3&gt;

&lt;p&gt;node-virtualhost1.example.comという名前でサービスを追加する例。
exec -cの後はサービスに応じて変更します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cd /service
mkdir -p .disabled/node-virtualhost1.example.com
cat &amp;lt;&amp;lt;EOF &amp;gt; .disabled/node-virtualhost1.example.com/run
#!/bin/sh
exec -c /usr/local/node-v0.6.19/bin/node /var/www/app/virtualhost1.example.com/hello.js
EOF
chmod 755 .disabled/node-virtualhost1.example.com/run
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;サービス有効化&#34;&gt;サービス有効化&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;cd /service
mv .disabled/node-virtualhost1.example.com .
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;状態確認&#34;&gt;状態確認&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;# svstat node-virtualhost1.example.com/
node-virtualhost1.example.com/: up (pid 1493) 3 seconds
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;サービス無効化&#34;&gt;サービス無効化&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;cd /service
mv node-virtualhost1.example.com .disabled/
svc -tx .disabled/node-virtualhost1.example.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;状態確認-1&#34;&gt;状態確認&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;# svstat .disabled/node-virtualhost1.example.com/
.disabled/node-virtualhost1.example.com/: supervise not running
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;サービス一時停止-down&#34;&gt;サービス一時停止(Down)&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;cd /service
svc -d node-virtualhost1.example.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;状態確認-2&#34;&gt;状態確認&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;# svstat node-virtualhost1.example.com/
node-virtualhost1.example.com/: down 1 seconds, normally up
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;サービス一時停止からの再開-up&#34;&gt;サービス一時停止からの再開(Up)&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;cd /service
svc -u node-virtualhost1.example.com
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;状態確認-3&#34;&gt;状態確認&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;# svstat node-virtualhost1.example.com/
node-virtualhost1.example.com/: up (pid 1512) 1 seconds
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>