<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Sahara on hnakamur&#39;s blog at github</title>
    <link>https://hnakamur.github.io/blog/categories/sahara/</link>
    <description>Recent content in Sahara on hnakamur&#39;s blog at github</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <lastBuildDate>Wed, 03 Apr 2013 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://hnakamur.github.io/blog/categories/sahara/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Vagrant 1.1.5とSaharaを試した</title>
      <link>https://hnakamur.github.io/blog/2013/04/03/how-to-setup-vagrant-1-dot-1-5-and-sahara/</link>
      <pubDate>Wed, 03 Apr 2013 00:00:00 +0000</pubDate>
      
      <guid>https://hnakamur.github.io/blog/2013/04/03/how-to-setup-vagrant-1-dot-1-5-and-sahara/</guid>
      <description>

&lt;h2 id=&#34;vagrantと1-0-xと1-1-xについて:d6a5810c0b2989f2e72cf75b1e2111a0&#34;&gt;Vagrantと1.0.xと1.1.xについて&lt;/h2&gt;

&lt;p&gt;バージョン1.1.xの位置づけについては以下の記事を参照。
&lt;a href=&#34;http://www.hashicorp.com/blog/vagrant-1-1-and-vmware.html&#34;&gt;Vagrant 1.1, VMware Fusion - HashiCorp&lt;/a&gt;
変更履歴は &lt;a href=&#34;https://github.com/mitchellh/vagrant/blob/master/CHANGELOG.md&#34;&gt;vagrant/CHANGELOG.md at master · mitchellh/vagrant · GitHub&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;gem installで入れられるのは1.0.x系のみ。現在は1.0.7。
&lt;a href=&#34;http://rubygems.org/search?utf8=%E2%9C%93&amp;amp;query=vagrant&#34;&gt;search | RubyGems.org | your community gem host&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;vagrant-1-1-5のインストール:d6a5810c0b2989f2e72cf75b1e2111a0&#34;&gt;Vagrant 1.1.5のインストール&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.vagrantup.com/&#34;&gt;Vagrant&lt;/a&gt;
→ &lt;a href=&#34;http://downloads.vagrantup.com/&#34;&gt;Vagrant - Downloads&lt;/a&gt;
→ &lt;a href=&#34;http://downloads.vagrantup.com/tags/v1.1.5&#34;&gt;Vagrant - Downloads v1.1.5&lt;/a&gt;
と進み、Vagrant.dmgをダウンロードしてインストール&lt;/p&gt;

&lt;h2 id=&#34;path設定:d6a5810c0b2989f2e72cf75b1e2111a0&#34;&gt;PATH設定&lt;/h2&gt;

&lt;p&gt;vagrantコマンドにPATHを通します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;&#39;EOF&#39; &amp;gt;&amp;gt; ~/.bash_profile
export PATH=/Applications/Vagrant/bin:$PATH
EOF
. ~/.bash_profile
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ruby 1.9.3p327が同梱されています。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ /Applications/Vagrant/embedded/bin/ruby --version
ruby 1.9.3p327 (2012-11-10 revision 37606) [universal.x86_64-darwin12.2.1]
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;vagrant-1-1-x用のsaharaをインストール:d6a5810c0b2989f2e72cf75b1e2111a0&#34;&gt;Vagrant 1.1.x用のSaharaをインストール&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://www.ryuzee.com/contents/blog/6555&#34;&gt;Vagrantの必須プラグインSaharaをVagrant 1.1に対応させました | Ryuzee.com&lt;/a&gt;の手順でインストール。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mkdir -p ~/src/chef
cd ~/src/chef
git clone https://github.com/ryuzee/sahara.git
cd sahara
export PATH=/Applications/Vagrant/embedded/bin:$PATH
sudo gem install bundler
bundle install
bundle exec rake build
vagrant plugin install pkg/sahara-0.0.14.gem
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;~/.vagrant.d/gems/gems/sahara-0.0.14/にインストールされた。&lt;/p&gt;

&lt;h3 id=&#34;複数vm環境でのテスト:d6a5810c0b2989f2e72cf75b1e2111a0&#34;&gt;複数VM環境でのテスト&lt;/h3&gt;

&lt;p&gt;Vagrantfile&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-*- mode: ruby -*-
## vi: set ft=ruby :

Vagrant::Config.run do |config|
  config.ssh.private_key_path = &amp;quot;../vagrant.id_rsa&amp;quot;

  config.vm.define :web1 do |c|
    c.vm.box = &amp;quot;centos6.4&amp;quot;
    c.vm.host_name = &amp;quot;web1&amp;quot;
    c.vm.network :hostonly, &amp;quot;192.168.33.24&amp;quot;
    c.vm.customize [&amp;quot;modifyvm&amp;quot;, :id,
      &amp;quot;--name&amp;quot;, &amp;quot;web1&amp;quot;,
      &amp;quot;--natdnshostresolver1&amp;quot;, &amp;quot;on&amp;quot;,
      &amp;quot;--cpus&amp;quot;, 1,
      &amp;quot;--memory&amp;quot;, 512
    ]
  end

  config.vm.define :db1 do |c|
    c.vm.box = &amp;quot;centos6.4&amp;quot;
    c.vm.host_name = &amp;quot;db1&amp;quot;
    c.vm.network :hostonly, &amp;quot;192.168.33.25&amp;quot;
    c.vm.customize [&amp;quot;modifyvm&amp;quot;, :id,
      &amp;quot;--name&amp;quot;, &amp;quot;db1&amp;quot;,
      &amp;quot;--natdnshostresolver1&amp;quot;, &amp;quot;on&amp;quot;,
      &amp;quot;--cpus&amp;quot;, 1,
      &amp;quot;--memory&amp;quot;, 512
    ]
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;なお、centos6.4のVMはrubyやchef-soloはインストールしていない状態になっています。&lt;/p&gt;

&lt;p&gt;sandboxモードをオンにしてVM起動。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vagrant sandbox on
vagrant up
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ホスト側からchefセットアップ実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;./bin/knife solo prepare web1
./bin/knife solo prepare db1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;web1, db1にログインして/usr/bin/chef-soloが作成されたことを確認。&lt;/p&gt;

&lt;p&gt;ロールバックを実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vagrant sandbox rollback
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;web1, db1にログインして/usr/bin/chef-soloが無いことを確認。&lt;/p&gt;

&lt;p&gt;ホスト側から再度chefセットアップ実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;./bin/knife solo prepare web1
./bin/knife solo prepare db1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;コミット実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vagrant sandbox commit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ホスト側からchefクックブック実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;./bin/knife solo cook web1
./bin/knife solo cook db1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;web1, db1にログインして/usr/bin/chef-soloがあること、/etc/chefが作成されたことをを確認。&lt;/p&gt;

&lt;p&gt;ロールバック実行。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;vagrant sandbox rollback
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;web1, db1にログインして/usr/bin/chef-soloがあること、/etc/chefが無いことをを確認。&lt;/p&gt;

&lt;p&gt;テスト環境&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;OS: OS X 10.8.3&lt;/li&gt;
&lt;li&gt;VirtualBox: 4.2.10&lt;/li&gt;
&lt;li&gt;Vagrant: 1.1.5&lt;/li&gt;
&lt;li&gt;sahara: &lt;a href=&#34;https://github.com/ryuzee/sahara.git&#34;&gt;https://github.com/ryuzee/sahara.git&lt;/a&gt; commit d22795aa417ec1cb67eb92810afb52300edd3c44&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>