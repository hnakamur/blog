<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>minikubeでKubernetesのチュートリアルをやってみた</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2016/12/31/tried-kubernetes-tutorial-with-minikube/" rel="bookmark"
           title="Permalink to minikubeでKubernetesのチュートリアルをやってみた">minikubeでKubernetesのチュートリアルをやってみた</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-31T16:24:00+09:00">
                Published: 2016-12-31
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/kubernetes.html">kubernetes</a> </p>
</footer><!-- /.post-info -->      <h2>はじめに</h2>
<p>検索してたら <a href="https://news.ycombinator.com/item?id=12462261">Why Kubernetes is winning the container war | Hacker News</a> というHacker Newsのスレッドを見つけました。</p>
<p>実際に勝つどうかはともかく、実際に使っている人やMesosphereやRed Hatの人のコメントがあり、非常に参考になりそうです。このブログ記事を書くまで私は Kubernetes はろくに触ったことが無かったので内容はよくわからないですが、後日また見直してみたいところです。</p>
<p>上記のHacker Newsのコメントで以下の2つのチュートリアルが紹介されていました。このブログ記事はこのうち1つめのほうを試してみたメモです。</p>
<ul>
<li><a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/">Kubernetes Bootcamp</a></li>
<li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way">kelseyhightower/kubernetes-the-hard-way: Bootstrap Kubernetes the hard way on Google Cloud Platform or Amazon EC2. No scripts.</a></li>
</ul>
<p>試してから気づいたのですが、全く同じ内容が Kubernetes の公式ドキュメントの <a href="http://kubernetes.io/docs/tutorials/kubernetes-basics/">Kubernetes Basics</a> にありました。</p>
<p><a href="http://kubernetes.io/docs/tutorials/kubernetes-basics/">Kubernetes Basics</a> はいくつかの章（このチュートリアルでは Module と呼ばれています）に分かれていて、まず図解付きのわかりやすい概念説明があり、その後ブラウザ上のターミナルでコマンドを入力すると結果が表示されるというインタラクティブなチュートリアルになっています。</p>
<p>各章末にクイズがあり、概念を理解したか確認できるのも良い感じです。</p>
<p>ターミナルの左に説明文があり、入力する各コマンドをマウスでクリックすると、右側のターミナルに入力してくれるので手軽に試せます。</p>
<p>とはいえ、手元の環境でも試してみたかったので、macOS上に環境構築してブラウザのインタラクティブチュートリアルとともに試してみました。</p>
<h2>macOS Sierraでの事前準備</h2>
<p><code>minikube start --help</code> の <code>--vm-driver</code> の説明によると仮想マシンドライバは virtualbox xhyve vmwarefusion のいずれかでデフォルトは virtualbox です。
ということでVirtualBoxをインストールしておきます。私の環境ではバージョンは 5.1.12 でした。 </p>
<p>minikubeとKubernetesはGitHubのプロジェクトにリリースページがあってそこからバイナリをダウンロードできます。</p>
<ul>
<li><a href="https://github.com/kubernetes/minikube/releases/tag/v0.14.0">Release v0.14.0 · kubernetes/minikube</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.5.1">Release v1.5.1 · kubernetes/kubernetes</a></li>
</ul>
<p>が、Homebrewでパッケージが用意されていてバージョンも上記と同じで最新だったのでHomebrewでインストールしました。</p>
<div class="highlight"><pre><span></span>brew install Caskroom/cask/minikube
brew install kubectl
</pre></div>


<h2>Module 1: Kubernetsクラスタを作成する</h2>
<p>概念の説明は <a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/1-1.html">Introduction to Kubernetes cluster</a> を参照してください。</p>
<h3>minikubeのバージョン確認</h3>
<div class="highlight"><pre><span></span>$ minikube version       
minikube version: v0.14.0
</pre></div>


<h3>minikube起動</h3>
<div class="highlight"><pre><span></span>$ minikube start
Starting <span class="nb">local</span> Kubernetes cluster...
Kubectl is now configured to use the cluster.
</pre></div>


<h3>kubectlのバージョン確認</h3>
<div class="highlight"><pre><span></span>$ kubectl version
Client Version: version.Info<span class="o">{</span>Major:<span class="s2">&quot;1&quot;</span>, Minor:<span class="s2">&quot;5&quot;</span>, GitVersion:<span class="s2">&quot;v1.5.1&quot;</span>, GitCommit:<span class="s2">&quot;82450d03cb057bab0950214ef122b67c83fb11df&quot;</span>, GitTreeState:<span class="s2">&quot;clean&quot;</span>, BuildDate:<span class="s2">&quot;2016-12-22T13:56:59Z&quot;</span>, GoVersion:<span class="s2">&quot;go1.7.4&quot;</span>, Compiler:<span class="s2">&quot;gc&quot;</span>, Platform:<span class="s2">&quot;darwin/amd64&quot;</span><span class="o">}</span>
Server Version: version.Info<span class="o">{</span>Major:<span class="s2">&quot;1&quot;</span>, Minor:<span class="s2">&quot;5&quot;</span>, GitVersion:<span class="s2">&quot;v1.5.1&quot;</span>, GitCommit:<span class="s2">&quot;82450d03cb057bab0950214ef122b67c83fb11df&quot;</span>, GitTreeState:<span class="s2">&quot;clean&quot;</span>, BuildDate:<span class="s2">&quot;1970-01-01T00:00:00Z&quot;</span>, GoVersion:<span class="s2">&quot;go1.7.1&quot;</span>, Compiler:<span class="s2">&quot;gc&quot;</span>, Platform:<span class="s2">&quot;linux/amd64&quot;</span><span class="o">}</span>
</pre></div>


<h3>クラスタの情報表示</h3>
<div class="highlight"><pre><span></span>$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443
kubernetes-dashboard is running at https://192.168.99.100:8443/api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard

To further debug and diagnose cluster problems, use <span class="s1">&#39;kubectl cluster-info dump&#39;</span>.
</pre></div>


<h3>ノード一覧</h3>
<div class="highlight"><pre><span></span>$ kubectl get nodes
NAME       STATUS    AGE
minikube   Ready     11h
</pre></div>


<h2>Module 2: アプリをデプロイ</h2>
<p>概念の説明は <a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/2-1.html">Your first application deployment</a> を参照してください。</p>
<h3>kubernetes-bootcampアプリをデプロイ</h3>
<p>チュートリアルのために用意されたkubernetes-bootcampアプリをデプロイしてみます。</p>
<div class="highlight"><pre><span></span>$ kubectl run kubernetes-bootcamp --image<span class="o">=</span>docker.io/jocatalin/kubernetes-bootcamp:v1 --port<span class="o">=</span><span class="m">8080</span>
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> created
</pre></div>


<h3>デプロイされたアプリ一覧</h3>
<div class="highlight"><pre><span></span>$ kubectl get deployments
NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-bootcamp   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>            <span class="m">1</span>           57s
</pre></div>


<h3>プロキシ起動</h3>
<div class="highlight"><pre><span></span>$ kubectl proxy
Starting to serve on <span class="m">127</span>.0.0.1:8001
</pre></div>


<p>プロキシを起動したらプロンプトには戻ってこないので、以降のコマンドは別のターミナルで実行します。</p>
<h3>Podの名前を取得</h3>
<p>この後参照するため、Podの名前を取得して環境変数POD_NAMEに設定しておきます。</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods -o go-template --template <span class="s1">&#39;{{range .items}}{{.metadata.name}}{{&quot;\n&quot;}}{{end}}&#39;</span><span class="k">)</span>
$ <span class="nb">echo</span> Name of the Pod: <span class="nv">$POD_NAME</span>
Name of the Pod: kubernetes-bootcamp-390780338-6j8fn
</pre></div>


<p>見た感じ <code>--template</code> の引数の書式はGo言語の <a href="https://golang.org/pkg/text/template/">text/template</a>パッケージのテンプレート言語をそのまま使っているようです。</p>
<p>Pod名の <code>390780338-6j8fn</code> の部分はデプロイの度に生成されるランダムな文字列となっています。</p>
<h3>プロキシ経由でアプリにアクセス</h3>
<div class="highlight"><pre><span></span>$ curl http://localhost:8001/api/v1/proxy/namespaces/default/pods/<span class="nv">$POD_NAME</span>/
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
</pre></div>


<h2>Module 3: デプロイしたアプリを詳しく見てみる</h2>
<p>概念の説明は <a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/3-1.html">Pods and Nodes</a> を参照してください。</p>
<h3>Pod一覧表示</h3>
<div class="highlight"><pre><span></span>$ kubectl get pods
NAME                                  READY     STATUS    RESTARTS   AGE
kubernetes-bootcamp-390780338-6j8fn   <span class="m">1</span>/1       Running   <span class="m">0</span>          13m
</pre></div>


<h3>Pod詳細表示</h3>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span><span class="o">-</span><span class="mi">6</span><span class="n">j8fn</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">41</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">390780338</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">f3d04d91e8f27b2b537c20d82253376993483f9bb9c0d1196ba50ecc3a69ff7c</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v1</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="mi">8f</span><span class="n">afd8af70e9aa7c3ab40222ca4fd58050cf3e49cb14a4e7c0f460cd4f78e9fe</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">42</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span><span class="o">-</span><span class="mi">6</span><span class="n">j8fn</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;docker.io/jocatalin/kubernetes-bootcamp:v1&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="n">f3d04d91e8f2</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="n">f3d04d91e8f2</span>
</pre></div>


<h3>Podのログ表示</h3>
<div class="highlight"><pre><span></span>$ kubectl logs <span class="nv">$POD_NAME</span>
Kubernetes Bootcamp App Started At: <span class="m">2016</span>-12-31T08:15:42.728Z <span class="p">|</span> Running On:  kubernetes-bootcamp-390780338-6j8fn 

Running On: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> Total Requests: <span class="m">1</span> <span class="p">|</span> App Uptime: <span class="m">580</span>.532 seconds <span class="p">|</span> Log Time: <span class="m">2016</span>-12-31T08:25:23.260Z
</pre></div>


<h3>Pod内でコマンド実行</h3>
<p>envコマンドを実行してみます。</p>
<div class="highlight"><pre><span></span>$ kubectl <span class="nb">exec</span> <span class="nv">$POD_NAME</span> env
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="nv">HOSTNAME</span><span class="o">=</span>kubernetes-bootcamp-390780338-6j8fn
<span class="nv">KUBERNETES_SERVICE_HOST</span><span class="o">=</span><span class="m">10</span>.0.0.1
<span class="nv">KUBERNETES_SERVICE_PORT</span><span class="o">=</span><span class="m">443</span>
<span class="nv">KUBERNETES_SERVICE_PORT_HTTPS</span><span class="o">=</span><span class="m">443</span>
<span class="nv">KUBERNETES_PORT</span><span class="o">=</span>tcp://10.0.0.1:443
<span class="nv">KUBERNETES_PORT_443_TCP</span><span class="o">=</span>tcp://10.0.0.1:443
<span class="nv">KUBERNETES_PORT_443_TCP_PROTO</span><span class="o">=</span>tcp
<span class="nv">KUBERNETES_PORT_443_TCP_PORT</span><span class="o">=</span><span class="m">443</span>
<span class="nv">KUBERNETES_PORT_443_TCP_ADDR</span><span class="o">=</span><span class="m">10</span>.0.0.1
<span class="nv">NPM_CONFIG_LOGLEVEL</span><span class="o">=</span>info
<span class="nv">NODE_VERSION</span><span class="o">=</span><span class="m">6</span>.3.1
<span class="nv">HOME</span><span class="o">=</span>/root
</pre></div>


<p><code>hostname</code> コマンドを実行してみます。</p>
<div class="highlight"><pre><span></span>$ kubectl <span class="nb">exec</span> <span class="nv">$POD_NAME</span> hostname
kubernetes-bootcamp-390780338-6j8fn
</pre></div>


<p><code>ip a</code> を実行してみます。</p>
<div class="highlight"><pre><span></span>$ kubectl <span class="nb">exec</span> <span class="nv">$POD_NAME</span> ip a
<span class="m">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1</span>
    link/loopback <span class="m">00</span>:00:00:00:00:00 brd <span class="m">00</span>:00:00:00:00:00
    inet <span class="m">127</span>.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
<span class="m">11</span>: eth0@if12: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP group default 
    link/ether <span class="m">02</span>:42:ac:11:00:04 brd ff:ff:ff:ff:ff:ff
    inet <span class="m">172</span>.17.0.4/16 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:acff:fe11:4/64 scope link tentative dadfailed 
       valid_lft forever preferred_lft forever
</pre></div>


<h3>Pod内でbash実行</h3>
<p>以下のコマンドでbashを実行するとプロンプトが表示されます。</p>
<div class="highlight"><pre><span></span>$ kubectl <span class="nb">exec</span> -ti <span class="nv">$POD_NAME</span> bash
root@kubernetes-bootcamp-390780338-6j8fn:/# 
</pre></div>


<p>チュートリアルのために用意されたkubernetes-bootcampアプリに含まれるファイル <code>server.js</code> の内容を表示してみます。このアプリは Node.js で書かれていることがわかります。</p>
<div class="highlight"><pre><span></span><span class="nt">root</span><span class="p">@</span><span class="k">kubernetes-bootcamp-390780338-6j8fn</span><span class="o">:/</span><span class="err">#</span> <span class="nt">cat</span> <span class="nt">server</span><span class="p">.</span><span class="nc">js</span>
<span class="nt">var</span> <span class="nt">http</span> <span class="o">=</span> <span class="nt">require</span><span class="o">(</span><span class="s1">&#39;http&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="nt">var</span> <span class="nt">requests</span><span class="o">=</span><span class="nt">0</span><span class="o">;</span>
<span class="nt">var</span> <span class="nt">podname</span><span class="o">=</span> <span class="nt">process</span><span class="p">.</span><span class="nc">env</span><span class="p">.</span><span class="nc">HOSTNAME</span><span class="o">;</span>
<span class="nt">var</span> <span class="nt">startTime</span><span class="o">;</span>
<span class="nt">var</span> <span class="nt">host</span><span class="o">;</span>
<span class="nt">var</span> <span class="nt">handleRequest</span> <span class="o">=</span> <span class="nt">function</span><span class="o">(</span><span class="nt">request</span><span class="o">,</span> <span class="nt">response</span><span class="o">)</span> <span class="p">{</span>
  <span class="err">response.setHeader(&#39;Content-Type&#39;,</span> <span class="err">&#39;text/plain&#39;)</span><span class="p">;</span>
  <span class="err">response.writeHead(200)</span><span class="p">;</span>
  <span class="err">response.write(&quot;Hello</span> <span class="err">Kubernetes</span> <span class="err">bootcamp!</span> <span class="err">|</span> <span class="err">Running</span> <span class="n">on</span><span class="p">:</span> <span class="s2">&quot;);</span>
<span class="s2">  response.write(host);</span>
<span class="s2">  response.end(&quot;</span> <span class="o">|</span> <span class="n">v</span><span class="o">=</span><span class="mi">1</span><span class="err">\</span><span class="n">n</span><span class="s2">&quot;);</span>
<span class="s2">  console.log(&quot;</span><span class="n">Running</span> <span class="n">On</span><span class="o">:</span><span class="s2">&quot; ,host, &quot;</span><span class="o">|</span> <span class="n">Total</span> <span class="n">Requests</span><span class="o">:</span><span class="s2">&quot;, ++requests,&quot;</span><span class="o">|</span> <span class="n">App</span> <span class="n">Uptime</span><span class="o">:</span><span class="s2">&quot;, (new Date() - startTime)/1000 , &quot;</span><span class="n">seconds</span><span class="s2">&quot;, &quot;</span><span class="o">|</span> <span class="n">Log</span> <span class="n">Time</span><span class="o">:</span><span class="s2">&quot;,new Date());</span>
<span class="s2">}</span>
<span class="s2">var www = http.createServer(handleRequest);</span>
<span class="s2">www.listen(8080,function () {</span>
<span class="s2">    startTime = new Date();;</span>
<span class="s2">    host = process.env.HOSTNAME;</span>
<span class="s2">    console.log (&quot;</span><span class="n">Kubernetes</span> <span class="n">Bootcamp</span> <span class="n">App</span> <span class="n">Started</span> <span class="n">At</span><span class="o">:</span><span class="s2">&quot;,startTime, &quot;</span><span class="o">|</span> <span class="n">Running</span> <span class="n">On</span><span class="o">:</span> <span class="s2">&quot; ,host, &quot;</span><span class="err">\</span><span class="n">n</span><span class="err">&quot;</span> <span class="p">);</span>
<span class="p">}</span><span class="o">);</span>
</pre></div>


<p>Pod内からcurlで直接アプリにアクセスしてみます。 Node.js コンテナ内でbashを実行しているのでホスト名には localhost を指定しています。</p>
<div class="highlight"><pre><span></span>root@kubernetes-bootcamp-390780338-6j8fn:/# curl localhost:8080
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-390780338-6j8fn | v=1
</pre></div>


<p><code>exit</code> を入力してPod内のbashを抜けます。</p>
<div class="highlight"><pre><span></span>root@kubernetes-bootcamp-390780338-6j8fn:/# exit
exit
$ 
</pre></div>


<h2>Module 4: アプリをKubernetes外に公開する</h2>
<p>概念の説明は <a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/4-1.html">Services</a> を参照してください。</p>
<p>Module 1では <code>minikube proxy</code> を実行してMacの8001番ポートでリッスンしておいて、Macから localhost:8001 でアクセスしました。</p>
<p>ここではKubernetesのノード上のポートでリッスンして、Macからminikubeのproxyを経由せずに直接アクセスします。</p>
<h3>サービス一覧表示</h3>
<div class="highlight"><pre><span></span>$ kubectl get services
NAME         CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>   AGE
kubernetes   <span class="m">10</span>.0.0.1     &lt;none&gt;        <span class="m">443</span>/TCP   12h
</pre></div>


<h3>kubernetes-bootcampアプリを公開</h3>
<div class="highlight"><pre><span></span>$ kubectl expose deployment/kubernetes-bootcamp --type<span class="o">=</span><span class="s2">&quot;NodePort&quot;</span> --port <span class="m">8080</span>
service <span class="s2">&quot;kubernetes-bootcamp&quot;</span> exposed
</pre></div>


<h3>再度サービス一覧表示</h3>
<div class="highlight"><pre><span></span>$ kubectl get services
NAME                  CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>          AGE
kubernetes            <span class="m">10</span>.0.0.1     &lt;none&gt;        <span class="m">443</span>/TCP          12h
kubernetes-bootcamp   <span class="m">10</span>.0.0.228   &lt;nodes&gt;       <span class="m">8080</span>:31123/TCP   40s
</pre></div>


<p>上で <code>kubectl expose</code> コマンドでサービスを公開したので、一覧にkubernetes-bootcampが含まれるようになりました。</p>
<h3>サービス詳細表示</h3>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">services</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Name</span><span class="p">:</span>                   <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Namespace</span><span class="p">:</span>              <span class="k">default</span>
<span class="n">Labels</span><span class="p">:</span>                 <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Selector</span><span class="p">:</span>               <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Type</span><span class="p">:</span>                   <span class="n">NodePort</span>
<span class="n">IP</span><span class="p">:</span>                     <span class="mf">10.0</span><span class="p">.</span><span class="mf">0.228</span>
<span class="n">Port</span><span class="p">:</span>                   <span class="o">&lt;</span><span class="n">unset</span><span class="o">&gt;</span> <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
<span class="n">NodePort</span><span class="p">:</span>               <span class="o">&lt;</span><span class="n">unset</span><span class="o">&gt;</span> <span class="mi">31123</span><span class="o">/</span><span class="n">TCP</span>
<span class="n">Endpoints</span><span class="p">:</span>              <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span><span class="p">:</span><span class="mi">8080</span>
<span class="n">Session</span> <span class="n">Affinity</span><span class="p">:</span>       <span class="n">None</span>
<span class="n">No</span> <span class="n">events</span><span class="p">.</span>
</pre></div>


<h3>ノードのポート取得</h3>
<p>この後参照するため、ノードのポートを取得して環境変数 NODE_PORT に設定しておきます。</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">NODE_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl get services/kubernetes-bootcamp -o go-template<span class="o">=</span><span class="s1">&#39;{{(index .spec.ports 0).nodePort}}&#39;</span><span class="k">)</span>
$ <span class="nb">echo</span> <span class="nv">NODE_PORT</span><span class="o">=</span><span class="nv">$NODE_PORT</span>
<span class="nv">NODE_PORT</span><span class="o">=</span><span class="m">31123</span>
</pre></div>


<p><a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/4-2.html">Module 4のインタラクティブチュートリアル</a>ではこの後 <code>curl host01:$NODE_PORT</code> でアクセスしているのですが、手元の環境では <code>host01</code> というホスト名ではアクセスできません。</p>
<p>そこで、以下のコマンドを実行してノードのIPアドレスを取得し、環境変数 NODE_IP に設定します。</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>minikube ip<span class="k">)</span>
$ <span class="nb">echo</span> <span class="nv">NODE_IP</span><span class="o">=</span><span class="nv">$NODE_IP</span>
<span class="nv">NODE_IP</span><span class="o">=</span><span class="m">192</span>.168.99.100
</pre></div>


<p>以下のコマンドでMacからKubernetesのノードに直接アクセスします。</p>
<div class="highlight"><pre><span></span>$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
</pre></div>


<p>Module 4のStep 2でラベルを付けて、Step 3でサービス削除するのですが、この記事を書く時は飛ばしてしまったので、Module 6の後に行います。</p>
<h2>Module 5: アプリをスケールアップする</h2>
<p>概念の説明は <a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/5-1.html">Running multiple instances of an app</a> を参照してください。</p>
<h3>デプロイされたアプリのスケールアップ前のレプリカ数を確認</h3>
<p><code>kubectl get deployments</code> の結果にはデプロイごとにアプリのレプリカ（複製）の数が表示されます。</p>
<div class="highlight"><pre><span></span>$ kubectl get deployments
NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-bootcamp   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>            <span class="m">1</span>           46m
</pre></div>


<p>この結果ではPodの数は1です。</p>
<ul>
<li>DESIRED: デプロイ時に指定したレプリカ数。desireの意味は「切望する」なので、デプロイ時に希望した数ということでしょう。</li>
<li>CURRENT: 現在実行中のレプリカ数。</li>
<li>UP-TO-DATE: 指定した状態に更新されたレプリカ数。</li>
<li>AVAILABLE: ユーザが利用可能な（＝ユーザに実際にサービスが提供されている）レプリカ数。</li>
</ul>
<h3>スケールアップ</h3>
<p>このデプロイのレプリカ数を4に増やしてみます。</p>
<div class="highlight"><pre><span></span>$ kubectl scale deployments/kubernetes-bootcamp --replicas<span class="o">=</span><span class="m">4</span>
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> scaled
</pre></div>


<p>デプロイ一覧で再度確認するとレプリカ数が4に増えていました。</p>
<div class="highlight"><pre><span></span>$ kubectl get deployments
NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-bootcamp   <span class="m">4</span>         <span class="m">4</span>         <span class="m">4</span>            <span class="m">4</span>           55m
</pre></div>


<p>Pod一覧を <code>-o wide</code> を指定して表示するとIPアドレスとノードを確認できます。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                  READY     STATUS    RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-390780338-6j8fn   <span class="m">1</span>/1       Running   <span class="m">0</span>          55m       <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-390780338-jw7cn   <span class="m">1</span>/1       Running   <span class="m">0</span>          7s        <span class="m">172</span>.17.0.5   minikube
kubernetes-bootcamp-390780338-p8jbb   <span class="m">1</span>/1       Running   <span class="m">0</span>          7s        <span class="m">172</span>.17.0.6   minikube
kubernetes-bootcamp-390780338-vq3kx   <span class="m">1</span>/1       Running   <span class="m">0</span>          7s        <span class="m">172</span>.17.0.7   minikube
</pre></div>


<p>ちなみに <code>-o wide</code> 無しの出力結果は以下の通りです。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods
NAME                                  READY     STATUS    RESTARTS   AGE
kubernetes-bootcamp-390780338-6j8fn   <span class="m">1</span>/1       Running   <span class="m">0</span>          56m
kubernetes-bootcamp-390780338-jw7cn   <span class="m">1</span>/1       Running   <span class="m">0</span>          1m
kubernetes-bootcamp-390780338-p8jbb   <span class="m">1</span>/1       Running   <span class="m">0</span>          1m
kubernetes-bootcamp-390780338-vq3kx   <span class="m">1</span>/1       Running   <span class="m">0</span>          1m
</pre></div>


<h3>スケールアップ後のデプロイの詳細表示</h3>
<p>Events欄にスケールアップした記録が残っています。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">deployments</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Name</span><span class="p">:</span>                   <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Namespace</span><span class="p">:</span>              <span class="k">default</span>
<span class="n">CreationTimestamp</span><span class="p">:</span>      <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">41</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>                 <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Selector</span><span class="p">:</span>               <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Replicas</span><span class="p">:</span>               <span class="mi">4</span> <span class="n">updated</span> <span class="err">|</span> <span class="mi">4</span> <span class="n">total</span> <span class="err">|</span> <span class="mi">4</span> <span class="n">available</span> <span class="err">|</span> <span class="mi">0</span> <span class="n">unavailable</span>
<span class="n">StrategyType</span><span class="p">:</span>           <span class="n">RollingUpdate</span>
<span class="n">MinReadySeconds</span><span class="p">:</span>        <span class="mi">0</span>
<span class="n">RollingUpdateStrategy</span><span class="p">:</span>  <span class="mi">1</span> <span class="n">max</span> <span class="n">unavailable</span><span class="p">,</span> <span class="mi">1</span> <span class="n">max</span> <span class="n">surge</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>  <span class="n">Reason</span>
  <span class="o">----</span>          <span class="o">------</span>  <span class="o">------</span>
  <span class="n">Available</span>     <span class="k">True</span>    <span class="n">MinimumReplicasAvailable</span>
<span class="n">OldReplicaSets</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">NewReplicaSet</span><span class="p">:</span>  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">4</span> <span class="n">replicas</span> <span class="n">created</span><span class="p">)</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                            <span class="n">SubObjectPath</span>   <span class="n">Type</span>            <span class="n">Reason</span>                  <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                            <span class="o">-------------</span>   <span class="o">--------</span>        <span class="o">------</span>                  <span class="o">-------</span>
  <span class="mi">58</span><span class="n">m</span>           <span class="mi">58</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="k">to</span> <span class="mi">1</span>
  <span class="mi">3</span><span class="n">m</span>            <span class="mi">3</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="k">to</span> <span class="mi">4</span>
</pre></div>


<h3>スケールアップ後のアプリにcurlでアクセス</h3>
<p>アクセスしてみるとリクエストごとにランダムなPodに振り分けられ、負荷分散されていることが確認できました。</p>
<div class="highlight"><pre><span></span>$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-jw7cn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-p8jbb <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-390780338-6j8fn <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">1</span>
</pre></div>


<h3>スケールダウン</h3>
<p>レプリカ数を2に減らします。</p>
<div class="highlight"><pre><span></span>$ kubectl scale deployments/kubernetes-bootcamp --replicas<span class="o">=</span><span class="m">2</span>
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> scaled
</pre></div>


<p>デプロイ一覧で2に減ったことを確認しました。</p>
<div class="highlight"><pre><span></span>$ kubectl get deployments
NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-bootcamp   <span class="m">2</span>         <span class="m">2</span>         <span class="m">2</span>            <span class="m">2</span>           1h
</pre></div>


<p>直後のPod一覧では2つのコンテナのSTATUSがTerminating （終了中）となっていました。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                  READY     STATUS        RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-390780338-6j8fn   <span class="m">1</span>/1       Running       <span class="m">0</span>          1h        <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-390780338-jw7cn   <span class="m">1</span>/1       Running       <span class="m">0</span>          12m       <span class="m">172</span>.17.0.5   minikube
kubernetes-bootcamp-390780338-p8jbb   <span class="m">1</span>/1       Terminating   <span class="m">0</span>          12m       <span class="m">172</span>.17.0.6   minikube
kubernetes-bootcamp-390780338-vq3kx   <span class="m">1</span>/1       Terminating   <span class="m">0</span>          12m       <span class="m">172</span>.17.0.7   minikube
</pre></div>


<p>数十秒程度してから再度Pod一覧を見るとSTATUSがRunningの2つだけになっていました。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                  READY     STATUS    RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-390780338-6j8fn   <span class="m">1</span>/1       Running   <span class="m">0</span>          1h        <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-390780338-jw7cn   <span class="m">1</span>/1       Running   <span class="m">0</span>          13m       <span class="m">172</span>.17.0.5   minikube
</pre></div>


<h2>Module 6: アプリをローリングアップデート</h2>
<p>概念の説明は <a href="https://kubernetesbootcamp.github.io/kubernetes-bootcamp/6-1.html">Performing a rolling update for an app</a> を参照してください。</p>
<p>ローリングアップデートではアプリのダウンタイムをゼロでアプリを更新できるそうです。</p>
<h3>アップデート前の状態確認</h3>
<p>Pod一覧。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                  READY     STATUS    RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-390780338-6j8fn   <span class="m">1</span>/1       Running   <span class="m">0</span>          1h        <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-390780338-jw7cn   <span class="m">1</span>/1       Running   <span class="m">0</span>          21m       <span class="m">172</span>.17.0.5   minikube
</pre></div>


<p>Pod詳細情報。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span><span class="o">-</span><span class="mi">6</span><span class="n">j8fn</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">41</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">390780338</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">f3d04d91e8f27b2b537c20d82253376993483f9bb9c0d1196ba50ecc3a69ff7c</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v1</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="mi">8f</span><span class="n">afd8af70e9aa7c3ab40222ca4fd58050cf3e49cb14a4e7c0f460cd4f78e9fe</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">42</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span>
  <span class="n">Ready</span>         <span class="k">True</span>
  <span class="n">PodScheduled</span>  <span class="k">True</span>
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">No</span> <span class="n">events</span><span class="p">.</span>


<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span><span class="o">-</span><span class="n">jw7cn</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">47</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">390780338</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.5</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">23</span><span class="n">e8c9c3c2b64701f88a61033b534a23f7f2e4a540afa019eea20050bfd12a39</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v1</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="mi">8f</span><span class="n">afd8af70e9aa7c3ab40222ca4fd58050cf3e49cb14a4e7c0f460cd4f78e9fe</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">48</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span>
  <span class="n">Ready</span>         <span class="k">True</span>
  <span class="n">PodScheduled</span>  <span class="k">True</span>
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span><span class="o">-</span><span class="n">jw7cn</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;docker.io/jocatalin/kubernetes-bootcamp:v1&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">23</span><span class="n">e8c9c3c2b6</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">23</span><span class="n">e8c9c3c2b6</span>
</pre></div>


<h3>アプリのバージョンアップ</h3>
<p>以下のコマンドでアプリをv1からv2にバージョンアップします。</p>
<div class="highlight"><pre><span></span>$ kubectl <span class="nb">set</span> image deployments/kubernetes-bootcamp kubernetes-bootcamp<span class="o">=</span>jocatalin/kubernetes-bootcamp:v2$ kubectl <span class="nb">set</span> image deployments/kubernetes-bootcamp kubernetes-bootcamp<span class="o">=</span>jocatalin/kubernetes-bootcamp:v2
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> image updated
</pre></div>


<p>直後のPods一覧。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                   READY     STATUS        RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-2100875782-0jd0d   <span class="m">1</span>/1       Running       <span class="m">0</span>          26s       <span class="m">172</span>.17.0.6   minikube
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running       <span class="m">0</span>          26s       <span class="m">172</span>.17.0.7   minikube
kubernetes-bootcamp-390780338-6j8fn    <span class="m">1</span>/1       Terminating   <span class="m">0</span>          1h        <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-390780338-jw7cn    <span class="m">1</span>/1       Terminating   <span class="m">0</span>          24m       <span class="m">172</span>.17.0.5   minikube
</pre></div>


<p>十秒程度したあとのPods一覧。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                   READY     STATUS    RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-2100875782-0jd0d   <span class="m">1</span>/1       Running   <span class="m">0</span>          55s       <span class="m">172</span>.17.0.6   minikube
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running   <span class="m">0</span>          55s       <span class="m">172</span>.17.0.7   minikube
</pre></div>


<p>サービス詳細。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">services</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Name</span><span class="p">:</span>                   <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Namespace</span><span class="p">:</span>              <span class="k">default</span>
<span class="n">Labels</span><span class="p">:</span>                 <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Selector</span><span class="p">:</span>               <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Type</span><span class="p">:</span>                   <span class="n">NodePort</span>
<span class="n">IP</span><span class="p">:</span>                     <span class="mf">10.0</span><span class="p">.</span><span class="mf">0.228</span>
<span class="n">Port</span><span class="p">:</span>                   <span class="o">&lt;</span><span class="n">unset</span><span class="o">&gt;</span> <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
<span class="n">NodePort</span><span class="p">:</span>               <span class="o">&lt;</span><span class="n">unset</span><span class="o">&gt;</span> <span class="mi">31123</span><span class="o">/</span><span class="n">TCP</span>
<span class="n">Endpoints</span><span class="p">:</span>              <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.6</span><span class="p">:</span><span class="mi">8080</span><span class="p">,</span><span class="mf">172.17</span><span class="p">.</span><span class="mf">0.7</span><span class="p">:</span><span class="mi">8080</span>
<span class="n">Session</span> <span class="n">Affinity</span><span class="p">:</span>       <span class="n">None</span>
<span class="n">No</span> <span class="n">events</span><span class="p">.</span>
</pre></div>


<h3>アップデート後のアプリにアクセス</h3>
<p>curlでアクセスしてみると出力にv=2と表示され、アップデートされたアプリが利用可能になっていることが確認できました。</p>
<div class="highlight"><pre><span></span>$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-0jd0d <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-0jd0d <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-vnxk1 <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
</pre></div>


<h3>ローリングアップデート後の状態確認</h3>
<p>ローリングアップデートの状態確認。</p>
<div class="highlight"><pre><span></span>$ kubectl rollout status deployments/kubernetes-bootcamp
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> successfully rolled out
</pre></div>


<p>Pod詳細表示。Imageの値が <code>jocatalin/kubernetes-bootcamp:v2</code> と v2になっていることが確認できます。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="mi">0</span><span class="n">jd0d</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">57</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.6</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">7438</span><span class="n">b24d95242018dae9b4e82b93055d772f14650c688203b80204073d67d84b</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">58</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="mi">0</span><span class="n">jd0d</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">7438</span><span class="n">b24d9524</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">7438</span><span class="n">b24d9524</span>


<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">57</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.7</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">54</span><span class="n">c58841abb18466fb0f79636111ef5ff193226f43a5741d1730efeb4689ba58</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">58</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">5</span><span class="n">m</span>            <span class="mi">5</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span>
</pre></div>


<h3>アプリのバージョンアップ失敗の例</h3>
<h4>存在しないタグのイメージにアップデート</h4>
<p>次はv10とタグ付けされたイメージにアップデートを試みます。</p>
<div class="highlight"><pre><span></span>$ kubectl <span class="nb">set</span> image deployments/kubernetes-bootcamp kubernetes-bootcamp<span class="o">=</span>jocatalin/kubernetes-bootcamp:v10
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> image updated
</pre></div>


<p>問題なくアップデートされたように見えますが、実はv10というタグのイメージは存在しないのでエラーになります。</p>
<p>デプロイ一覧のレプリカ数を見ると、DESIREDが2に対してAVAILABLEが1であり希望した状態になっていないことがわかります。</p>
<div class="highlight"><pre><span></span>$ kubectl get deployments
NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
kubernetes-bootcamp   <span class="m">2</span>         <span class="m">3</span>         <span class="m">2</span>            <span class="m">1</span>           1h
</pre></div>


<p>Pods一覧を見ると一部のPodはSTATUSがImagePullBackOffとなっています。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                   READY     STATUS             RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-1951388213-lpc3k   <span class="m">0</span>/1       ImagePullBackOff   <span class="m">0</span>          26s       <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-1951388213-mwx9v   <span class="m">0</span>/1       ImagePullBackOff   <span class="m">0</span>          25s       <span class="m">172</span>.17.0.5   minikube
kubernetes-bootcamp-2100875782-0jd0d   <span class="m">1</span>/1       Terminating        <span class="m">0</span>          10m       <span class="m">172</span>.17.0.6   minikube
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running            <span class="m">0</span>          10m       <span class="m">172</span>.17.0.7   minikube
</pre></div>


<p>間を置いて何度か試していると、STATUSがErrImagePullとなっているときもありました。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                   READY     STATUS             RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-1951388213-lpc3k   <span class="m">0</span>/1       ImagePullBackOff   <span class="m">0</span>          1m        <span class="m">172</span>.17.0.4   minikube
kubernetes-bootcamp-1951388213-mwx9v   <span class="m">0</span>/1       ErrImagePull       <span class="m">0</span>          1m        <span class="m">172</span>.17.0.5   minikube
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running            <span class="m">0</span>          11m       <span class="m">172</span>.17.0.7   minikube
</pre></div>


<p>Pod詳細。
Imageの値が <code>jocatalin/kubernetes-bootcamp:v10</code> であるコンテナのEventsを見ると
<code>Failed to pull image "jocatalin/kubernetes-bootcamp:v10": Tag v10 not found in repository docker.io/jocatalin/kubernetes-bootcamp</code> というエラーがあり、タグv10はレジストリに無かったことがわかります。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span><span class="o">-</span><span class="n">lpc3k</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">43</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">1951388213</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Pending</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v10</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Waiting</span>
      <span class="n">Reason</span><span class="p">:</span>           <span class="n">ImagePullBackOff</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">False</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">False</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">6</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span><span class="o">-</span><span class="n">lpc3k</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">36s</span>             <span class="mi">6</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulling</span>         <span class="n">pulling</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v10&quot;</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">30s</span>             <span class="mi">6</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Warning</span>         <span class="n">Failed</span>          <span class="n">Failed</span> <span class="k">to</span> <span class="n">pull</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v10&quot;</span><span class="p">:</span> <span class="n">Tag</span> <span class="n">v10</span> <span class="k">not</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">repository</span> <span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">30s</span>             <span class="mi">6</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>                                              <span class="n">Warning</span>         <span class="n">FailedSync</span>      <span class="k">Error</span> <span class="n">syncing</span> <span class="n">pod</span><span class="p">,</span> <span class="n">skipping</span><span class="p">:</span> <span class="n">failed</span> <span class="k">to</span> <span class="s">&quot;StartContainer&quot;</span> <span class="k">for</span> <span class="s">&quot;kubernetes-bootcamp&quot;</span> <span class="k">with</span> <span class="n">ErrImagePull</span><span class="p">:</span> <span class="s">&quot;Tag v10 not found in reposit</span>
<span class="s">ory docker.io/jocatalin/kubernetes-bootcamp&quot;</span>

  <span class="mi">6</span><span class="n">m</span>    <span class="mi">2s</span>      <span class="mi">22</span>      <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>  <span class="n">BackOff</span>         <span class="n">Back</span><span class="o">-</span><span class="n">off</span> <span class="n">pulling</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v10&quot;</span>
  <span class="mi">6</span><span class="n">m</span>    <span class="mi">2s</span>      <span class="mi">22</span>      <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>                                              <span class="n">Warning</span> <span class="n">FailedSync</span>      <span class="k">Error</span> <span class="n">syncing</span> <span class="n">pod</span><span class="p">,</span> <span class="n">skipping</span><span class="p">:</span> <span class="n">failed</span> <span class="k">to</span> <span class="s">&quot;StartContainer&quot;</span> <span class="k">for</span> <span class="s">&quot;kubernetes-bootcamp&quot;</span> <span class="k">with</span> <span class="n">ImagePullBackOff</span><span class="p">:</span> <span class="s">&quot;Back-off pulling image \&quot;</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bo</span>
<span class="n">otcamp</span><span class="p">:</span><span class="n">v10</span><span class="o">\</span><span class="s">&quot;&quot;</span>



<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span><span class="o">-</span><span class="n">mwx9v</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">44</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">1951388213</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Pending</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.5</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v10</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Waiting</span>
      <span class="n">Reason</span><span class="p">:</span>           <span class="n">ImagePullBackOff</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">False</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">False</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">6</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span><span class="o">-</span><span class="n">mwx9v</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">2</span><span class="n">m</span>              <span class="mi">5</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulling</span>         <span class="n">pulling</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v10&quot;</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">2</span><span class="n">m</span>              <span class="mi">5</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Warning</span>         <span class="n">Failed</span>          <span class="n">Failed</span> <span class="k">to</span> <span class="n">pull</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v10&quot;</span><span class="p">:</span> <span class="n">Tag</span> <span class="n">v10</span> <span class="k">not</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">repository</span> <span class="n">docker</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
  <span class="mi">6</span><span class="n">m</span>            <span class="mi">2</span><span class="n">m</span>              <span class="mi">5</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>                                              <span class="n">Warning</span>         <span class="n">FailedSync</span>      <span class="k">Error</span> <span class="n">syncing</span> <span class="n">pod</span><span class="p">,</span> <span class="n">skipping</span><span class="p">:</span> <span class="n">failed</span> <span class="k">to</span> <span class="s">&quot;StartContainer&quot;</span> <span class="k">for</span> <span class="s">&quot;kubernetes-bootcamp&quot;</span> <span class="k">with</span> <span class="n">ErrImagePull</span><span class="p">:</span> <span class="s">&quot;Tag v10 not found in repository docker.io/jocatalin/kubernetes-bootcamp&quot;</span>

  <span class="mi">6</span><span class="n">m</span>    <span class="mi">14s</span>     <span class="mi">23</span>      <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>  <span class="n">BackOff</span>         <span class="n">Back</span><span class="o">-</span><span class="n">off</span> <span class="n">pulling</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v10&quot;</span>
  <span class="mi">6</span><span class="n">m</span>    <span class="mi">14s</span>     <span class="mi">23</span>      <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>                                              <span class="n">Warning</span> <span class="n">FailedSync</span>      <span class="k">Error</span> <span class="n">syncing</span> <span class="n">pod</span><span class="p">,</span> <span class="n">skipping</span><span class="p">:</span> <span class="n">failed</span> <span class="k">to</span> <span class="s">&quot;StartContainer&quot;</span> <span class="k">for</span> <span class="s">&quot;kubernetes-bootcamp&quot;</span> <span class="k">with</span> <span class="n">ImagePullBackOff</span><span class="p">:</span> <span class="s">&quot;Back-off pulling image \&quot;</span><span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v10</span><span class="o">\</span><span class="s">&quot;&quot;</span>



<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">57</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.7</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">54</span><span class="n">c58841abb18466fb0f79636111ef5ff193226f43a5741d1730efeb4689ba58</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">58</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">16</span><span class="n">m</span>           <span class="mi">16</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">16</span><span class="n">m</span>           <span class="mi">16</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">16</span><span class="n">m</span>           <span class="mi">16</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">16</span><span class="n">m</span>           <span class="mi">16</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span>
</pre></div>


<h4>v10へのローリングアップデートを中止</h4>
<p>ローリングアップデートをアンドゥします。</p>
<div class="highlight"><pre><span></span>$ kubectl rollout undo deployments/kubernetes-bootcamp$ kubectl rollout undo deployments/kubernetes-bootcamp
deployment <span class="s2">&quot;kubernetes-bootcamp&quot;</span> rolled back
</pre></div>


<p>Pod一覧。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -o wide
NAME                                   READY     STATUS    RESTARTS   AGE       IP           NODE
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running   <span class="m">0</span>          20m       <span class="m">172</span>.17.0.7   minikube
kubernetes-bootcamp-2100875782-x290l   <span class="m">1</span>/1       Running   <span class="m">0</span>          17s       <span class="m">172</span>.17.0.4   minikube
</pre></div>


<p>Pod詳細。</p>
<p>Podのレプリカ数は以前指定した2で、2つのPodともImageが <code>jocatalin/kubernetes-bootcamp:v2</code> とアップデート前のバージョンに戻ったことが確認できました。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> 
<span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">57</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.7</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">54</span><span class="n">c58841abb18466fb0f79636111ef5ff193226f43a5741d1730efeb4689ba58</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">58</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span>


<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">x290l</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">31</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">523d</span><span class="n">ca2d5839e832942af50d52fe8008c16862c19ebed553e50293765f4cf12c</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">32</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span>


<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">x290l</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">31</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">523d</span><span class="n">ca2d5839e832942af50d52fe8008c16862c19ebed553e50293765f4cf12c</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">32</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">1</span><span class="n">m</span>            <span class="mi">1</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">x290l</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">1</span><span class="n">m</span>            <span class="mi">1</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">1</span><span class="n">m</span>            <span class="mi">1</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">523d</span><span class="n">ca2d5839</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">1</span><span class="n">m</span>            <span class="mi">1</span><span class="n">m</span>              <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">523d</span><span class="n">ca2d5839</span>
</pre></div>


<p>curlでアクセスしてみても v2 と表示されています。</p>
<div class="highlight"><pre><span></span>$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-vnxk1 <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-vnxk1 <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-x290l <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-x290l <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
</pre></div>


<h2>Module 4のStep 2: ラベルを付ける</h2>
<p>デプロイの詳細表示。
Labelsにrun=kubernetes-bootcampというのがデフォルトで付いていることがわかります。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">kubectl</span> <span class="n">describe</span> <span class="n">deployment</span>
<span class="n">Name</span><span class="p">:</span>                   <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Namespace</span><span class="p">:</span>              <span class="k">default</span>
<span class="n">CreationTimestamp</span><span class="p">:</span>      <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">41</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>                 <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Selector</span><span class="p">:</span>               <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Replicas</span><span class="p">:</span>               <span class="mi">2</span> <span class="n">updated</span> <span class="err">|</span> <span class="mi">2</span> <span class="n">total</span> <span class="err">|</span> <span class="mi">2</span> <span class="n">available</span> <span class="err">|</span> <span class="mi">0</span> <span class="n">unavailable</span>
<span class="n">StrategyType</span><span class="p">:</span>           <span class="n">RollingUpdate</span>
<span class="n">MinReadySeconds</span><span class="p">:</span>        <span class="mi">0</span>
<span class="n">RollingUpdateStrategy</span><span class="p">:</span>  <span class="mi">1</span> <span class="n">max</span> <span class="n">unavailable</span><span class="p">,</span> <span class="mi">1</span> <span class="n">max</span> <span class="n">surge</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>  <span class="n">Reason</span>
  <span class="o">----</span>          <span class="o">------</span>  <span class="o">------</span>
  <span class="n">Available</span>     <span class="k">True</span>    <span class="n">MinimumReplicasAvailable</span>
<span class="n">OldReplicaSets</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">NewReplicaSet</span><span class="p">:</span>  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="n">replicas</span> <span class="n">created</span><span class="p">)</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                            <span class="n">SubObjectPath</span>   <span class="n">Type</span>            <span class="n">Reason</span>                  <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                            <span class="o">-------------</span>   <span class="o">--------</span>        <span class="o">------</span>                  <span class="o">-------</span>
  <span class="mi">55</span><span class="n">m</span>           <span class="mi">55</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="k">to</span> <span class="mi">4</span>
  <span class="mi">43</span><span class="n">m</span>           <span class="mi">43</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">down</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="k">to</span> <span class="mi">2</span>
  <span class="mi">31</span><span class="n">m</span>           <span class="mi">31</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span> <span class="k">to</span> <span class="mi">1</span>
  <span class="mi">31</span><span class="n">m</span>           <span class="mi">31</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">down</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="k">to</span> <span class="mi">1</span>
  <span class="mi">31</span><span class="n">m</span>           <span class="mi">31</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">down</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">390780338</span> <span class="k">to</span> <span class="mi">0</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span> <span class="k">to</span> <span class="mi">1</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">down</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span> <span class="k">to</span> <span class="mi">1</span>
  <span class="mi">21</span><span class="n">m</span>           <span class="mi">21</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span> <span class="k">to</span> <span class="mi">2</span>
  <span class="mi">31</span><span class="n">m</span>           <span class="mi">11</span><span class="n">m</span>             <span class="mi">2</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span> <span class="k">to</span> <span class="mi">2</span>
  <span class="mi">11</span><span class="n">m</span>           <span class="mi">11</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">DeploymentRollback</span>      <span class="n">Rolled</span> <span class="n">back</span> <span class="n">deployment</span> <span class="s">&quot;kubernetes-bootcamp&quot;</span> <span class="k">to</span> <span class="n">revision</span> <span class="mi">2</span>
  <span class="mi">11</span><span class="n">m</span>           <span class="mi">11</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">deployment</span><span class="o">-</span><span class="n">controller</span> <span class="p">}</span>                        <span class="n">Normal</span>          <span class="n">ScalingReplicaSet</span>       <span class="n">Scaled</span> <span class="n">down</span> <span class="n">replica</span> <span class="k">set</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">1951388213</span> <span class="k">to</span> <span class="mi">0</span>
</pre></div>


<p>指定したラベルを持つPods一覧表示。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -l <span class="nv">run</span><span class="o">=</span>kubernetes-bootcamp
NAME                                   READY     STATUS    RESTARTS   AGE
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running   <span class="m">0</span>          32m
kubernetes-bootcamp-2100875782-x290l   <span class="m">1</span>/1       Running   <span class="m">0</span>          11m
</pre></div>


<p>指定したラベルを持つサービス一覧表示。</p>
<div class="highlight"><pre><span></span>$ kubectl get services -l <span class="nv">run</span><span class="o">=</span>kubernetes-bootcamp
NAME                  CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>          AGE
kubernetes-bootcamp   <span class="m">10</span>.0.0.228   &lt;nodes&gt;       <span class="m">8080</span>:31123/TCP   1h
</pre></div>


<p>Pod名を取得して環境変数POD_NAMEに設定。</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl get pods -o go-template --template <span class="s1">&#39;{{range .items}}{{.metadata.name}}{{&quot;\n&quot;}}{{end}}&#39;</span><span class="k">)</span>
$ <span class="nb">echo</span> Name of the Pod: <span class="nv">$POD_NAME</span>
Name of the Pod: kubernetes-bootcamp-2100875782-vnxk1
</pre></div>


<p>Podにapp=v2というラベルを設定。チュートリアルではapp=v1というラベルを指定していますが、この記事ではバージョンアップ後に実行しているのでapp=v2にします。</p>
<div class="highlight"><pre><span></span>$ kubectl label pod <span class="nv">$POD_NAME</span> <span class="nv">app</span><span class="o">=</span>v2
pod <span class="s2">&quot;kubernetes-bootcamp-2100875782-vnxk1&quot;</span> labeled
pod <span class="s2">&quot;kubernetes-bootcamp-2100875782-x290l&quot;</span> labeled
</pre></div>


<p>Pod詳細表示。
Labelsにapp=v2が付いています。</p>
<div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">describe</span> <span class="n">pods</span> <span class="err">$</span><span class="n">POD_NAME</span>
<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">57</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">app</span><span class="o">=</span><span class="n">v2</span>
                <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.7</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">54</span><span class="n">c58841abb18466fb0f79636111ef5ff193226f43a5741d1730efeb4689ba58</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">58</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">36</span><span class="n">m</span>           <span class="mi">36</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">vnxk1</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">36</span><span class="n">m</span>           <span class="mi">36</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">36</span><span class="n">m</span>           <span class="mi">36</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">36</span><span class="n">m</span>           <span class="mi">36</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">54</span><span class="n">c58841abb1</span>


<span class="n">Name</span><span class="p">:</span>           <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">x290l</span>
<span class="n">Namespace</span><span class="p">:</span>      <span class="k">default</span>
<span class="n">Node</span><span class="p">:</span>           <span class="n">minikube</span><span class="o">/</span><span class="mf">192.168</span><span class="p">.</span><span class="mf">99.100</span>
<span class="n">Start</span> <span class="n">Time</span><span class="p">:</span>     <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">31</span> <span class="o">+</span><span class="mi">0900</span>
<span class="n">Labels</span><span class="p">:</span>         <span class="n">app</span><span class="o">=</span><span class="n">v2</span>
                <span class="n">pod</span><span class="o">-</span><span class="n">template</span><span class="o">-</span><span class="n">hash</span><span class="o">=</span><span class="mi">2100875782</span>
                <span class="n">run</span><span class="o">=</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span>
<span class="n">Status</span><span class="p">:</span>         <span class="n">Running</span>
<span class="n">IP</span><span class="p">:</span>             <span class="mf">172.17</span><span class="p">.</span><span class="mf">0.4</span>
<span class="n">Controllers</span><span class="p">:</span>    <span class="n">ReplicaSet</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span>
<span class="n">Containers</span><span class="p">:</span>
  <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span>
    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>       <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="mi">523d</span><span class="n">ca2d5839e832942af50d52fe8008c16862c19ebed553e50293765f4cf12c</span>
    <span class="n">Image</span><span class="p">:</span>              <span class="n">jocatalin</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">:</span><span class="n">v2</span>
    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>           <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">sha256</span><span class="p">:</span><span class="n">b6556396ebd45c517469c522c3c61ecf5ab708cafe0e59df906278d34c255ef8</span>
    <span class="n">Port</span><span class="p">:</span>               <span class="mi">8080</span><span class="o">/</span><span class="n">TCP</span>
    <span class="n">State</span><span class="p">:</span>              <span class="n">Running</span>
      <span class="n">Started</span><span class="p">:</span>          <span class="n">Sat</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Dec</span> <span class="mi">2016</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">32</span> <span class="o">+</span><span class="mi">0900</span>
    <span class="n">Ready</span><span class="p">:</span>              <span class="k">True</span>
    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>      <span class="mi">0</span>
    <span class="n">Volume</span> <span class="n">Mounts</span><span class="p">:</span>
      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="n">from</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
    <span class="n">Environment</span> <span class="n">Variables</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>          <span class="n">Status</span>
  <span class="n">Initialized</span>   <span class="k">True</span> 
  <span class="n">Ready</span>         <span class="k">True</span> 
  <span class="n">PodScheduled</span>  <span class="k">True</span> 
<span class="n">Volumes</span><span class="p">:</span>
  <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span><span class="p">:</span>
    <span class="n">Type</span><span class="p">:</span>       <span class="n">Secret</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">populated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Secret</span><span class="p">)</span>
    <span class="n">SecretName</span><span class="p">:</span> <span class="k">default</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">qqsb7</span>
<span class="n">QoS</span> <span class="n">Class</span><span class="p">:</span>      <span class="n">BestEffort</span>
<span class="n">Tolerations</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
<span class="n">Events</span><span class="p">:</span>
  <span class="n">FirstSeen</span>     <span class="n">LastSeen</span>        <span class="n">Count</span>   <span class="n">From</span>                    <span class="n">SubObjectPath</span>                           <span class="n">Type</span>            <span class="n">Reason</span>          <span class="n">Message</span>
  <span class="o">---------</span>     <span class="o">--------</span>        <span class="o">-----</span>   <span class="o">----</span>                    <span class="o">-------------</span>                           <span class="o">--------</span>        <span class="o">------</span>          <span class="o">-------</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="k">default</span><span class="o">-</span><span class="n">scheduler</span> <span class="p">}</span>                                            <span class="n">Normal</span>          <span class="n">Scheduled</span>       <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="o">-</span><span class="mi">2100875782</span><span class="o">-</span><span class="n">x290l</span> <span class="k">to</span> <span class="n">minikube</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Pulled</span>          <span class="n">Container</span> <span class="n">image</span> <span class="s">&quot;jocatalin/kubernetes-bootcamp:v2&quot;</span> <span class="n">already</span> <span class="n">present</span> <span class="k">on</span> <span class="n">machine</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Created</span>         <span class="n">Created</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">523d</span><span class="n">ca2d5839</span><span class="err">;</span> <span class="n">Security</span><span class="p">:</span><span class="o">[</span><span class="n">seccomp</span><span class="o">=</span><span class="n">unconfined</span><span class="o">]</span>
  <span class="mi">15</span><span class="n">m</span>           <span class="mi">15</span><span class="n">m</span>             <span class="mi">1</span>       <span class="p">{</span><span class="n">kubelet</span> <span class="n">minikube</span><span class="p">}</span>      <span class="n">spec</span><span class="p">.</span><span class="n">containers</span><span class="p">{</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">bootcamp</span><span class="p">}</span>    <span class="n">Normal</span>          <span class="n">Started</span>         <span class="n">Started</span> <span class="n">container</span> <span class="k">with</span> <span class="n">docker</span> <span class="n">id</span> <span class="mi">523d</span><span class="n">ca2d5839</span>
</pre></div>


<p>今つけたラベルを持つPod一覧表示。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods -l <span class="nv">app</span><span class="o">=</span>v2
NAME                                   READY     STATUS    RESTARTS   AGE
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running   <span class="m">0</span>          40m
kubernetes-bootcamp-2100875782-x290l   <span class="m">1</span>/1       Running   <span class="m">0</span>          19m
</pre></div>


<h2>Module 4のStep 3: サービスを削除</h2>
<div class="highlight"><pre><span></span>$ kubectl delete service -l <span class="nv">run</span><span class="o">=</span>kubernetes-bootcamp
service <span class="s2">&quot;kubernetes-bootcamp&quot;</span> deleted
</pre></div>


<p>サービス一覧を確認すると kubernetes-bootcamp が消えていることがわかります。</p>
<div class="highlight"><pre><span></span>$ kubectl get services
NAME         CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>   AGE
kubernetes   <span class="m">10</span>.0.0.1     &lt;none&gt;        <span class="m">443</span>/TCP   13h
</pre></div>


<p>curlでアクセスすると接続拒否という期待される結果になりました。</p>
<div class="highlight"><pre><span></span>$ curl <span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
curl: <span class="o">(</span><span class="m">7</span><span class="o">)</span> Failed to connect to <span class="m">192</span>.168.99.100 port <span class="m">31123</span>: Connection refused
</pre></div>


<p>Pod一覧を見るとPod自体は存在します。</p>
<div class="highlight"><pre><span></span>$ kubectl get pods
NAME                                   READY     STATUS    RESTARTS   AGE
kubernetes-bootcamp-2100875782-vnxk1   <span class="m">1</span>/1       Running   <span class="m">0</span>          40m
kubernetes-bootcamp-2100875782-x290l   <span class="m">1</span>/1       Running   <span class="m">0</span>          19m
</pre></div>


<p>Podに入ってアクセスするとアプリ自体は引き続き稼働中であることがわかります。</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">POD_NAME</span><span class="o">=</span>kubernetes-bootcamp-2100875782-vnxk1
$ kubectl <span class="nb">exec</span> -ti <span class="nv">$POD_NAME</span> curl localhost:8080
Hello Kubernetes bootcamp! <span class="p">|</span> Running on: kubernetes-bootcamp-2100875782-vnxk1 <span class="p">|</span> <span class="nv">v</span><span class="o">=</span><span class="m">2</span>
</pre></div>


<h2>おわりに</h2>
<p>ローリングアップデートとアップデート失敗時の切り戻しが簡単に行えるのは良いなと思いました。</p>
<p>このチュートリアルはステートレスなアプリケーションの例でしたが、
<a href="http://kubernetes.io/docs/tutorials/">Tutorials - Kubernetes</a>
には Stateful Applications というチュートリアルもあるので、こちらも後日試してみたいです。　</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>