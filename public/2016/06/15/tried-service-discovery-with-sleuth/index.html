<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>sleuthというGoのライブラリでサービスディスカバリを試してみた</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2016/06/15/tried-service-discovery-with-sleuth/" rel="bookmark"
           title="Permalink to sleuthというGoのライブラリでサービスディスカバリを試してみた">sleuthというGoのライブラリでサービスディスカバリを試してみた</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-06-15T06:56:00+09:00">
                Published: 2016-06-15
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/golang.html">golang</a> <a href="../../../../tag/service-discovery.html">service-discovery</a> <a href="../../../../tag/sleuth.html">sleuth</a> </p>
</footer><!-- /.post-info -->      <h2>はじめに</h2>
<p><a href="http://darian.af/post/master-less-peer-to-peer-micro-service-autodiscovery-in-golang-with-sleuth/">Service autodiscovery in Go with sleuth - darian.af</a>という記事を見かけて試してみたのでメモです。</p>
<h2>github.com/ursiform/sleuthのセットアップ</h2>
<p><a href="https://github.com/ursiform/sleuth#installation">Installation</a>を見ながらセットアップします。</p>
<p>いきなりgo getでインストールしてみるとZeroMQ version 4が必要というエラーメッセージが出ました。</p>
<div class="highlight"><pre><span></span>$ go get -u github.com/ursiform/sleuth
<span class="c1"># github.com/pebbe/zmq4</span>
In file included from ../../../pebbe/zmq4/ctxoptions_unix.go:7:0:
zmq4.h:2:2: error: <span class="c1">#error &quot;You need ZeroMQ version 4 to build this&quot;</span>
 <span class="c1">#error &quot;You need ZeroMQ version 4 to build this&quot;</span>
  ^
</pre></div>


<p>Ubuntu 16.04では</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libzmq3</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<p>CentOS 7では</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">zeromq</span><span class="o">-</span><span class="n">devel</span>
</pre></div>


<p>でZeroMQ 4.xのライブラリとヘッダファイルがインストールできます。</p>
<p>このあとで go get でsleuthをインストールすると今度は大丈夫でした。</p>
<div class="highlight"><pre><span></span>$ go get -u github.com/ursiform/sleuth
</pre></div>


<h2>動作確認のためエコーバックのサービスの例を試す</h2>
<p><a href="https://github.com/ursiform/sleuth#examples">Examples</a>のExample (1)にエコーバックのサーバとクライアントがあるのでそれを試します。</p>
<p>コードをコピペするのが面倒な人は</p>
<div class="highlight"><pre><span></span><span class="k">go</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">hnakamur</span><span class="o">/</span><span class="n">sleuth</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">example</span><span class="w"></span>
</pre></div>


<p>で取得できます。</p>
<p>以下のコマンドでプロジェクトのディレクトリに移動します。</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="err">$</span><span class="n">GOPATH</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">hnakamur</span><span class="o">/</span><span class="n">sleuth</span><span class="o">-</span><span class="n">echo</span><span class="o">-</span><span class="n">example</span>
</pre></div>


<p>以下のコマンドでエコーバックのサーバを起動します。</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cd</span><span class="w"> </span><span class="n">echo</span><span class="o">-</span><span class="n">server</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="k">go</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"></span>
</pre></div>


<p>起動すると以下のようなログが出力されます。</p>
<div class="highlight"><pre><span></span><span class="mi">2016</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">15</span> <span class="mi">06</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">06</span> <span class="p">[</span><span class="o">**</span><span class="n">warning</span><span class="o">**</span><span class="p">]</span> <span class="n">sleuth</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="n">Interface</span> <span class="k">not</span> <span class="k">defined</span> <span class="p">[</span><span class="mi">801</span><span class="p">]</span>
<span class="mi">2016</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">15</span> <span class="mi">06</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">06</span> <span class="p">[</span> <span class="n">listening</span> <span class="p">]</span> <span class="n">sleuth</span><span class="p">:</span> <span class="p">[</span><span class="n">SLEUTH</span><span class="o">-</span><span class="n">v0</span><span class="p">:</span><span class="mi">5670</span><span class="p">][</span><span class="n">echo</span><span class="o">-</span><span class="n">service</span> <span class="n">E13055</span><span class="p">]</span>
</pre></div>


<p>以下のコマンドでクライアントを実行し、"It works." と表示されれば成功です。</p>
<div class="highlight"><pre><span></span>$ <span class="o">(</span><span class="nb">cd</span> echo-client <span class="o">&amp;&amp;</span> go run main.go<span class="o">)</span>
It works.
</pre></div>


<p>curlでも試してみます。</p>
<div class="highlight"><pre><span></span>$ curl -s -d Hello <span class="m">127</span>.0.0.1:9873/echo-service/
Hello
</pre></div>


<h2>サービスディスカバリの例を試す</h2>
<div class="highlight"><pre><span></span><span class="k">go</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">afshin</span><span class="o">/</span><span class="n">sleuth</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="p">...</span><span class="w"></span>
</pre></div>


<p>でサンプルのコードと依存するライブラリを取得し</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="err">$</span><span class="n">GOPATH</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">afshin</span><span class="o">/</span><span class="n">sleuth</span><span class="o">-</span><span class="n">example</span>
</pre></div>


<p>でプロジェクトのディレクトリに移動します。</p>
<p>この例にはarticle-serviceとcomment-serviceという2つのサービスが含まれています。</p>
<p>まずは article-service を起動します。article-serviceはポート9872で起動されます。</p>
<div class="highlight"><pre><span></span>$ <span class="ss">(</span><span class="nv">cd</span> <span class="nv">article</span><span class="o">-</span><span class="nv">service</span> <span class="o">&amp;&amp;</span> <span class="nv">go</span> <span class="nv">run</span> <span class="nv">main</span>.<span class="nv">go</span><span class="ss">)</span>
<span class="mi">2016</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">14</span> <span class="mi">22</span>:<span class="mi">38</span>:<span class="mi">08</span> [<span class="o">**</span><span class="nv">warning</span><span class="o">**</span>] <span class="nv">sleuth</span>: <span class="nv">config</span>.<span class="nv">Interface</span> <span class="nv">not</span> <span class="nv">defined</span> [<span class="mi">801</span>]
<span class="mi">2016</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">14</span> <span class="mi">22</span>:<span class="mi">38</span>:<span class="mi">08</span> [ <span class="nv">listening</span> ] <span class="nv">sleuth</span>: [<span class="nv">SLEUTH</span><span class="o">-</span><span class="nv">v0</span>:<span class="mi">5670</span>][<span class="nv">client</span><span class="o">-</span><span class="nv">only</span> <span class="nv">EC740A</span>]
<span class="mi">2016</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">14</span> <span class="mi">22</span>:<span class="mi">38</span>:<span class="mi">08</span> [<span class="o">**</span><span class="nv">blocked</span><span class="o">**</span>] <span class="nv">sleuth</span>: <span class="nv">waiting</span> <span class="k">for</span> <span class="nv">client</span> <span class="nv">to</span> <span class="nv">find</span> [<span class="nv">comment</span><span class="o">-</span><span class="nv">service</span>]
</pre></div>


<p>ログに書かれているようにcomment-serviceが見つからなくて待っている状態です。</p>
<p>別の端末を開いて以下のコマンドを実行してcomment-serviceを起動します。comment-serviceはポート9871で起動されます。</p>
<div class="highlight"><pre><span></span>$ <span class="o">(</span><span class="nb">cd</span> comment-service <span class="o">&amp;&amp;</span> go run main.go<span class="o">)</span>
<span class="m">2016</span>/06/15 <span class="m">07</span>:47:42 <span class="o">[</span>**warning**<span class="o">]</span> sleuth: config.Interface not defined <span class="o">[</span><span class="m">801</span><span class="o">]</span>
<span class="m">2016</span>/06/15 <span class="m">07</span>:47:42 <span class="o">[</span> listening <span class="o">]</span> sleuth: <span class="o">[</span>SLEUTH-v0:5670<span class="o">][</span>comment-service 0DBE04<span class="o">]</span>
ready...
</pre></div>


<p>comment-serviceを起動するとarticle-serviceの端末には以下のログが追加で出力されます。</p>
<div class="highlight"><pre><span></span><span class="mi">2016</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">15</span> <span class="mi">07</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">43</span> <span class="p">[</span><span class="o">*</span><span class="n">unblocked</span><span class="o">*</span><span class="p">]</span> <span class="n">sleuth</span><span class="p">:</span> <span class="n">client</span> <span class="k">found</span> <span class="p">[</span><span class="k">comment</span><span class="o">-</span><span class="n">service</span><span class="p">]</span>
<span class="n">ready</span><span class="p">...</span>
</pre></div>


<p>つまりarticle-serviceがcomment-serviceを発見（サービスディカバリ）出来たということです。</p>
<p>別の端末を開いて以下のコマンドを実行してcurlでarticle-serviceから記事のデータを1件取得してみます。</p>
<div class="highlight"><pre><span></span>$ curl -s localhost:9872/articles/049cd8fc-a66b-4a3d-956b-7c2ab5fb9c5d <span class="p">|</span> jq .
<span class="o">{</span>
  <span class="s2">&quot;success&quot;</span>: true,
  <span class="s2">&quot;data&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;guid&quot;</span>: <span class="s2">&quot;049cd8fc-a66b-4a3d-956b-7c2ab5fb9c5d&quot;</span>,
    <span class="s2">&quot;byline&quot;</span>: <span class="s2">&quot;Kristen Rasmussen&quot;</span>,
    <span class="s2">&quot;headline&quot;</span>: <span class="s2">&quot;Wanting the Unwanted: Why Eat Weeds&quot;</span>,
    <span class="s2">&quot;url&quot;</span>: <span class="s2">&quot;http://www.rootedfood.com/musings/2015/4/1/a-foraged-affair&quot;</span>,
    <span class="s2">&quot;time&quot;</span>: <span class="m">1428168580</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>comment-serviceからコメントのデータを1件取得します。</p>
<div class="highlight"><pre><span></span>$ <span class="nv">curl</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">localhost</span>:<span class="mi">9871</span><span class="o">/</span><span class="nv">comments</span><span class="o">/</span><span class="mi">06500</span><span class="nv">da3</span><span class="o">-</span><span class="nv">f9b0</span><span class="o">-</span><span class="mi">4731</span><span class="o">-</span><span class="nv">b0fa</span><span class="o">-</span><span class="nv">fbc6cbe8c155</span> <span class="o">|</span> <span class="nv">jq</span> .
{
  <span class="s2">&quot;</span><span class="s">success</span><span class="s2">&quot;</span>: <span class="nv">true</span>,
  <span class="s2">&quot;</span><span class="s">data</span><span class="s2">&quot;</span>: [
    {
      <span class="s2">&quot;</span><span class="s">guid</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">d7041752-6854-4b2c-ad6d-1b48d898668d</span><span class="s2">&quot;</span>,
      <span class="s2">&quot;</span><span class="s">article</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">06500da3-f9b0-4731-b0fa-fbc6cbe8c155</span><span class="s2">&quot;</span>,
      <span class="s2">&quot;</span><span class="s">text</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">Star Trek, on the other hand, consistently presents an optimistic view of our capacity for civilization. I love science-fiction, even when it&amp;#x27;s dystopian. But why does so much of it have to be dystopian?</span><span class="s2">&quot;</span>,
      <span class="s2">&quot;</span><span class="s">time</span><span class="s2">&quot;</span>: <span class="mi">1452738329</span>
    }
  ]
}
</pre></div>


<p>次に2つのサービスを連携させた使い方として、以下のコマンドで1件の記事とそれに紐づくコメントを取得します。</p>
<div class="highlight"><pre><span></span>$ <span class="nv">curl</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">localhost</span>:<span class="mi">9872</span><span class="o">/</span><span class="nv">articles</span><span class="o">/</span><span class="mi">049</span><span class="nv">cd8fc</span><span class="o">-</span><span class="nv">a66b</span><span class="o">-</span><span class="mi">4</span><span class="nv">a3d</span><span class="o">-</span><span class="mi">956</span><span class="nv">b</span><span class="o">-</span><span class="mi">7</span><span class="nv">c2ab5fb9c5d</span>?<span class="nv">includecomments</span><span class="o">=</span><span class="nv">true</span> <span class="o">|</span> <span class="nv">jq</span> .
{
  <span class="s2">&quot;</span><span class="s">success</span><span class="s2">&quot;</span>: <span class="nv">true</span>,
  <span class="s2">&quot;</span><span class="s">data</span><span class="s2">&quot;</span>: {
    <span class="s2">&quot;</span><span class="s">guid</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">049cd8fc-a66b-4a3d-956b-7c2ab5fb9c5d</span><span class="s2">&quot;</span>,
    <span class="s2">&quot;</span><span class="s">byline</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">Kristen Rasmussen</span><span class="s2">&quot;</span>,
    <span class="s2">&quot;</span><span class="s">comments</span><span class="s2">&quot;</span>: [
      {
        <span class="s2">&quot;</span><span class="s">guid</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">1b1e937b-8521-4c88-a13c-105d421ea030</span><span class="s2">&quot;</span>,
        <span class="s2">&quot;</span><span class="s">article</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">049cd8fc-a66b-4a3d-956b-7c2ab5fb9c5d</span><span class="s2">&quot;</span>,
        <span class="s2">&quot;</span><span class="s">text</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">I believe the premise to be false, while it is true that you can eat many different &amp;quot;weeds&amp;quot; I cannot find any methodology or theory where that doing so increases the efficiency of land use. There are some key things like nutrients in == nutrie</span>
<span class="nv">nts</span> <span class="nv">out</span> <span class="nv">and</span> <span class="nv">digestibility</span> <span class="nv">in</span> <span class="nv">humans</span> <span class="nv">which</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">a</span> <span class="nv">given</span>.<span class="o">&lt;</span><span class="nv">p</span><span class="o">&gt;</span><span class="nv">That</span> <span class="nv">said</span>, <span class="nv">there</span> <span class="nv">were</span> <span class="nv">some</span> <span class="nv">interesting</span> <span class="nv">recipes</span> <span class="k">for</span> <span class="nv">what</span> <span class="nv">are</span> <span class="nv">nominally</span> <span class="nv">weeds</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">Foxfire</span>[<span class="mi">1</span>], <span class="nv">and</span> <span class="nv">Euell</span> <span class="nv">Gibbons</span> <span class="nv">books</span>[<span class="mi">2</span>] <span class="nv">which</span> <span class="nv">were</span> <span class="nv">certainly</span> <span class="nv">edible</span> <span class="nv">although</span> <span class="nv">nothing</span> <span class="nv">I</span><span class="o">&amp;</span>#<span class="nv">x27</span><span class="c1">;ve tried really struck me as excepti</span>
<span class="nv">onal</span>. <span class="nv">As</span> <span class="nv">Boy</span> <span class="nv">Scouts</span> <span class="nv">we</span> <span class="nv">got</span> <span class="nv">a</span> <span class="nv">merit</span> <span class="nv">badge</span> <span class="k">for</span> <span class="nv">creating</span> <span class="nv">a</span> <span class="nv">meal</span> <span class="nv">out</span> <span class="nv">of</span> <span class="nv">locally</span> <span class="nv">harvested</span> <span class="nv">plants</span>, <span class="nv">that</span> <span class="nv">was</span> <span class="nv">fun</span>.<span class="o">&lt;</span><span class="nv">p</span><span class="o">&gt;</span>[<span class="mi">1</span>] <span class="o">&lt;</span><span class="nv">a</span> <span class="nv">href</span><span class="o">=</span>\<span class="s2">&quot;</span><span class="s">http:&amp;#x2F;&amp;#x2F;www.foxfire.org&amp;#x2F;thefoxfirebooks.aspx\</span><span class="s2">&quot;</span> <span class="nv">rel</span><span class="o">=</span>\<span class="s2">&quot;</span><span class="s">nofollow\</span><span class="s2">&quot;</span><span class="o">&gt;</span><span class="nv">http</span>:<span class="o">&amp;</span>#<span class="nv">x2F</span><span class="c1">;&amp;#x2F;www.foxfire.org&amp;#x2F;thefoxfirebooks.aspx&lt;/a&gt;&lt;p&gt;[2]</span>
 <span class="o">&lt;</span><span class="nv">a</span> <span class="nv">href</span><span class="o">=</span>\<span class="s2">&quot;</span><span class="s">http:&amp;#x2F;&amp;#x2F;www.amazon.com&amp;#x2F;Euell-Gibbons-Handbook-Edible-Plants&amp;#x2F;dp&amp;#x2F;0915442787\</span><span class="s2">&quot;</span> <span class="nv">rel</span><span class="o">=</span>\<span class="s2">&quot;</span><span class="s">nofollow\</span><span class="s2">&quot;</span><span class="o">&gt;</span><span class="nv">http</span>:<span class="o">&amp;</span>#<span class="nv">x2F</span><span class="c1">;&amp;#x2F;www.amazon.com&amp;#x2F;Euell-Gibbons-Handbook-Edible-Plants&amp;#x2F;d...&lt;/a&gt;&quot;,</span>
        <span class="s2">&quot;</span><span class="s">time</span><span class="s2">&quot;</span>: <span class="mi">1428172888</span>
      },
      {
        <span class="s2">&quot;</span><span class="s">guid</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">1ffa59ea-1b62-41fe-87c3-98ec6901d768</span><span class="s2">&quot;</span>,
        <span class="s2">&quot;</span><span class="s">article</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">049cd8fc-a66b-4a3d-956b-7c2ab5fb9c5d</span><span class="s2">&quot;</span>,
        <span class="s2">&quot;</span><span class="s">text</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">Something to keep in mind here is that once a viable market is found then the product will be fully commercialised and mass-produced.  No longer will poor conditions be good enough when compared to the yield you get from ideal conditions.&lt;p&gt;Then we will</span>
 <span class="nv">start</span> <span class="nv">fertilising</span> <span class="nv">them</span>, <span class="k">then</span> <span class="nv">tweaking</span> <span class="nv">the</span> <span class="nv">seeds</span> <span class="nv">etc</span> <span class="nv">etc</span> <span class="nv">etc</span>. <span class="nv">And</span> <span class="nv">before</span> <span class="nv">long</span> <span class="nv">it</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">just</span> <span class="nv">like</span> <span class="nv">anything</span> <span class="k">else</span> <span class="nv">grown</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">land</span>.<span class="s2">&quot;</span><span class="s">,</span>
        <span class="s2">&quot;</span><span class="s">time</span><span class="s2">&quot;</span>: <span class="mi">1428188859</span>
      },
…<span class="ss">(</span>略<span class="ss">)</span>…
        <span class="s2">&quot;</span><span class="s">guid</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">587b528f-f4fe-4620-959e-f0d087c97348</span><span class="s2">&quot;</span>,
        <span class="s2">&quot;</span><span class="s">article</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">049cd8fc-a66b-4a3d-956b-7c2ab5fb9c5d</span><span class="s2">&quot;</span>,
        <span class="s2">&quot;</span><span class="s">text</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">The premise that weeds are a suitable food for humans is wrong. Most of these plants are loaded with toxins. You can&amp;#x27;t eat them in any quantity for calories without getting poisoned.&lt;p&gt;Cows and goats and sheep can eat these things, though, because </span>
<span class="nv">they</span> <span class="nv">have</span> <span class="nv">more</span> <span class="nv">advanced</span> <span class="nv">digestive</span> <span class="nv">systems</span>. <span class="nv">The</span> <span class="nv">udder</span> <span class="nv">provides</span> <span class="nv">an</span> <span class="nv">added</span> <span class="nv">toxin</span> <span class="nv">filtration</span> <span class="nv">system</span>.<span class="o">&lt;</span><span class="nv">p</span><span class="o">&gt;</span><span class="nv">In</span> <span class="nv">theory</span> <span class="nv">you</span> <span class="nv">might</span> <span class="nv">be</span> <span class="nv">able</span> <span class="nv">to</span> <span class="nv">design</span> <span class="nv">an</span> <span class="nv">efficient</span> <span class="nv">system</span> <span class="nv">to</span> <span class="nv">detoxify</span> <span class="nv">wild</span> <span class="nv">plants</span> <span class="nv">such</span> <span class="nv">as</span> <span class="nv">grass</span> <span class="nv">and</span> <span class="nv">weeds</span> <span class="nv">directly</span> <span class="nv">into</span> <span class="nv">a</span> <span class="nv">high</span> <span class="nv">quality</span> <span class="nv">human</span> <span class="nv">food</span>. <span class="nv">At</span> <span class="nv">this</span> <span class="nv">moment</span> <span class="nv">cheese</span> <span class="nv">is</span> 
<span class="nv">already</span> <span class="nv">an</span> <span class="nv">incredibly</span> <span class="nv">effective</span> <span class="nv">way</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">wild</span> <span class="nv">forage</span> <span class="nv">to</span> <span class="nv">make</span> <span class="nv">human</span> <span class="nv">food</span>.<span class="s2">&quot;</span><span class="s">,</span>
        <span class="s2">&quot;</span><span class="s">time</span><span class="s2">&quot;</span>: <span class="mi">1428192718</span>
      }
    ],
    <span class="s2">&quot;</span><span class="s">headline</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">Wanting the Unwanted: Why Eat Weeds</span><span class="s2">&quot;</span>,
    <span class="s2">&quot;</span><span class="s">url</span><span class="s2">&quot;</span>: <span class="s2">&quot;</span><span class="s">http://www.rootedfood.com/musings/2015/4/1/a-foraged-affair</span><span class="s2">&quot;</span>,
    <span class="s2">&quot;</span><span class="s">time</span><span class="s2">&quot;</span>: <span class="mi">1428168580</span>
  }
}
</pre></div>


<h2>sleuthのQ &amp; Aを見てみる</h2>
<p><a href="https://github.com/ursiform/sleuth#q--a">Q &amp; A</a>を見ると、sleuthのメッセージプロトコルはJSONをgzipしてHTTPで通信しているとのことです。Protocol Buffersなどの他のライブラリに依存するのを避けたいという意図で、マイクロサービスのAPIレスポンスのほとんどは小さいのでJSONをgzipする方式で十分だし、そのほうがGo以外の言語でも利用しやすいので良いだろうということです。</p>
<p>sleuthは熊のグループの集合名詞とのことです。</p>
<h2>おわりに</h2>
<p>sleuthはzeromqとGoさえあれば使えるということでセットアップが簡単です。</p>
<p>サービスの実装<a href="https://github.com/afshin/sleuth-example/blob/master/article-service/main.go">sleuth-example/main.go</a>と<a href="https://github.com/afshin/sleuth-example/blob/master/comment-service/main.go">sleuth-example/main.go</a>も、Goで普通にウェブサービスを実装したところに、sleuthを使うためのコードを少し足すだけでいいのでお手軽でいいですね。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>