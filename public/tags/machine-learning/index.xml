<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Machine Learning on hnakamur&#39;s blog at github</title>
    <link>https://hnakamur.github.io/blog/tags/machine-learning/index.xml</link>
    <description>Recent content in Machine Learning on hnakamur&#39;s blog at github</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <atom:link href="https://hnakamur.github.io/blog/tags/machine-learning/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>GeForce搭載の旧モデルMacBook ProでCaffeをビルドする手順メモ</title>
      <link>https://hnakamur.github.io/blog/2015/07/26/build_caffe_on_macbook_with_geforce/</link>
      <pubDate>Sun, 26 Jul 2015 00:53:52 +0900</pubDate>
      
      <guid>https://hnakamur.github.io/blog/2015/07/26/build_caffe_on_macbook_with_geforce/</guid>
      <description>

&lt;h2 id=&#34;はじめに&#34;&gt;はじめに&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://hnakamur.github.io/blog/blog/2015/07/25/setup_cuda_on_macbook_pro_with_geforce/&#34;&gt;GeForce搭載の旧モデルMacBook ProでCUDAをセットアップする手順のメモ&lt;/a&gt;でCUDA 7.0.29をインストールしたMacBook Proで&lt;a href=&#34;http://caffe.berkeleyvision.org/&#34;&gt;Caffe | Deep Learning Framework&lt;/a&gt;をビルドしてみた手順メモです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://pypi.python.org/pypi?%3Aaction=search&amp;amp;term=caffe&amp;amp;submit=search&#34;&gt;PyPIでCaffeで検索&lt;/a&gt;しても出てこないので、ソースからビルドするしかないようです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://caffe.berkeleyvision.org/install_osx.html&#34;&gt;OS X Installation&lt;/a&gt;を参考にしつつ、一部手順を変更してインストールしました。&lt;/p&gt;

&lt;h2 id=&#34;caffeはpython3非対応&#34;&gt;CaffeはPython3非対応&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://qiita.com/icoxfog417/items/65e800c3a2094457c3a0&#34;&gt;Python - はじめるDeep learning - Qiita&lt;/a&gt;で紹介されていた&lt;a href=&#34;https://github.com/BVLC/caffe/issues/293&#34;&gt;Python3 support · Issue #293 · BVLC/caffe&lt;/a&gt;によると、オフィシャルでPython3対応の予定はないとのこと。Python3でも動かないこともないそうですが、初心者なのでまずはPython2で動かすことにします。&lt;/p&gt;

&lt;h2 id=&#34;依存ライブラリのインストール&#34;&gt;依存ライブラリのインストール&lt;/h2&gt;

&lt;p&gt;依存するライブラリを以下のコマンドでインストールしました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;brew install -vd snappy leveldb gflags glog szip lmdb
brew tap homebrew/science
brew install hdf5 opencv
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;protobufのインストール&#34;&gt;protobufのインストール&lt;/h3&gt;

&lt;p&gt;以下のコマンドでprotobufをインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;brew install protobuf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://caffe.berkeleyvision.org/install_osx.html&#34;&gt;OS X Installation&lt;/a&gt;の手順では &lt;code&gt;--with-python&lt;/code&gt; オプションを指定していますが、 &lt;code&gt;brew info protobuf&lt;/code&gt; で確認すると2.6.1用のformulaでは &lt;code&gt;--with-python&lt;/code&gt; オプションは無くなって代わりに &lt;code&gt;--without-python&lt;/code&gt; オプションが出来ていました。何も指定しなければpythonサポートが入るようです。&lt;/p&gt;

&lt;p&gt;なお、インストール完了時に以下のメッセージが出ますが、後でvirtualenvで作った環境内で &lt;code&gt;pip install protobuf&lt;/code&gt; すればいけるので、ここに書かれている対応は不要でした。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;==&amp;gt; Caveats
Editor support and examples have been installed to:
  /usr/local/Cellar/protobuf/2.6.1/share/doc/protobuf

Python modules have been installed and Homebrew&#39;s site-packages is not
in your Python sys.path, so you will not be able to import the modules
this formula installed. If you plan to develop with these modules,
please run:
  mkdir -p
  echo &#39;import site; site.addsitedir(&amp;quot;/usr/local/lib/python2.7/site-packages&amp;quot;)&#39; &amp;gt;&amp;gt; homebrew.pth
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;boost-1-57-0-boost-python-1-57-0-のインストール&#34;&gt;boost 1.57.0, boost-python 1.57.0 のインストール&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;brew install boost boost-python&lt;/code&gt; だと1.58.0が入ったのですが、Caffeのビルド時にコンパイルエラーが出ました。&lt;a href=&#34;http://itinerantbioinformaticist.blogspot.jp/2015/05/caffe-incompatible-with-boost-1580.html&#34;&gt;Itinerant Bioinformaticist: Caffe incompatible with Boost 1.58.0&lt;/a&gt;と同じエラーですが、ここに回避方法も書かれていたので、これに従いました。&lt;/p&gt;

&lt;p&gt;まず、boost 1.58.0, boost-python 1.58.0が入っている場合はアンインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;brew uninstall boost boost-python
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以下の手順で1.57.0をソースからインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cd `brew --prefix`/Library/Formula
curl -O https://raw.githubusercontent.com/Homebrew/homebrew/6fd6a9b6b2f56139a44dd689d30b7168ac13effb/Library/Formula/boost.rb
curl -O https://raw.githubusercontent.com/Homebrew/homebrew/3141234b3473717e87f3958d4916fe0ada0baba9/Library/Formula/boost-python.rb
brew install --build-from-source -vd boost boost-python
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;python2でvirtualenvで作業用の環境を作成して依存ライブラリをインストール&#34;&gt;Python2でvirtualenvで作業用の環境を作成して依存ライブラリをインストール&lt;/h2&gt;

&lt;p&gt;個人的にはAnaconda Pythonのようなオールインワンのインストーラはあまり好きではないので、&lt;a href=&#34;https://github.com/riywo/anyenv&#34;&gt;riywo/anyenv&lt;/a&gt;と&lt;a href=&#34;https://github.com/yyuu/pyenv&#34;&gt;yyuu/pyenv&lt;/a&gt;で入れたPython 2.7.10を使いました。&lt;/p&gt;

&lt;p&gt;作業用のディレクトリ &lt;code&gt;~/work/caffe&lt;/code&gt; を作ってvirtualenvで環境を作りました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mkdir -p ~/work/caffe
cd !$
pyenv local 2.7.10
virtualenv venv
source venv/bin/activate
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;HomebrewでインストールしたPython 2.7.10でも &lt;code&gt;pyenv local 2.7.10&lt;/code&gt; の行を除けば同じ手順で行けました。&lt;/p&gt;

&lt;p&gt;Caffeで必要なprotobufとnumpyを以下の手順でインストールします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pip install protobuf
pip install numpy
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;caffeのソースを取得してビルド&#34;&gt;Caffeのソースを取得してビルド&lt;/h2&gt;

&lt;p&gt;ソースを取得してディレクトリに入ります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cd ~/work/caffe
git clone https://github.com/BVLC/caffe
cd caffe
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://caffe.berkeleyvision.org/installation.html#compilation&#34;&gt;Installation&lt;/a&gt;を参考にビルドします。virtualenv環境のincludeとlibディレクトリを参照するように以下のように加工してMakefile.configを作成します。Caffeのソースを違うディレクトリに配置した場合は適宜変更してください。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sed &#39;
s|/usr/include/python2.7|$(HOME)/work/caffe/venv/include/python2.7|
s|/usr/lib/python2.7/dist-packages|$(HOME)/work/caffe/venv/lib/python2.7/site-packages|
&#39; Makefile.config.example &amp;gt; Makefile.config
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Caffeをビルドします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;make all
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;テストコードをビルドします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;make test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;テストを実行します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(venv)$ make runtest
...(略)...
[----------] Global test environment tear-down
[==========] 1356 tests from 214 test cases ran. (306870 ms total)
[  PASSED  ] 1356 tests.

  YOU HAVE 2 DISABLED TESTS

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ということで、Caffeをビルドする手順でした。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>