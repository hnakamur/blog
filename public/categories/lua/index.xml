<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Lua on hnakamur&#39;s blog at github</title>
    <link>https://hnakamur.github.io/blog/categories/lua/index.xml</link>
    <description>Recent content in Lua on hnakamur&#39;s blog at github</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <atom:link href="https://hnakamur.github.io/blog/categories/lua/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>lua, V8, ruby, mrubyでfib(39)の実行時間比較</title>
      <link>https://hnakamur.github.io/blog/2013/03/12/fib-39-benchmark-in-luajit/</link>
      <pubDate>Tue, 12 Mar 2013 00:00:00 +0000</pubDate>
      
      <guid>https://hnakamur.github.io/blog/2013/03/12/fib-39-benchmark-in-luajit/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://hnakamur.github.com/blog/2012/05/04/fib-39-benchmark-in-lua/&#34;&gt;lua, V8, ruby, mrubyでfib(39)の実行時間比較 - hnakamur&amp;rsquo;s blog at github&lt;/a&gt;が&lt;a href=&#34;https://twitter.com/yukihiro_matz&#34;&gt;@matz&lt;/a&gt;さんにツイートされたのを受けて、各処理系の最新版で再度試してみました。&lt;/p&gt;

&lt;h2 id=&#34;テスト環境その1-前回とは違う環境です&#34;&gt;テスト環境その1（前回とは違う環境です）&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Model: MacBook Pro Retina, Mid 2012&lt;/li&gt;
&lt;li&gt;CPU: 2.6GHz Intel Core i7&lt;/li&gt;
&lt;li&gt;RAM: 16GB 1600MHz DDR3&lt;/li&gt;
&lt;li&gt;OS: Mac OS X 10.8.2&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2013-03-24-追記&#34;&gt;2013-03-24 追記&lt;/h3&gt;

&lt;p&gt;goでも試してみました&lt;/p&gt;

&lt;h3 id=&#34;go-1-0-3&#34;&gt;go 1.0.3&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;package main

import &amp;quot;fmt&amp;quot;

func fib(n int) int {
  if n &amp;lt; 2 {
    return n
  }
  return fib(n - 1) + fib(n - 2)
}

func main() {
  fmt.Println(fib(39))
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ time fib39
63245986

real    0m0.484s
user    0m0.481s
sys     0m0.002s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;lua&#34;&gt;lua&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;function fib(n)
  if n &amp;lt; 2 then
    return n
  end
  return fib(n-2) + fib(n-1)
end

print(fib(39))
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ luajit -v
LuaJIT 2.0.1 -- Copyright (C) 2005-2013 Mike Pall. http://luajit.org/
$ time luajit fib.lua
63245986

real  0m0.906s
user  0m0.901s
sys 0m0.003s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ lua -v
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time lua fib.lua
63245986

real  0m12.278s
user  0m12.271s
sys 0m0.006s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ src/lua -v
Lua 5.2.1  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~/bench/fib.lua
63245986

real  0m13.971s
user  0m13.965s
sys 0m0.005s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;v8&#34;&gt;v8&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;function fib(n) {
  if (n &amp;lt; 2) return n;
  return fib(n-2) + fib(n-1);
}

print(fib(39));
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ v8
V8 version 3.16.14 [sample shell]
&amp;gt; ^D
$ time v8 fib.js
63245986

real  0m0.804s
user  0m0.798s
sys 0m0.008s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ruby&#34;&gt;ruby&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;def fib n
  return n if n &amp;lt; 2
  fib(n-2) + fib(n-1)
end

puts fib(39)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ git log -1 | grep commit
commit 46d8c51763bd13b69a4234f0d4be05cbfd8ae401

$ time bin/mruby fib.rb
63245986

real  0m16.357s
user  0m16.345s
sys 0m0.008s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p374 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real  0m16.225s
user  0m16.169s
sys 0m0.043s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p392 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real  0m36.813s
user  0m36.746s
sys 0m0.043s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
2.0.0-p0 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb 
63245986

real  0m31.828s
user  0m31.743s
sys 0m0.045s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;2013-03-12-23-15-追記&#34;&gt;2013-03-12 23:15 追記&lt;/h3&gt;

&lt;p&gt;1.9.3-p374と1.9.3-p392でこんなに違うのは変だなと思って、1.9.3-p374を入れなおして再度測ってみました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p374 (set by /Users/hnakamur/.rbenv/version)
$ time ruby ~/bench/fib.rb 
63245986

real  0m38.909s
user  0m38.834s
sys 0m0.045s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以前1.9.3-p374を入れた時から、XCodeのバージョンが変わっているので、コンパイラが違うせいで大幅に時間が変わったようです。&lt;/p&gt;

&lt;h2 id=&#34;テスト環境その2&#34;&gt;テスト環境その2&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://hnakamur.github.com/blog/2012/05/04/fib-39-benchmark-in-lua/&#34;&gt;lua, V8, ruby, mrubyでfib(39)の実行時間比較 - hnakamur&amp;rsquo;s blog at github&lt;/a&gt;と同じマシンです。
OSはLionのままですがアップデートはしています。XCodeもバージョンアップしました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Model: MacBook Air 13-inch, Mid 2011&lt;/li&gt;
&lt;li&gt;CPU: 1.7GHz Intel Core i5&lt;/li&gt;
&lt;li&gt;RAM: 4GB 1333MHz DDR3&lt;/li&gt;
&lt;li&gt;OS: Mac OS X Lion 10.7.5&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;lua-1&#34;&gt;lua&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ src/luajit -v
LuaJIT 2.0.1 -- Copyright (C) 2005-2013 Mike Pall. http://luajit.org/
$ time src/luajit ~/fib_bench/fib.lua
63245986

real    0m1.268s
user    0m1.256s
sys     0m0.003s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ cd ../lua-5.2.1
$ src/lua -v
Lua 5.2.1  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~/fib_bench/fib.lua
63245986

real    0m20.299s
user    0m20.299s
sys     0m0.006s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ src/lua -v
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~/fib_bench/fib.lua
63245986

real    0m20.100s
user    0m20.089s
sys     0m0.012s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;v8-1&#34;&gt;V8&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ v8
V8 version 3.16.14 [sample shell]
&amp;gt; ^D

$ time v8 fib.js
63245986

real    0m1.105s
user    0m1.099s
sys     0m0.011s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ruby-1&#34;&gt;ruby&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p194 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real    0m23.462s
user    0m23.431s
sys     0m0.039s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;この1.9.3-p194は以前のXCodeでビルドしたものです。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p392 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real    0m51.765s
user    0m51.679s
sys     0m0.048s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
2.0.0-p0 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real    0m47.074s
user    0m47.048s
sys     0m0.045s
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;テスト環境その3&#34;&gt;テスト環境その3&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Model: NEC Express5800/S70 type RB&lt;/li&gt;
&lt;li&gt;CPU: Intel Pentium G6950 (2.8GHz)&lt;/li&gt;
&lt;li&gt;RAM: 16GB DDR3-1333&lt;/li&gt;
&lt;li&gt;OS: CentOS 6.4 x86_64&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;lua-2&#34;&gt;lua&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ luajit -v
LuaJIT 2.0.1 -- Copyright (C) 2005-2013 Mike Pall. http://luajit.org/
$ time luajit fib.lua
63245986

real  0m1.244s
user  0m1.241s
sys 0m0.000s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ src/lua -v
Lua 5.2.1  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~hnakamur/fib_bench/fib.lua 
63245986

real  0m15.804s
user  0m15.774s
sys 0m0.002s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ time src/lua ~hnakamur/fib_bench/fib.lua 
63245986

real  0m15.658s
user  0m15.627s
sys 0m0.002s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;v8-2&#34;&gt;V8&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ ./out/x64.release/d8   
V8 version 3.16.14 [console: dumb]
d8&amp;gt; 
Segmentation fault
$ time ./out/x64.release/d8 ~hnakamur/fib_bench/fib.js
63245986

real  0m1.311s
user  0m1.314s
sys 0m0.004s
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ruby-2&#34;&gt;ruby&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p374 (set by /usr/local/rbenv/version)
$ time ruby fib.rb
63245986

real  0m40.485s
user  0m40.365s
sys 0m0.038s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p392 (set by /usr/local/rbenv/version)
$ time ruby fib.rb
63245986

real  0m38.841s
user  0m38.749s
sys 0m0.013s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
2.0.0-p0 (set by /usr/local/rbenv/version)
$ time ruby fib.rb 
63245986

real  0m32.491s
user  0m32.410s
sys 0m0.014s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ git log -1|grep commit
commit f63cd331da6257f9b44778dabff60be55b0721fa
$ time bin/mruby ~hnakamur/fib_bench/fib.rb 
63245986

real  0m20.752s
user  0m20.713s
sys 0m0.002s
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>lua, V8, ruby, mrubyでfib(39)の実行時間比較 2013-03-12版</title>
      <link>https://hnakamur.github.io/blog/2012/05/04/fib-39-benchmark-in-lua/</link>
      <pubDate>Fri, 04 May 2012 00:00:00 +0000</pubDate>
      
      <guid>https://hnakamur.github.io/blog/2012/05/04/fib-39-benchmark-in-lua/</guid>
      <description>

&lt;p&gt;2013-03-13追記&lt;/p&gt;

&lt;p&gt;この記事が&lt;a href=&#34;https://twitter.com/yukihiro_matz&#34;&gt;@matz&lt;/a&gt;さんにツイートされたのを受けて、各処理系の最新版で再度試してみました。
&lt;a href=&#34;http://hnakamur.github.com/blog/2013/03/12/fib-39-benchmark-in-luajit/&#34;&gt;lua, V8, ruby, mrubyでfib(39)の実行時間比較 2013-03-12版&lt;/a&gt;をご参照ください。&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;&lt;a href=&#34;http://www.quredo.net/2012/04/mruby-%E8%BB%BD%E9%87%8Fruby-%E3%82%BD%E3%83%BC%E3%82%B9%E5%85%AC%E9%96%8B/&#34;&gt;mruby (軽量ruby) ソース公開 | quredo-style&lt;/a&gt;を見て、自分の環境でlua, luajit, V8, ruby, mrubyで試してみた。&lt;/p&gt;

&lt;p&gt;テスト環境&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Model: MacBook Air 13-inch, Mid 2011&lt;/li&gt;
&lt;li&gt;CPU: 1.7GHz Intel Core i5&lt;/li&gt;
&lt;li&gt;RAM: 4GB 1333MHz DDR3&lt;/li&gt;
&lt;li&gt;OS: Mac OS X Lion 10.7.3&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;lua&#34;&gt;lua&lt;/h2&gt;

&lt;p&gt;fib.lua&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;function fib(n)
  if n &amp;lt; 2 then
    return n
  end
  return fib(n-2) + fib(n-1)
end

print(fib(39))
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ lua -v
Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
$ time lua fib.lua
63245986

real	0m21.368s
user	0m21.345s
sys	0m0.016s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ ./lua -v
Lua 5.2.0  Copyright (C) 1994-2011 Lua.org, PUC-Rio
$ time ./lua fib.lua
63245986

real	0m19.603s
user	0m19.585s
sys	0m0.012s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ ./luajit -v
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
LuaJIT 1.1.8  Copyright (C) 2005-2012 Mike Pall, http://luajit.org/
$ time ./luajit fib.lua
63245986

real	0m4.302s
user	0m4.292s
sys	0m0.006s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ luajit -v
LuaJIT 2.0.0-beta9 -- Copyright (C) 2005-2011 Mike Pall. http://luajit.org/
$ time luajit fib.lua
63245986

real	0m1.299s
user	0m1.289s
sys	0m0.004s
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;v8&#34;&gt;V8&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;function fib(n) {
  if (n &amp;lt; 2) return n;
  return fib(n-2) + fib(n-1);
}

print(fib(39));
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ v8
V8 version 3.9.24 [sample shell]
&amp;gt; quit()
$ time v8 fib.js
63245986

real	0m1.417s
user	0m1.407s
sys	0m0.013s
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ruby&#34;&gt;ruby&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;def fib n
  return n if n &amp;lt; 2
  fib(n-2) + fib(n-1)
end

puts fib(39)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.8.7-p358 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real	1m47.227s
user	1m46.945s
sys	0m0.132s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ rbenv version
1.9.3-p125 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real	0m16.504s
user	0m16.374s
sys	0m0.051s
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;$ time bin/mruby fib.rb 
63245986

real	0m35.465s
user	0m35.423s
sys	0m0.014s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;[2012-05-03 23:21]&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>