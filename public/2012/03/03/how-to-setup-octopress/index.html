<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>octopressでgithubにブログ開設</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2012/03/03/how-to-setup-octopress/" rel="bookmark"
           title="Permalink to octopressでgithubにブログ開設">octopressでgithubにブログ開設</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-03-03T00:00:00+09:00">
                Published: 2012-03-03
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/octopress.html">octopress</a> </p>
</footer><!-- /.post-info -->      <p>rbenvとoctopressをインストールしてgithubにブログを作る手順のメモです。</p>
<h2>rbenvをインストール</h2>
<ul>
<li><a href="https://github.com/sstephenson/rbenv#section_2.1">sstephenson/rbenv</a></li>
<li><a href="https://github.com/sstephenson/ruby-build">sstephenson/ruby-build</a></li>
</ul>
<p>を参考にインストールしました。</p>
<p>インストール先は~/.rbenvとしました。</p>
<div class="highlight"><pre><span></span>cd
git clone git://github.com/sstephenson/rbenv.git .rbenv

echo &#39;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&#39; &gt;&gt; .bash_profile
echo &#39;eval &quot;$(rbenv init -)&quot;&#39; &gt;&gt; .bash_profile

. ~/.bash_profile
</pre></div>


<p>ruby-buildをインストールします。なお、私はHomebrewを使っているので/usr/localには書き込み権限をつけてあります。</p>
<div class="highlight"><pre><span></span>cd
git clone git://github.com/sstephenson/ruby-build.git
cd ruby-build
./install.sh
</pre></div>


<p>rbenvでruby 1.9.2-p290をインストール。</p>
<div class="highlight"><pre><span></span>rbenv install 1.9.2-p290
</pre></div>


<div class="highlight"><pre><span></span>$ rbenv versions
* <span class="m">1</span>.9.2-p290 <span class="o">(</span><span class="nb">set</span> by /Users/hnakamur/octopress/.rbenv-version<span class="o">)</span>
</pre></div>


<p>でインストールされたrubyがrbenvで認識されたことを確認。</p>
<div class="highlight"><pre><span></span>rbenv global 1.9.2-p290
</pre></div>


<p>で切替。</p>
<div class="highlight"><pre><span></span>$ which ruby
/Users/hnakamur/.rbenv/shims/ruby
$ ruby --version
ruby <span class="m">1</span>.9.2p290 <span class="o">(</span><span class="m">2011</span>-07-09 revision <span class="m">32553</span><span class="o">)</span> <span class="o">[</span>x86_64-darwin11.3.0<span class="o">]</span>
</pre></div>


<h2>octopressでgitにブログをセットアップ</h2>
<p><a href="http://octopress.org/docs/deploying/github/">Deploying to Github Pages - Octopress</a>
を参考にセットアップしました。</p>
<p>ここでは~/octopressを作業ディレクトリとしました。</p>
<div class="highlight"><pre><span></span>cd
git clone git://github.com/imathis/octopress.git octopre
cd octopress
ruby --version
gem install bundler
rbenv rehash
rake install
</pre></div>


<p>ブラウザでgithubを開き、自分のアカウント(私の場合はhnakamur)でblogというプロジェクトを作ります。ブラウザで https://github.com/hnakamur/blog を開き、"Next steps:"に</p>
<div class="highlight"><pre><span></span>git remote add origin git@github.com:hnakamur/blog.git
</pre></div>


<p>と書かれている行のgitのURL(ここではgit@github.com:hnakamur/blog.git)をコピーします。</p>
<p>その後</p>
<div class="highlight"><pre><span></span>rake setup_github_pages
</pre></div>


<p>を実行し、"Enter the read/write url for your repository:"というプロンプトが出たらURLを貼り付けます。</p>
<div class="highlight"><pre><span></span>Enter the read/write url for your repository: git@github.com:hnakamur/blog.git
</pre></div>


<div class="highlight"><pre><span></span>vi _config.yml
</pre></div>


<p>ブログタイトルなどを編集します。
``` text _config.yml
url: http://hnakamur.github.com/blog
title: "hnakamur's blog at github"
subtitle: my trial and error log
author: Hiroaki Nakamura
…(略)…
date_format: "%Y-%m-%d"
…(略)…</p>
<div class="highlight"><pre><span></span>さらに
``` text _config.yml (before edit)
permalink: /blog/:year/:month/:day/:title/
…(略)…
category_dir: blog/categories
…(略)…
titlecase: true       # Converts page and post titles to titlecase
</pre></div>


<p>を以下のように変更します。
``` text _config.yml (before edit)
permalink: /:year/:month/:day/:title/
…(略)…
category_dir: categories
…(略)…
titlecase: false      # Converts page and post titles to titlecase</p>
<div class="highlight"><pre><span></span>これは記事のパーマリンクやカテゴリページのURLが/blog/blog/…のようになってしまうのを/blog/…のようにするためです。

またタイトルの先頭を大文字にするのもオフにしています。

なお、アーカイブのページのURLは/blog/blog/archiveになってしまっていますが、変更方法をまだ見つけられていません。

## 記事の作成と投稿
</pre></div>


<p>rake new_post['Hello, octopress!']</p>
<div class="highlight"><pre><span></span>と実行すると、最後に
</pre></div>


<p>Creating new post: source/_posts/2012-03-03-hello.markdown</p>
<div class="highlight"><pre><span></span>と作成されたファイルが表示されます。

エディタでこのファイルを開いて記事を書きます。
</pre></div>


<p>vi source/_posts/2012-03-03-hello.markdown</p>
<div class="highlight"><pre><span></span>
</pre></div>


<hr>
<p>layout: post
title: "Hello, octopress!"
date: 2012-03-03
comments: true
categories: octopress</p>
<hr>
<p>octopressでブログ記事を投稿してみるテスト。</p>
<div class="highlight"><pre><span></span>
</pre></div>


<p>rake generate</p>
<div class="highlight"><pre><span></span>でHTMLが生成されます。
</pre></div>


<p>rake preview</p>
<div class="highlight"><pre><span></span>を実行して、ブラウザで
http://localhost:4000/blog/
を開くと、プレビューできます。
</pre></div>


<p>rake deploy</p>
<div class="highlight"><pre><span></span>でgithubにプッシュされ、10分ぐらい待つと
http://hnakamur.github.com/blog/
に記事のページで作られました。

時間がかかるのは初回にgithub pagesを作るときだけで、次回以降は即座に作られました。

## 記事のソースをgithubにプッシュ

リモートの設定にoriginを追加して、そこをデフォルトのブランチに設定。
</pre></div>


<p>git remote add origin git@github.com:hnakamur/blog.git
git config branch.master.remote origin</p>
<div class="highlight"><pre><span></span>設定の変更と生成されたソースをコミット、プッシュします。
</pre></div>


<p>git add .
git commit -m 'Modify config. Add source and sass'
git push origin HEAD:source</p>
<div class="highlight"><pre><span></span>github上でのブランチ名をsourceではなくmasterにしてよければ、単に
</pre></div>


<p>git push</p>
<div class="highlight"><pre><span></span>でOKです。

## ローカルのApacheでプレビュー

Apacheは事前にセットアップ済みという前提で、プレビュー用の設定を追加します。
</pre></div>


<p>sudo vi /etc/apache2/other/blog.conf</p>
<div class="highlight"><pre><span></span>と実行して、以下の内容で作成します(hnakamurの部分は自分のアカウント名で置換してください)。
</pre></div>


<p>Alias /blog /Users/hnakamur/octopress/public/blog
<Directory /Users/hnakamur/octopress/public/blog>
    AllowOverride None
  DirectoryIndex index.html
    Order allow,deny
    Allow from all
</Directory></p>
<div class="highlight"><pre><span></span>
</pre></div>


<p>sudo apachectl restart</p>
<div class="highlight"><pre><span></span>でApacheを再起動します。

これ以降は記事を編集してrake generateだけ実行すれば [http://localhost/blog/](http://localhost/blog/) を開いてプレビューできます。

## 今回のはまりポイント

### YAMLで文字列を&quot;&quot;で囲む必要があった
</pre></div>


<p>$ rake generate
(in /Users/hnakamur/octopress)</p>
<h2>Generating Site with Jekyll</h2>
<p>unchanged sass/screen.scss
/Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/1.9.1/psych.rb:148:in <code>parse': couldn't parse YAML at line 16 column 13 (Psych::SyntaxError)
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/1.9.1/psych.rb:148:in</code>parse_stream'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/1.9.1/psych.rb:119:in <code>parse'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/1.9.1/psych.rb:106:in</code>load'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/1.9.1/psych.rb:205:in <code>load_file'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/gems/1.9.1/gems/jekyll-0.11.0/lib/jekyll.rb:119:in</code>configuration'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/gems/1.9.1/gems/jekyll-0.11.0/bin/jekyll:207:in <code>&lt;top (required)&gt;'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/gems/1.9.1/bin/jekyll:19:in</code>load'
    from /Users/hnakamur/.rbenv/versions/1.9.2-p290/lib/ruby/gems/1.9.1/bin/jekyll:19:in `<main>'</p>
<div class="highlight"><pre><span></span>_config.ymlの
</pre></div>


<p>date_format: %Y-%m-%dT%k:%M:%S%z</p>
<div class="highlight"><pre><span></span>を
</pre></div>


<p>date_format: "%Y-%m-%dT%k:%M:%S%z"</p>
<div class="highlight"><pre><span></span>と修正して再実行したらOKでした。


### git push origin sourceでエラー
</pre></div>


<p>$ git push origin source
error: src refspec source does not match any.
error: failed to push some refs to 'git@github.com:hnakamur/blog.git'</p>
<div class="highlight"><pre><span></span>ググって [Error when &quot;git push&quot; to github - Stack Overflow](http://stackoverflow.com/questions/959477/error-when-git-push-to-github) を発見。
</pre></div>


<p>git push origin HEAD:source
```
にしたらOK。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>