<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <title>lua, V8, ruby, mrubyでfib(39)の実行時間比較 &middot; hnakamur&#39;s blog at github</title>
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css'>
        <link rel="stylesheet" href="https://hnakamur.github.io/blog//libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="https://hnakamur.github.io/blog//css/liquorice.css" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="alternate" href="" type="application/rss+xml" title="hnakamur&#39;s blog at github" />
        
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', "UA-53263855-1", 'auto');
    ga('send', 'pageview');
</script>




    </head>
    <body class="li-body">

<header class="li-page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="https://hnakamur.github.io/blog/">hnakamur&#39;s blog at github</a></div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                </ul>
            </div>
        </div>
    </div>
</header>


    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">lua, V8, ruby, mrubyでfib(39)の実行時間比較</h1>
                        <time class="li-article-date">2013-03-12</time>
                    </header>
                    <section>
                        

<p><a href="http://hnakamur.github.com/blog/2012/05/04/fib-39-benchmark-in-lua/">lua, V8, ruby, mrubyでfib(39)の実行時間比較 - hnakamur&rsquo;s blog at github</a>が<a href="https://twitter.com/yukihiro_matz">@matz</a>さんにツイートされたのを受けて、各処理系の最新版で再度試してみました。</p>

<h2 id="テスト環境その1-前回とは違う環境です">テスト環境その1（前回とは違う環境です）</h2>

<ul>
<li>Model: MacBook Pro Retina, Mid 2012</li>
<li>CPU: 2.6GHz Intel Core i7</li>
<li>RAM: 16GB 1600MHz DDR3</li>
<li>OS: Mac OS X 10.8.2</li>
</ul>

<h3 id="2013-03-24-追記">2013-03-24 追記</h3>

<p>goでも試してみました</p>

<h3 id="go-1-0-3">go 1.0.3</h3>

<pre><code>package main

import &quot;fmt&quot;

func fib(n int) int {
  if n &lt; 2 {
    return n
  }
  return fib(n - 1) + fib(n - 2)
}

func main() {
  fmt.Println(fib(39))
}
</code></pre>

<pre><code>$ time fib39
63245986

real    0m0.484s
user    0m0.481s
sys     0m0.002s
</code></pre>

<h3 id="lua">lua</h3>

<pre><code>function fib(n)
  if n &lt; 2 then
    return n
  end
  return fib(n-2) + fib(n-1)
end

print(fib(39))
</code></pre>

<pre><code>$ luajit -v
LuaJIT 2.0.1 -- Copyright (C) 2005-2013 Mike Pall. http://luajit.org/
$ time luajit fib.lua
63245986

real  0m0.906s
user  0m0.901s
sys 0m0.003s
</code></pre>

<pre><code>$ lua -v
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time lua fib.lua
63245986

real  0m12.278s
user  0m12.271s
sys 0m0.006s
</code></pre>

<pre><code>$ src/lua -v
Lua 5.2.1  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~/bench/fib.lua
63245986

real  0m13.971s
user  0m13.965s
sys 0m0.005s
</code></pre>

<h3 id="v8">v8</h3>

<pre><code>function fib(n) {
  if (n &lt; 2) return n;
  return fib(n-2) + fib(n-1);
}

print(fib(39));
</code></pre>

<pre><code>$ v8
V8 version 3.16.14 [sample shell]
&gt; ^D
$ time v8 fib.js
63245986

real  0m0.804s
user  0m0.798s
sys 0m0.008s
</code></pre>

<h3 id="ruby">ruby</h3>

<pre><code>def fib n
  return n if n &lt; 2
  fib(n-2) + fib(n-1)
end

puts fib(39)
</code></pre>

<pre><code>$ git log -1 | grep commit
commit 46d8c51763bd13b69a4234f0d4be05cbfd8ae401

$ time bin/mruby fib.rb
63245986

real  0m16.357s
user  0m16.345s
sys 0m0.008s
</code></pre>

<pre><code>$ rbenv version
1.9.3-p374 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real  0m16.225s
user  0m16.169s
sys 0m0.043s
</code></pre>

<pre><code>$ rbenv version
1.9.3-p392 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real  0m36.813s
user  0m36.746s
sys 0m0.043s
</code></pre>

<pre><code>$ rbenv version
2.0.0-p0 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb 
63245986

real  0m31.828s
user  0m31.743s
sys 0m0.045s
</code></pre>

<h3 id="2013-03-12-23-15-追記">2013-03-12 23:15 追記</h3>

<p>1.9.3-p374と1.9.3-p392でこんなに違うのは変だなと思って、1.9.3-p374を入れなおして再度測ってみました。</p>

<pre><code>$ rbenv version
1.9.3-p374 (set by /Users/hnakamur/.rbenv/version)
$ time ruby ~/bench/fib.rb 
63245986

real  0m38.909s
user  0m38.834s
sys 0m0.045s
</code></pre>

<p>以前1.9.3-p374を入れた時から、XCodeのバージョンが変わっているので、コンパイラが違うせいで大幅に時間が変わったようです。</p>

<h2 id="テスト環境その2">テスト環境その2</h2>

<p><a href="http://hnakamur.github.com/blog/2012/05/04/fib-39-benchmark-in-lua/">lua, V8, ruby, mrubyでfib(39)の実行時間比較 - hnakamur&rsquo;s blog at github</a>と同じマシンです。
OSはLionのままですがアップデートはしています。XCodeもバージョンアップしました。</p>

<ul>
<li>Model: MacBook Air 13-inch, Mid 2011</li>
<li>CPU: 1.7GHz Intel Core i5</li>
<li>RAM: 4GB 1333MHz DDR3</li>
<li>OS: Mac OS X Lion 10.7.5</li>
</ul>

<h3 id="lua-1">lua</h3>

<pre><code>$ src/luajit -v
LuaJIT 2.0.1 -- Copyright (C) 2005-2013 Mike Pall. http://luajit.org/
$ time src/luajit ~/fib_bench/fib.lua
63245986

real    0m1.268s
user    0m1.256s
sys     0m0.003s
</code></pre>

<pre><code>$ cd ../lua-5.2.1
$ src/lua -v
Lua 5.2.1  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~/fib_bench/fib.lua
63245986

real    0m20.299s
user    0m20.299s
sys     0m0.006s
</code></pre>

<pre><code>$ src/lua -v
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~/fib_bench/fib.lua
63245986

real    0m20.100s
user    0m20.089s
sys     0m0.012s
</code></pre>

<h3 id="v8-1">V8</h3>

<pre><code>$ v8
V8 version 3.16.14 [sample shell]
&gt; ^D

$ time v8 fib.js
63245986

real    0m1.105s
user    0m1.099s
sys     0m0.011s
</code></pre>

<h3 id="ruby-1">ruby</h3>

<pre><code>$ rbenv version
1.9.3-p194 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real    0m23.462s
user    0m23.431s
sys     0m0.039s
</code></pre>

<p>この1.9.3-p194は以前のXCodeでビルドしたものです。</p>

<pre><code>$ rbenv version
1.9.3-p392 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real    0m51.765s
user    0m51.679s
sys     0m0.048s
</code></pre>

<pre><code>$ rbenv version
2.0.0-p0 (set by /Users/hnakamur/.rbenv/version)
$ time ruby fib.rb
63245986

real    0m47.074s
user    0m47.048s
sys     0m0.045s
</code></pre>

<h2 id="テスト環境その3">テスト環境その3</h2>

<ul>
<li>Model: NEC Express5800/S70 type RB</li>
<li>CPU: Intel Pentium G6950 (2.8GHz)</li>
<li>RAM: 16GB DDR3-1333</li>
<li>OS: CentOS 6.4 x86_64</li>
</ul>

<h3 id="lua-2">lua</h3>

<pre><code>$ luajit -v
LuaJIT 2.0.1 -- Copyright (C) 2005-2013 Mike Pall. http://luajit.org/
$ time luajit fib.lua
63245986

real  0m1.244s
user  0m1.241s
sys 0m0.000s
</code></pre>

<pre><code>$ src/lua -v
Lua 5.2.1  Copyright (C) 1994-2012 Lua.org, PUC-Rio
$ time src/lua ~hnakamur/fib_bench/fib.lua 
63245986

real  0m15.804s
user  0m15.774s
sys 0m0.002s
</code></pre>

<pre><code>$ time src/lua ~hnakamur/fib_bench/fib.lua 
63245986

real  0m15.658s
user  0m15.627s
sys 0m0.002s
</code></pre>

<h3 id="v8-2">V8</h3>

<pre><code>$ ./out/x64.release/d8   
V8 version 3.16.14 [console: dumb]
d8&gt; 
Segmentation fault
$ time ./out/x64.release/d8 ~hnakamur/fib_bench/fib.js
63245986

real  0m1.311s
user  0m1.314s
sys 0m0.004s
</code></pre>

<h3 id="ruby-2">ruby</h3>

<pre><code>$ rbenv version
1.9.3-p374 (set by /usr/local/rbenv/version)
$ time ruby fib.rb
63245986

real  0m40.485s
user  0m40.365s
sys 0m0.038s
</code></pre>

<pre><code>$ rbenv version
1.9.3-p392 (set by /usr/local/rbenv/version)
$ time ruby fib.rb
63245986

real  0m38.841s
user  0m38.749s
sys 0m0.013s
</code></pre>

<pre><code>$ rbenv version
2.0.0-p0 (set by /usr/local/rbenv/version)
$ time ruby fib.rb 
63245986

real  0m32.491s
user  0m32.410s
sys 0m0.014s
</code></pre>

<pre><code>$ git log -1|grep commit
commit f63cd331da6257f9b44778dabff60be55b0721fa
$ time bin/mruby ~hnakamur/fib_bench/fib.rb 
63245986

real  0m20.752s
user  0m20.713s
sys 0m0.002s
</code></pre>

                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <a href="https://hnakamur.github.io"><strong>Hiroaki Nakamura</strong></a>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="https://hnakamur.github.io/blog/2013/04/03/how-to-setup-vagrant-1-dot-1-5-and-sahara/"> Vagrant 1.1.5とSaharaを試した</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="https://hnakamur.github.io/blog/2013/03/02/multi-series-line-chart-example-with-tooltip-using-d3-dot-js/"> d3.jsを使ったツールチップあり複数折れ線グラフのサンプルを作った</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2012-2017. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="http://github.com/hnakamur/liquorice-hn/">liquorice-hn</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script type="text/javascript">
    <!--
    function toggle(id) {
        var e = document.getElementById(id);
        e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
    }
    
    </script>

    </body>
</html>

