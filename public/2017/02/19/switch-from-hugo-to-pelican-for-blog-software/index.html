<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.133.1">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ブログのソフトウェアをHugoからPelicanに切り替えた &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMMXGG2Z56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMMXGG2Z56');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2024. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>ブログのソフトウェアをHugoからPelicanに切り替えた</h1>
  <time datetime=2017-02-19T23:20:00&#43;0900 class="post-date">2017-02-19</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#シンタクスハイライト用のcss追加">シンタクスハイライト用のCSS追加</a></li>
      </ul>
    </li>
    <li><a href="#トップページの内容を記事一覧に変更">トップページの内容を記事一覧に変更</a></li>
    <li><a href="#幅を広げる">幅を広げる</a></li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p><a href="https://gohugo.io/">Hugo</a> はビルドも速くて快適に使わせてもらっていました。ただ、コードブロックのシンタクスハイライトを使いたいと思って <a href="https://gohugo.io/extras/highlighting/">Syntax Highlighting</a> を読んだときにHugo独自の記法に依存するのが好ましくないなと思いました。Markdownには拡張の仕組みがないので仕方ないのですが。以前から <a href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> を使うようにしたいと思いつつ使えてなかったので、この機会に reStructuredText を使ってブログを書くようにしたいと思いました。</p>
<p>Hugoにも <a href="https://github.com/spf13/hugo/issues/1436">Add support for native Go implementation of reStructuredText (reST) · Issue #1436 · spf13/hugo</a> というイシューがあったのですが、まだ先は長そうな感じです。 また <a href="https://gohugo.io/extras/highlighting/">Syntax Highlighting</a> を見るとシンタクスハイライトで行番号を付けたい場合は <a href="http://pygments.org/">Pygments</a> というPythonで書かれたパッケージを使うということがわかりました。 それと reStructuredText 関連もGoよりPythonのほうが充実しています。</p>
<p>ということで、 Python で reStructuredText を扱えるブログパッケージを探してみると <a href="https://blog.getpelican.com/">Pelican Static Site Generator, Powered by Python</a> というのが見つかったので、これに乗り換えました。</p>
<p>この記事は乗り換えた時の作業メモと今後の記事を書く時の私用の手順メモです。</p>
<h1 id="pelicanのインストール">Pelicanのインストール</h1>
<p>CentOS 7環境を作りました。 <a href="https://ius.io/">IUS</a> のレポジトリから python36u パッケージをインストールした状態で以下のコマンドでインストールしました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">python3.6 -m venv venv
</span></span></span><span class="line"><span class="cl"><span class="go">source venv/bin/activate
</span></span></span><span class="line"><span class="cl"><span class="go">pip install pelican pygments ghp-import
</span></span></span></code></pre></div><p>その後 <a href="https://github.com/hnakamur/blog/"><code>pip freeze &gt; pip_requirements.txt`` してあるので、後から </code>hnakamur/blog: hnakamur&rsquo;s blog at github</a> を <code>git clone</code> したときは以下の手順で構築できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">python3.6 -m venv venv
</span></span></span><span class="line"><span class="cl"><span class="go">source venv/bin/activate
</span></span></span><span class="line"><span class="cl"><span class="go">pip install -r pip_requirements.txt
</span></span></span></code></pre></div><h1 id="設定">設定</h1>
<p>私は Octporess → Hugo → Pelican と移行しているので記事のURLがそのままになるように設定を調整しました。</p>
<p><a href="https://github.com/hnakamur/blog/blob/47217f6dc80d6148f9c9265014dee85e0b0f8408/pelicanconf.py#L43-L47">pelicanconf.py#L43-L47</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RELATIVE_URLS</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">ARTICLE_URL</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{slug}</span><span class="s1">/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">ARTICLE_SAVE_AS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{slug}</span><span class="s1">/index.html&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">PAGE_URL</span> <span class="o">=</span> <span class="s1">&#39;pages/</span><span class="si">{slug}</span><span class="s1">/&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">PAGE_SAVE_AS</span> <span class="o">=</span> <span class="s1">&#39;pages/</span><span class="si">{slug}</span><span class="s1">/index.html&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>他にも、日付のフォーマット、出力先ディレクトリ名、Google Analyticsの設定などを行っています。</p>
<h1 id="記事のメタ情報書き変え">記事のメタ情報書き変え</h1>
<p>Pelican は Markdown と reStructuredText の両方が扱えるので、既存のMarkdownの記事は流用することにしました。
ただし作成日などのメタ情報は <a href="http://docs.getpelican.com/en/stable/content.html#file-metadata">File metadata</a> の形式に合わせる必要があります。
そこでPythonでその場限りのスクリプト <a href="https://github.com/hnakamur/blog/blob/47217f6dc80d6148f9c9265014dee85e0b0f8408/hugo2pelican.py">hugo2pelican.py</a> を書いて変換しました。</p>
<p>その後 slug の値に <a href="https://github.com/hnakamur/blog/blob/47217f6dc80d6148f9c9265014dee85e0b0f8408/hugo2pelican2.py"><code>blog/`` が入っていたのを削るため </code>hugo2pelican2.py</a> で更に変換しました。
本来はデータを戻してスクリプトを書き変えて再実行するのが良いのですが、変換後にコミットしたりタグを手動修正したりしていたので、追加で変換しました。</p>
<h1 id="テーマのカスタマイズ">テーマのカスタマイズ</h1>
<p>デフォルトのテーマ <code>notmyidea</code> のディレクトリ <code>venv/lib/python3.6/site-packages/pelican/themes/notmyidea</code> を <code>themes</code> ディレクトリ以下に <code>notmyidea-custom</code>  という名前に変えてコピーしカスタマイズしました。</p>
<h3 id="シンタクスハイライト用のcss追加">シンタクスハイライト用のCSS追加</h3>
<p><a href="https://github.com/hnakamur/blog/blob/47217f6dc80d6148f9c9265014dee85e0b0f8408/themes/notmyidea-custom/static/css/pygment.css#L1-L12">themes/notmyidea-custom/static/css/pygment.css#L1-L12</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">highlighttable</span> <span class="n">td</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="n">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">highlighttable</span> <span class="n">td</span><span class="o">.</span><span class="n">linenos</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="n">width</span><span class="p">:</span> <span class="mi">4</span><span class="n">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">highlighttable</span> <span class="n">td</span><span class="o">.</span><span class="n">linenos</span> <span class="n">pre</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">highlighttable</span> <span class="n">pre</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="n">margin</span><span class="p">:</span> <span class="mi">4</span><span class="n">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="トップページの内容を記事一覧に変更">トップページの内容を記事一覧に変更</h2>
<p>Hugoを使っていた時はトップページは記事一覧にしていたので、テンプレートを大幅に書き変えて同じような内容にしました。
<a href="https://github.com/hnakamur/blog/commit/b59771b74408a71fae78a7a0d32fcd5348c6867e#diff-a88c508419b8e3db74c1a64be7f9d96f">Adjust theme for article list · hnakamur/blog@b59771b</a></p>
<p>Pelicanは テンプレートエンジンとして <a href="http://jinja.pocoo.org/docs/2.9/">Jinja2</a> を使っています。
Ansibleでも使っていて私は慣れているのでさくっと変更できました。</p>
<h2 id="幅を広げる">幅を広げる</h2>
<p>文章メインのブログでは元のテーマのほうが読みやすいと思いますが、コードブロックはなるべく幅を広くしておきたいので調整しました。
<a href="https://github.com/hnakamur/blog/commit/b6fba1ec659b53d38254d843e46ee396b64a7499#diff-a88c508419b8e3db74c1a64be7f9d96f">Modify theme to widen nav to 940px and content to 900px · hnakamur/blog@b6fba1e</a></p>
<h1 id="記事を書く手順">記事を書く手順</h1>
<p>以下のコマンドを実行して、 <code>content</code> ディレクトリ以下のファイルに変更を検知したらサイトのHTMLを自動生成するようにします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">source venv/bin/activate
</span></span></span><span class="line"><span class="cl"><span class="go">pelican -r content
</span></span></span></code></pre></div><p>別の端末で以下のコマンドを実行して開発サーバを起動してプレビューできるようにしておきます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">source venv/bin/activate
</span></span></span><span class="line"><span class="cl"><span class="go">(cd public &amp;&amp; python -m pelican.server)
</span></span></span></code></pre></div><p>この状態で <code>contents/YYYY/MM/DD/my-super-title.rst</code> という形式でファイルを作って編集します。
件名とメタ情報を <a href="http://docs.getpelican.com/en/stable/content.html#file-metadata">File metadata</a> の reStructuredText の形式で書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rst" data-lang="rst"><span class="line"><span class="cl"><span class="gh">My super title</span>
</span></span><span class="line"><span class="cl"><span class="gh">##############</span>
</span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nc">:date:</span> <span class="nf">2017-02-19 23:20</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nc">:modified:</span> <span class="nf">2017-02-20 16:34</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nc">:tags:</span> <span class="nf">thats, awesome</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nc">:category:</span> <span class="nf">blog</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="nc">:slug:</span> <span class="nf">YYYY/MM/DD/my-super-title</span><span class="err">
</span></span></span></code></pre></div><p>保存する度に自動生成が動きます。
<a href="http://vps.sakura.ad.jp/">さくらのVPS</a> の1Gプランの環境で記事数119で12秒前後かかります。
Hugoのときに比べると長いですが、許容範囲です。</p>
<p><a href="http://pygments.org/docs/lexers/"><code>code-block`` によるとシンタクスハイライトで使える言語一覧は </code>Available lexers — Pygments</a> にあります。</p>
<p>記事を書き終わったら、以下のコマンドを実行して変更をコミットします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">git add .
</span></span></span><span class="line"><span class="cl"><span class="go">git commit -v
</span></span></span></code></pre></div><p>実際はbashのエイリアスと <code>~/.gitconfig</code> でサブコマンドもエイリアスを付けているので以下の通りです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">g a .
</span></span></span><span class="line"><span class="cl"><span class="go">g ci
</span></span></span></code></pre></div><h1 id="記事をgithub-pagesに公開">記事をGitHub Pagesに公開</h1>
<p><a href="http://docs.getpelican.com/en/stable/tips.html?highlight=github%20pages#publishing-to-github">Publishing to GitHub</a> に説明があります。
私は Hugo のときに使っていた <code>deploy.sh</code> を以下のように書き変えました。</p>
<p><a href="https://github.com/hnakamur/blog/blob/47217f6dc80d6148f9c9265014dee85e0b0f8408/deploy.sh">deploy.sh</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> -e <span class="s2">&#34;\033[0;32mDeploying updates to GitHub...\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pelican content
</span></span><span class="line"><span class="cl">ghp-import public
</span></span><span class="line"><span class="cl">git push origin master gh-pages
</span></span></code></pre></div><p>今まで通り以下のコマンドで公開できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">./deploy.sh
</span></span></span></code></pre></div>
</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>
  </body>
</html>
