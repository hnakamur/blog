<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.133.1">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>video.jsのHLSライブラリを試してみた &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMMXGG2Z56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMMXGG2Z56');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2024. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>video.jsのHLSライブラリを試してみた</h1>
  <time datetime=2017-03-21T14:52:00&#43;0900 class="post-date">2017-03-21</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#動画ファイルの分割">動画ファイルの分割</a></li>
    <li><a href="#aacのエンコーダの選択">AACのエンコーダの選択</a></li>
    <li><a href="#ブラウザの幅に応じて動画の解像度自動選択">ブラウザの幅に応じて動画の解像度自動選択</a>
      <ul>
        <li></li>
        <li><a href="#video-タグの幅が640pxより大きいの時のアクセスログ"><code>video</code> タグの幅が640pxより大きいの時のアクセスログ</a></li>
      </ul>
    </li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p><a href="http://qiita.com/gabby-gred/items/c1a3dbe026f83dd7e1ff">MPEG DASHを知る - Qiita</a> を見て、HTML5のvideoタグでHLSと <a href="https://github.com/Dash-Industry-Forum/dash.js">Dash-Industry-Forum/dash.js: A reference client implementation for the playback of MPEG DASH via Javascript and compliant browsers.</a> でMPEG DASHを試してみたところ、各ブラウザの対応状況は以下のような感じでした。</p>
<ul>
<li>iOSのSafari, iOSのChrome, Microsoft EdgeはHLSのみ対応。</li>
<li>WindowsのChrome, FirefoxはMPEG DASHのみ対応。</li>
</ul>
<p>いちいち動画を2セット用意するのは大変だよなーと思っていたら、 <a href="https://github.com/videojs/video.js">videojs/video.js: Video.js - open source HTML5 &amp; Flash video player</a> 用に <a href="https://github.com/videojs/videojs-contrib-hls">videojs/videojs-contrib-hls: HLS library for video.js</a> というライブラリがあるのを見つけたので試してみました。</p>
<p>結論を先に書いておくと、上記の環境全てで無事に再生できました。</p>
<h2 id="動画ファイルの分割">動画ファイルの分割</h2>
<p>YouTube で <code>license:cc0</code> で検索して見つけた `Creative Commons licences explained - YouTube](<a href="https://www.youtube.com/watch?v=4ZvJGV6YF6Y">https://www.youtube.com/watch?v=4ZvJGV6YF6Y</a>) をFirefoxの <a href="https://addons.mozilla.org/ja/firefox/addon/video-downloadhelper/">Video DownloadHelper :: Add-ons for Firefox</a> で1280x720と640x480のmp4ファイルをダウンロードして試してみました。</p>
<p>分割にはUbuntu 16.04のffmpeg 2.8.11-0ubuntu0.16.04.1を使いました。</p>
<p>1280x720の動画は <a href="http://stackoverflow.com/questions/35444324/ffmpeg-hls-video-transcoding-generating-partial-playlist/35452686#35452686">FFMpeg HLS Video Transcoding Generating Partial Playlist - Stack Overflow</a> を参考に以下のようにして分割しました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">destdir=1280x720
</span></span></span><span class="line"><span class="cl"><span class="go">mkdir -p &#34;$destdir&#34;
</span></span></span><span class="line"><span class="cl"><span class="go">ffmpeg -y \
</span></span></span><span class="line"><span class="cl"><span class="go"> -i Creative-Commons-licences-explained-1280x720.mp4 \
</span></span></span><span class="line"><span class="cl"><span class="go"> -codec copy \
</span></span></span><span class="line"><span class="cl"><span class="go"> -bsf h264_mp4toannexb \
</span></span></span><span class="line"><span class="cl"><span class="go"> -map 0 \
</span></span></span><span class="line"><span class="cl"><span class="go"> -f segment \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_time 10 \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_format mpegts \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_list &#34;$destdir/playlist.m3u8&#34; \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_list_type m3u8 \
</span></span></span><span class="line"><span class="cl"><span class="go"> &#34;$destdir/segment%03d.ts&#34;
</span></span></span></code></pre></div><p>640x480の動画は同様にして実行すると以下のエラーが出ました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">Failed to open bitstream filter h264_mp4toannexb for stream 0 with codec copy: Invalid argument
</span></span></span><span class="line"><span class="cl"><span class="go">[mpegts @ 0x121e2c0] AAC bitstream not in ADTS format and extradata missing
</span></span></span><span class="line"><span class="cl"><span class="go">av_interleaved_write_frame(): Invalid data found when processing input
</span></span></span><span class="line"><span class="cl"><span class="go">frame=  302 fps=0.0 q=-1.0 Lsize=N/A time=00:00:12.21 bitrate=N/A    
</span></span></span><span class="line"><span class="cl"><span class="go">video:566kB audio:143kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: unknown
</span></span></span><span class="line"><span class="cl"><span class="go">Conversion failed!
</span></span></span></code></pre></div><p>エラーの内容はよくわかってないですが、対処療法としては音声だけ再エンコードすると分割できました。
オプションはググって見つけた <a href="http://qiita.com/joker1007/items/def9d58ddb00fafc936d">HTML5のvideoタグで利用するmp4の動画を作る時のTips - Qiita</a> を真似していますが、私はちゃんと理解していません。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">destdir=640x360
</span></span></span><span class="line"><span class="cl"><span class="go">mkdir -p &#34;$destdir&#34;
</span></span></span><span class="line"><span class="cl"><span class="go">ffmpeg -y \
</span></span></span><span class="line"><span class="cl"><span class="go"> -i Creative-Commons-licences-explained-640x360.mp4 \
</span></span></span><span class="line"><span class="cl"><span class="go"> -vcodec copy \
</span></span></span><span class="line"><span class="cl"><span class="go"> -strict -2 -acodec aac -b:a 256k \
</span></span></span><span class="line"><span class="cl"><span class="go"> -flags +loop-global_header \
</span></span></span><span class="line"><span class="cl"><span class="go"> -bsf h264_mp4toannexb \
</span></span></span><span class="line"><span class="cl"><span class="go"> -map 0 \
</span></span></span><span class="line"><span class="cl"><span class="go"> -f segment \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_time 10 \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_format mpegts \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_list &#34;$destdir/playlist.m3u8&#34; \
</span></span></span><span class="line"><span class="cl"><span class="go"> -segment_list_type m3u8 \
</span></span></span><span class="line"><span class="cl"><span class="go"> &#34;$destdir/segment%03d.ts&#34;
</span></span></span></code></pre></div><h2 id="aacのエンコーダの選択">AACのエンコーダの選択</h2>
<p><a href="http://wiki.hydrogenaud.io/index.php?title=Fraunhofer_FDK_AAC">Fraunhofer FDK AAC - Hydrogenaudio Knowledgebase</a> にAACのエンコーダおすすめトップ6が載っています。</p>
<p>Apple AACはソース非公開でLinuxでは使えず、Fraunhofer FDK AACはライセンスの関係で <code>apt install</code> では使えず、Nero AACは開発終了とのことで、今回はffmpeg内蔵のAACエンコーダを使いました。</p>
<p><a href="http://qiita.com/joker1007/items/def9d58ddb00fafc936d">HTML5のvideoタグで利用するmp4の動画を作る時のTips - Qiita</a> で <code>-acodec libfaac -b:a 128k -flags +loop-global_header -map 0</code> の部分で <code>libfaac</code> を <code>aac</code> に変えて実行したら</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">The encoder &#39;aac&#39; is experimental but experimental codecs are not enabled, add &#39;-strict -2&#39; if you want to use it.
</span></span></span></code></pre></div><p>というエラーが出ました。
そこで <a href="https://trac.ffmpeg.org/wiki/Encode/AAC#NativeFFmpegAACencoder">Native FFmpeg AAC encoder</a> を見て <code>-strict -2</code> オプションをつけたら問題なく動きました。</p>
<h2 id="ブラウザの幅に応じて動画の解像度自動選択">ブラウザの幅に応じて動画の解像度自動選択</h2>
<p><a href="https://coolestguidesontheplanet.com/videodrome/videojs/">VideoJS setup guide to scale for responsive design on all browsers &amp; mobile</a> を参考にして画面の幅一杯に動画を表示するようにしてみました。
動画の解像度の縦横比に合わせて <code>video</code> タグの <code>class</code> 属性に <code>vjs-16-9</code> または <code>vjs-4-3</code> 属性をつけるだけです。</p>
<p>せっかくなので、ブラウザの幅 (正確には <code>video</code> タグの幅) に応じて再生する動画を自動的に選択するようにしてみました。
<code>video</code> の子供の <code>source</code> タグに <code>data-width</code> 属性をつけておいて、 <code>video</code> タグの幅と比較して選択するようにしています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;//vjs.zencdn.net/5.11/video-js.min.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">video</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;example-video&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;video-js vjs-default-skin vjs-16-9 vjs-big-play-centered&#34;</span> <span class="na">controls</span>
</span></span><span class="line"><span class="cl">  <span class="na">preload</span><span class="o">=</span><span class="s">&#34;none&#34;</span> <span class="na">poster</span><span class="o">=</span><span class="s">&#34;poster-640x360.jpg&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">source</span> <span class="na">data-width</span><span class="o">=</span><span class="s">&#34;640&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;640x360/playlist.m3u8&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;application/x-mpegURL&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">source</span> <span class="na">data-width</span><span class="o">=</span><span class="s">&#34;1280&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;1280x720/playlist.m3u8&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;application/x-mpegURL&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">video</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;//vjs.zencdn.net/5.11/video.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;//cdnjs.cloudflare.com/ajax/libs/videojs-contrib-hls/5.3.3/videojs-contrib-hls.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="s1">&#39;example-video&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">player</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">&#34;loadedmetadata&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">playerWidth</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">currentWidth</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">sources</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">$$</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">sources</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">sources</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">srcWidth</span> <span class="o">=</span> <span class="o">+</span><span class="nx">source</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;data-width&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">playerWidth</span> <span class="o">&lt;=</span> <span class="nx">srcWidth</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">===</span> <span class="nx">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">player</span><span class="p">.</span><span class="nx">src</span><span class="p">({</span><span class="nx">src</span><span class="o">:</span> <span class="nx">source</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">),</span> <span class="nx">type</span><span class="o">:</span> <span class="nx">source</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)});</span>
</span></span><span class="line"><span class="cl">        <span class="nx">player</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>上記のHTMLで <code>video</code> タグに <code>autoplay</code> 属性を指定すれば自動再生もできました。</p>
<h4 id="video-タグの幅が640px以下の時のアクセスログ"><code>video</code> タグの幅が640px以下の時のアクセスログ</h4>
<p>HTMLファイルを表示した時点では <code>/hls/640x360/playlist.m3u8</code> の行までで、その後再生ボタンを押すと以降のアクセスがあります。このケースでは無駄なアクセスはありません。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:52 +0900] &#34;GET /hls/ HTTP/1.1&#34; 200 576 &#34;-&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:52 +0900] &#34;GET /hls/poster-640x360.jpg HTTP/1.1&#34; 200 23701 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:52 +0900] &#34;GET /hls/640x360/playlist.m3u8 HTTP/1.1&#34; 200 1222 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:55 +0900] &#34;GET /hls/640x360/segment000.ts HTTP/1.1&#34; 200 1098484 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:55 +0900] &#34;GET /hls/640x360/segment001.ts HTTP/1.1&#34; 200 824192 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:55 +0900] &#34;GET /hls/640x360/segment002.ts HTTP/1.1&#34; 200 658940 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:09:55 +0900] &#34;GET /hls/640x360/segment003.ts HTTP/1.1&#34; 200 875892 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span></code></pre></div><h3 id="video-タグの幅が640pxより大きいの時のアクセスログ"><code>video</code> タグの幅が640pxより大きいの時のアクセスログ</h3>
<p>HTMLファイルを表示した時点では <code>/hls/640x360/playlist.m3u8</code> の行までで、その後再生ボタンを押すと以降のアクセスがあります。
このケースでは <code>/hls/640x360/playlist.m3u8</code> と <code>/hls/640x360/segment000.ts</code> へのアクセスは無駄です。
無駄な転送量をなるべく少なくしたいので <code>video</code> タグの <code>source</code> の並び順は解像度が小さいものから順に並べるようにしました。
遅い回線で画面が小さい時に、必要以上に解像度の大きな画像を無駄にダウンロードするのが一番無駄が大きいと思うので、そういう意味でも小さい順が良いと思いました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:01 +0900] &#34;GET /hls/ HTTP/1.1&#34; 200 576 &#34;-&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:01 +0900] &#34;GET /hls/poster-640x360.jpg HTTP/1.1&#34; 200 23701 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:02 +0900] &#34;GET /hls/640x360/playlist.m3u8 HTTP/1.1&#34; 200 1222 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:04 +0900] &#34;GET /hls/640x360/segment000.ts HTTP/1.1&#34; 200 1098484 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:04 +0900] &#34;GET /hls/1280x720/playlist.m3u8 HTTP/1.1&#34; 200 1196 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:04 +0900] &#34;GET /hls/1280x720/segment000.ts HTTP/1.1&#34; 200 1668876 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:05 +0900] &#34;GET /hls/1280x720/segment001.ts HTTP/1.1&#34; 200 1667372 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:05 +0900] &#34;GET /hls/1280x720/segment002.ts HTTP/1.1&#34; 200 1664364 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span><span class="line"><span class="cl">192.168.0.22 - - [21/Mar/2017:16:11:07 +0900] &#34;GET /hls/1280x720/segment003.ts HTTP/1.1&#34; 200 1651204 &#34;http://192.168.0.201/hls/&#34; &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36&#34;
</span></span></code></pre></div><p>多少無駄なアクセスが発生するものの一応これで切り替えは出来ました。
ただ <code>&lt;video&gt; - HTML | MDN &lt;https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video&gt;</code>_ を見た感じでは <code>video</code> タグの <code>poster</code> 属性には画像のURLを1つしか指定できないようです。
これも併せて考えると、 <code>video</code> タグを作る前にブラウザの幅を調べておいて <code>poster</code> 属性や <code>source</code> タグを動的に生成するほうが良いのかもしれません。
具体的には <code>video</code> タグを置くための <code>div</code> を先に作って幅を調べるとか。</p>

</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>
  </body>
</html>
