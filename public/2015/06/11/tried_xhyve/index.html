<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>xhyveを試してみました</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2015/06/11/tried_xhyve/" rel="bookmark"
           title="Permalink to xhyveを試してみました">xhyveを試してみました</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-06-11T00:45:00+09:00">
                Published: 2015-06-11
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/xhyve.html">xhyve</a> <a href="../../../../tag/virtualization.html">virtualization</a> </p>
</footer><!-- /.post-info -->      <p><a href="http://www.pagetable.com/?p=831">xhyve – Lightweight Virtualization on OS X Based on bhyve | pagetable.com</a>に沿って試してみました。</p>
<h2>確認した環境</h2>
<ul>
<li>MacBook Pro (Retina, Mid 2012)</li>
<li>OS X Yosemite 10.10.3</li>
</ul>
<h2>ソースからビルド</h2>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="err">お好みの作業ディレクトリ</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">mist64</span><span class="o">/</span><span class="n">xhyve</span>
<span class="n">cd</span> <span class="n">xhyve</span>
<span class="n">make</span>
</pre></div>


<h2>Tiny Core Linuxを起動</h2>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">xhyverun</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>起動メッセージが流れた後、画面がクリアされて以下のように表示されたら起動完了です。ここまで3〜4秒です。速い！</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="err">�</span><span class="o">-</span><span class="w"></span>
<span class="w"> </span><span class="o">//</span><span class="err">\</span><span class="w">   </span><span class="n">Core</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">distributed</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">ABSOLUTELY</span><span class="w"> </span><span class="k">NO</span><span class="w"> </span><span class="n">WARRANTY</span><span class="p">.</span><span class="w"></span>
<span class="w"> </span><span class="n">v_</span><span class="o">/</span><span class="n">_</span><span class="w">           </span><span class="n">www</span><span class="p">.</span><span class="n">tinycorelinux</span><span class="p">.</span><span class="n">com</span><span class="w"></span>

<span class="n">tc</span><span class="nv">@box</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"> </span><span class="n">Switched</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">clocksource</span><span class="w"> </span><span class="n">tsc</span><span class="w"></span>
</pre></div>


<p>プロンプトにかぶってメッセージが出ていますが、enterを押せばプロンプトが出ます。</p>
<div class="highlight"><pre><span></span><span class="n">tc</span><span class="nv">@box</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"></span>
</pre></div>


<p>シャットダウンするには以下のコマンドを実行します。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">halt</span>
</pre></div>


<h2>Ubuntu Server 14.04.2のディスクイメージ作成</h2>
<p>Ubuntu ServerのISOイメージをダウンロードして、ディスクイメージを作成するための準備を行います。元記事によると、OS Xがハイブリッドファイルシステムを認識しないので、Linux kernelとinitrdを取り出しているそうです。</p>
<div class="highlight"><pre><span></span><span class="nv">mkdir</span> <span class="nv">ubuntu</span>
<span class="nv">cd</span> <span class="nv">ubuntu</span>
<span class="nv">curl</span> <span class="o">-</span><span class="nv">O</span> <span class="nv">ftp</span>:<span class="o">//</span><span class="nv">ftp</span>.<span class="nv">kddilabs</span>.<span class="nv">jp</span><span class="o">/</span><span class="nv">Linux</span><span class="o">/</span><span class="nv">packages</span><span class="o">/</span><span class="nv">ubuntu</span><span class="o">/</span><span class="nv">releases</span><span class="o">-</span><span class="nv">cd</span><span class="o">/</span><span class="mi">14</span>.<span class="mi">04</span>.<span class="mi">2</span><span class="o">/</span><span class="nv">ubuntu</span><span class="o">-</span><span class="mi">14</span>.<span class="mi">04</span>.<span class="mi">2</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="nv">amd64</span>.<span class="nv">iso</span>
<span class="nv">dd</span> <span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">zero</span> <span class="nv">bs</span><span class="o">=</span><span class="mi">2</span><span class="nv">k</span> <span class="nv">count</span><span class="o">=</span><span class="mi">1</span> <span class="nv">of</span><span class="o">=/</span><span class="nv">tmp</span><span class="o">/</span><span class="nv">tmp</span>.<span class="nv">iso</span>
<span class="nv">dd</span> <span class="k">if</span><span class="o">=</span><span class="nv">ubuntu</span><span class="o">-</span><span class="mi">14</span>.<span class="mi">04</span>.<span class="mi">2</span><span class="o">-</span><span class="nv">server</span><span class="o">-</span><span class="nv">amd64</span>.<span class="nv">iso</span> <span class="nv">bs</span><span class="o">=</span><span class="mi">2</span><span class="nv">k</span> <span class="nv">skip</span><span class="o">=</span><span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="nv">tmp</span><span class="o">/</span><span class="nv">tmp</span>.<span class="nv">iso</span>
<span class="nv">hdiutil</span> <span class="nv">attach</span> <span class="o">/</span><span class="nv">tmp</span><span class="o">/</span><span class="nv">tmp</span>.<span class="nv">iso</span>
<span class="nv">cp</span> <span class="o">/</span><span class="nv">Volumes</span><span class="o">/</span><span class="nv">Ubuntu</span><span class="o">-</span><span class="nv">Server</span>\ <span class="mi">14</span><span class="o">/</span><span class="nv">install</span><span class="o">/</span><span class="nv">vmlinuz</span> .
<span class="nv">cp</span> <span class="o">/</span><span class="nv">Volumes</span><span class="o">/</span><span class="nv">Ubuntu</span><span class="o">-</span><span class="nv">Server</span>\ <span class="mi">14</span><span class="o">/</span><span class="nv">install</span><span class="o">/</span><span class="nv">initrd</span>.<span class="nv">gz</span> .
</pre></div>


<p>以下のコマンドでディスクイメージを作成します。ここでは <code>bs=1g count=8</code> でディスクサイズを8GBとしていますが、お好みで調整してください。</p>
<div class="highlight"><pre><span></span><span class="nv">dd</span> <span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">zero</span> <span class="nv">of</span><span class="o">=</span><span class="nv">hdd</span>.<span class="nv">img</span> <span class="nv">bs</span><span class="o">=</span><span class="mi">1</span><span class="nv">g</span> <span class="nv">count</span><span class="o">=</span><span class="mi">8</span>
</pre></div>


<p>xhyve/ubuntuディレクトリではなくxhyveディレクトリにディスクイメージ作成用のスクリプトを作ります。</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="p">..</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span> <span class="o">&gt;</span> <span class="n">xhyverun_ubuntu_install</span><span class="p">.</span><span class="n">sh</span>
<span class="o">#!/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span>

<span class="n">KERNEL</span><span class="o">=</span><span class="ss">&quot;ubuntu/vmlinuz&quot;</span>
<span class="n">INITRD</span><span class="o">=</span><span class="ss">&quot;ubuntu/initrd.gz&quot;</span>
<span class="n">CMDLINE</span><span class="o">=</span><span class="ss">&quot;earlyprintk=serial console=ttyS0 acpi=off&quot;</span>

<span class="n">MEM</span><span class="o">=</span><span class="ss">&quot;-m 1G&quot;</span>
<span class="o">#</span><span class="n">SMP</span><span class="o">=</span><span class="ss">&quot;-c 2&quot;</span>
<span class="n">NET</span><span class="o">=</span><span class="ss">&quot;-s 2:0,virtio-net&quot;</span>
<span class="n">IMG_CD</span><span class="o">=</span><span class="ss">&quot;-s 3,ahci-cd,ubuntu/ubuntu-14.04.2-server-amd64.iso&quot;</span>
<span class="n">IMG_HDD</span><span class="o">=</span><span class="ss">&quot;-s 4,virtio-blk,ubuntu/hdd.img&quot;</span>
<span class="n">PCI_DEV</span><span class="o">=</span><span class="ss">&quot;-s 0:0,hostbridge -s 31,lpc&quot;</span>
<span class="n">LPC_DEV</span><span class="o">=</span><span class="ss">&quot;-l com1,stdio&quot;</span>

<span class="n">build</span><span class="o">/</span><span class="n">xhyve</span> <span class="err">$</span><span class="n">MEM</span> <span class="err">$</span><span class="n">SMP</span> <span class="err">$</span><span class="n">PCI_DEV</span> <span class="err">$</span><span class="n">LPC_DEV</span> <span class="err">$</span><span class="n">NET</span> <span class="err">$</span><span class="n">IMG_CD</span> <span class="err">$</span><span class="n">IMG_HDD</span> <span class="o">-</span><span class="n">f</span> <span class="n">kexec</span><span class="p">,</span><span class="err">$</span><span class="n">KERNEL</span><span class="p">,</span><span class="err">$</span><span class="n">INITRD</span><span class="p">,</span><span class="ss">&quot;$CMDLINE&quot;</span>
<span class="n">EOF</span>
</pre></div>


<p>スクリプトに実行パーミションをつけてsudo付きで実行します。</p>
<div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">xhyverun_ubuntu_install</span><span class="p">.</span><span class="n">sh</span>
<span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">xhyverun_ubuntu_install</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>テキストインストーラが起動しますので、以下のように選択してインストールしました。</p>
<ul>
<li>Select a language: English</li>
<li>Select your location: other -&gt; Asia -&gt; Japan</li>
<li>Configure locales: United Status - en_US.UTF-8</li>
<li>Hostname: お好みの名前</li>
<li>Set up users and passwords: お好みのIDとパスワードで作成</li>
<li>time zone: Asia/Tokyo</li>
<li>Partition disks: Guided - use entire disk</li>
<li>HTTP proxy: 無し</li>
<li>manage upgrades: No automatic updates</li>
<li>Software selection:<ul>
<li>Basic Ubuntu Server</li>
<li>OpenSSH server</li>
</ul>
</li>
<li>Install GRUB to the master boot record: Yes</li>
<li>Is the system clock set to UTC: No</li>
<li>Installation complete: Go Back -&gt; Execute a shell</li>
</ul>
<p>Installation completeのところでContinueではなくGo Backでメニューに戻りExecute a shellを選んで進み、シェルが起動したら以下のコマンドを実行します。</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">target</span>
<span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span>
<span class="n">tar</span> <span class="k">c</span> <span class="n">boot</span> <span class="o">|</span> <span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1234</span>
</pre></div>


<p>上記のコマンド実行のうちsbin/ifconfigで表示されたIPアドレスをメモしておきます。</p>
<div class="highlight"><pre><span></span><span class="o">/</span><span class="n">target</span> <span class="o">#</span> <span class="n">sbin</span><span class="o">/</span><span class="n">ifconfig</span>
<span class="n">eth0</span>      <span class="n">Link</span> <span class="n">encap</span><span class="p">:</span><span class="n">Ethernet</span>  <span class="n">HWaddr</span> <span class="n">e6</span><span class="p">:</span><span class="mi">0</span><span class="n">d</span><span class="p">:</span><span class="n">f2</span><span class="p">:</span><span class="mi">6</span><span class="n">b</span><span class="p">:</span><span class="n">cf</span><span class="p">:</span><span class="mi">32</span>
          <span class="n">inet</span> <span class="n">addr</span><span class="p">:</span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">64</span><span class="p">.</span><span class="mi">3</span>  <span class="n">Bcast</span><span class="p">:</span><span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">64</span><span class="p">.</span><span class="mi">255</span>  <span class="n">Mask</span><span class="p">:</span><span class="mi">255</span><span class="p">.</span><span class="mi">255</span><span class="p">.</span><span class="mi">255</span><span class="p">.</span><span class="mi">0</span>
          <span class="n">inet6</span> <span class="n">addr</span><span class="p">:</span> <span class="n">fe80</span><span class="p">::</span><span class="n">e40d</span><span class="p">:</span><span class="n">f2ff</span><span class="p">:</span><span class="n">fe6b</span><span class="p">:</span><span class="n">cf32</span><span class="o">/</span><span class="mi">64</span> <span class="k">Scope</span><span class="p">:</span><span class="n">Link</span>
          <span class="n">UP</span> <span class="n">BROADCAST</span> <span class="n">RUNNING</span> <span class="n">MULTICAST</span>  <span class="n">MTU</span><span class="p">:</span><span class="mi">1500</span>  <span class="n">Metric</span><span class="p">:</span><span class="mi">1</span>
          <span class="n">RX</span> <span class="n">packets</span><span class="p">:</span><span class="mi">25405</span> <span class="n">errors</span><span class="p">:</span><span class="mi">0</span> <span class="n">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="n">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="n">frame</span><span class="p">:</span><span class="mi">85</span>
          <span class="n">TX</span> <span class="n">packets</span><span class="p">:</span><span class="mi">13601</span> <span class="n">errors</span><span class="p">:</span><span class="mi">0</span> <span class="n">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="n">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="n">carrier</span><span class="p">:</span><span class="mi">0</span>
          <span class="n">collisions</span><span class="p">:</span><span class="mi">0</span> <span class="n">txqueuelen</span><span class="p">:</span><span class="mi">1000</span>
          <span class="n">RX</span> <span class="n">bytes</span><span class="p">:</span><span class="mi">38179647</span> <span class="p">(</span><span class="mi">38</span><span class="p">.</span><span class="mi">1</span> <span class="n">MB</span><span class="p">)</span>  <span class="n">TX</span> <span class="n">bytes</span><span class="p">:</span><span class="mi">931189</span> <span class="p">(</span><span class="mi">931</span><span class="p">.</span><span class="mi">1</span> <span class="n">KB</span><span class="p">)</span>

<span class="n">lo</span>        <span class="n">Link</span> <span class="n">encap</span><span class="p">:</span><span class="k">Local</span> <span class="n">Loopback</span>
          <span class="n">inet</span> <span class="n">addr</span><span class="p">:</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>  <span class="n">Mask</span><span class="p">:</span><span class="mi">255</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
          <span class="n">inet6</span> <span class="n">addr</span><span class="p">:</span> <span class="p">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span> <span class="k">Scope</span><span class="p">:</span><span class="k">Host</span>
          <span class="n">UP</span> <span class="n">LOOPBACK</span> <span class="n">RUNNING</span>  <span class="n">MTU</span><span class="p">:</span><span class="mi">65536</span>  <span class="n">Metric</span><span class="p">:</span><span class="mi">1</span>
          <span class="n">RX</span> <span class="n">packets</span><span class="p">:</span><span class="mi">0</span> <span class="n">errors</span><span class="p">:</span><span class="mi">0</span> <span class="n">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="n">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="n">frame</span><span class="p">:</span><span class="mi">0</span>
          <span class="n">TX</span> <span class="n">packets</span><span class="p">:</span><span class="mi">0</span> <span class="n">errors</span><span class="p">:</span><span class="mi">0</span> <span class="n">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="n">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="n">carrier</span><span class="p">:</span><span class="mi">0</span>
          <span class="n">collisions</span><span class="p">:</span><span class="mi">0</span> <span class="n">txqueuelen</span><span class="p">:</span><span class="mi">0</span>
          <span class="n">RX</span> <span class="n">bytes</span><span class="p">:</span><span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="n">B</span><span class="p">)</span>  <span class="n">TX</span> <span class="n">bytes</span><span class="p">:</span><span class="mi">0</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="n">B</span><span class="p">)</span>
</pre></div>


<p>Mac側では以下のコマンドを実行します。IPアドレスはifconfigで表示されたものに置き換えて実行してください。</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">ubuntu</span>
<span class="n">nc</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">64</span><span class="p">.</span><span class="mi">3</span> <span class="mi">1234</span> <span class="o">|</span> <span class="n">tar</span> <span class="n">x</span>
</pre></div>


<p>VMのシェルのプロンプトで以下のように入力してシェルを終了します。</p>
<div class="highlight"><pre><span></span><span class="k">exit</span>
</pre></div>


<p>メニューに戻ったら <code>Finish the installation</code> を選びます。</p>
<ul>
<li>Is the system clock set to UTC?: No</li>
<li>Installation complete: Continue</li>
</ul>
<h2>Ubuntu Server 14.04.2の起動</h2>
<p>Macでxhyve/ubuntuではなくxhyveのディレクトリで起動用のスクリプトを作成します。</p>
<div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span> <span class="o">&gt;</span> <span class="p">.</span><span class="o">/</span><span class="n">xhyverun_ubuntu</span><span class="p">.</span><span class="n">sh</span>
<span class="o">#!/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span>

<span class="n">KERNEL</span><span class="o">=</span><span class="ss">&quot;ubuntu/boot/vmlinuz-3.16.0-30-generic&quot;</span>
<span class="n">INITRD</span><span class="o">=</span><span class="ss">&quot;ubuntu/boot/initrd.img-3.16.0-30-generic&quot;</span>
<span class="n">CMDLINE</span><span class="o">=</span><span class="ss">&quot;earlyprintk=serial console=ttyS0 acpi=off root=/dev/vda1 ro&quot;</span>

<span class="n">MEM</span><span class="o">=</span><span class="ss">&quot;-m 1G&quot;</span>
<span class="o">#</span><span class="n">SMP</span><span class="o">=</span><span class="ss">&quot;-c 2&quot;</span>
<span class="n">NET</span><span class="o">=</span><span class="ss">&quot;-s 2:0,virtio-net&quot;</span>
<span class="n">IMG_HDD</span><span class="o">=</span><span class="ss">&quot;-s 4,virtio-blk,ubuntu/hdd.img&quot;</span>
<span class="n">PCI_DEV</span><span class="o">=</span><span class="ss">&quot;-s 0:0,hostbridge -s 31,lpc&quot;</span>
<span class="n">LPC_DEV</span><span class="o">=</span><span class="ss">&quot;-l com1,stdio&quot;</span>

<span class="n">build</span><span class="o">/</span><span class="n">xhyve</span> <span class="err">$</span><span class="n">MEM</span> <span class="err">$</span><span class="n">SMP</span> <span class="err">$</span><span class="n">PCI_DEV</span> <span class="err">$</span><span class="n">LPC_DEV</span> <span class="err">$</span><span class="n">NET</span> <span class="err">$</span><span class="n">IMG_CD</span> <span class="err">$</span><span class="n">IMG_HDD</span> <span class="o">-</span><span class="n">f</span> <span class="n">kexec</span><span class="p">,</span><span class="err">$</span><span class="n">KERNEL</span><span class="p">,</span><span class="err">$</span><span class="n">INITRD</span><span class="p">,</span><span class="ss">&quot;$CMDLINE&quot;</span>
<span class="n">EOF</span>
</pre></div>


<p>スクリプトに実行パーミションをつけてsudo付きで実行してUbuntuを起動します。</p>
<div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="p">.</span><span class="o">/</span><span class="n">xhyverun_ubuntu</span><span class="p">.</span><span class="n">sh</span>
<span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">xhyverun_ubuntu</span><span class="p">.</span><span class="n">sh</span>
</pre></div>


<p>起動してログインプロンプトが出たらインストール時に作成したユーザでログインします。IPアドレスはDHCPで取得する設定にしたのですが、確認してみると、ディスクイメージ作成時とは違う値になっていました。</p>
<div class="highlight"><pre><span></span>$ ip a s eth0
<span class="m">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc pfifo_fast state UP group default qlen <span class="m">1000</span>
    link/ether <span class="m">62</span>:ca:c1:25:cf:32 brd ff:ff:ff:ff:ff:ff
    inet <span class="m">192</span>.168.64.4/24 brd <span class="m">192</span>.168.64.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::60ca:c1ff:fe25:cf32/64 scope link
       valid_lft forever preferred_lft forever
</pre></div>


<p>Macからsshでログインも出来ました。</p>
<div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">ubuntu</span><span class="mf">@192.168.64.4</span>
</pre></div>


<p>sshでログインすると初回だけ表示が24行に限定され、リターンを押しても24行の範囲でスクロールされるようになってしまいました。Mac側ではiTermで65行にしていました。と、この説明を書くためにiTermのウィンドウで高さを変えて行数を変えて戻してとやっていたら、次のsshログインからはiTermの行数で表示されるようになりました。</p>
<p>Ubuntuを停止するにはVM内で以下のコマンドを実行します。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">shutdown</span> <span class="o">-</span><span class="n">h</span> <span class="n">now</span>
</pre></div>


<h2>Ubuntuの起動に必要なファイル</h2>
<p>ubuntuフォルダにはビルドに使用したファイルも含まれていますが、起動スクリプトで参照されているファイル以外のファイルを別ディレクトリに移動して起動してみたら起動出来ました。ということで、起動には以下の4つのファイルだけあればOKです。</p>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">xhyverun_ubuntu</span><span class="p">.</span><span class="n">sh</span>
<span class="n">ubuntu</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="p">.</span><span class="n">img</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">16</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="o">-</span><span class="n">generic</span>
<span class="n">ubuntu</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="mi">16</span><span class="p">.</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="o">-</span><span class="n">generic</span>
<span class="n">ubuntu</span><span class="o">/</span><span class="n">hdd</span><span class="p">.</span><span class="n">img</span>
</pre></div>


<h1>まとめ</h1>
<p>xhyveをソースからビルドして、Tiny Core LinuxとUbuntu Server 14.04.2を動かしてみました。<a href="https://github.com/mist64/xhyve#todo">TODO</a>によると、まだいろいろ対応予定の項目があるようです。今後が楽しみです！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>