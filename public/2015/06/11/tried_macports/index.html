<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>Homebrewを辞めてMacPorts 2.3.3を入れてpkgngをビルドしてみた</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2015/06/11/tried_macports/" rel="bookmark"
           title="Permalink to Homebrewを辞めてMacPorts 2.3.3を入れてpkgngをビルドしてみた">Homebrewを辞めてMacPorts 2.3.3を入れてpkgngをビルドしてみた</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-06-11T01:09:00+09:00">
                Published: 2015-06-11
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/osx.html">osx</a> <a href="../../../../tag/macports.html">macports</a> <a href="../../../../tag/pkgng.html">pkgng</a> </p>
</footer><!-- /.post-info -->      <h1>はじめに</h1>
<p>https://twitter.com/shibu_jp/status/598332736638582785 と <a href="http://gihyo.jp/admin/serial/01/bsd-yomoyama/0002">第2回　パッケージ管理システム「pkg 1.5」と基本的な使い方：BSD界隈四方山話｜gihyo.jp … 技術評論社</a>で、実験段階ですがOS Xもサポート対象となったという話を見て <code>pkg</code> と <code>MacPorts</code> をシームレスに組み合わせて使えるかが気になっていました。</p>
<p>FreeBSDではpkgコマンドでバイナリパッケージをインストールし、Ports Collectionでソースからビルドというのが簡単にできるようになっているのですが、上記の記事によるとpkgとPorts Collectionがシームレスに連動しているそうです。</p>
<p>なので、OS X上では <code>pkg</code> と <code>MacPorts</code> が連動するのかな、するといいなあ、と思って、まずは <code>MacPorts</code> を試してみます。</p>
<p>私はだいぶ前に MacPorts から Homebrew に切り替えていたので、MacPortsは久々に試します。</p>
<h2>確認した環境</h2>
<ul>
<li>MacBook Pro (Retina, Mid 2012)</li>
<li>OS X Yosemite 10.10.3</li>
</ul>
<h1>Homebrewのアンインストール</h1>
<p><a href="http://qiita.com/UmedaTakefumi/items/dc52f008586cbf06582f">Homebrewをアンインストールするには - Qiita</a>を参考にといいつつ、いきなりバッサリ消すとなにかあったときに戻れないので、アンインストールはせずにHomebrewでインストールしたパッケージのサービスを停止して、/usr/localディレクトリを/usr/local.bakに退避しておくことにします。移行が無事完了したらアンインストールするということで。</p>
<p>以下のコマンドを実行して~/Library/LaunchAgents/にシンボリックリンクを張ったサービスを停止・解除します。</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="nv">f</span> <span class="nv">in</span> <span class="o">~/</span><span class="nv">Library</span><span class="o">/</span><span class="nv">LaunchAgents</span><span class="o">/</span><span class="nv">homebrew</span>.<span class="o">*</span><span class="c1">; do launchctl unload $f; done</span>
</pre></div>


<p>/usr/localを/usr/local.bakに退避します。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mv</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="p">.</span><span class="n">bak</span>
</pre></div>


<h1>MacPortsのインストール</h1>
<p>MacPortsのバイナリパッケージをダウンロードしてインストールします。MacPorts-2.3.3-10.10-Yosemite.pkgをFinderでダブルクリックしてもいいのですが、将来スクリプトで自動化することを見据えて、OS Xの <code>installer</code> コマンドでインストールしてみます。</p>
<div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">Downloads</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">O</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">distfiles</span><span class="p">.</span><span class="n">macports</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">MacPorts</span><span class="o">/</span><span class="n">MacPorts</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">3</span><span class="o">-</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="o">-</span><span class="n">Yosemite</span><span class="p">.</span><span class="n">pkg</span>
<span class="n">sudo</span> <span class="n">installer</span> <span class="o">-</span><span class="n">pkg</span> <span class="n">MacPorts</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">3</span><span class="o">-</span><span class="mi">10</span><span class="p">.</span><span class="mi">10</span><span class="o">-</span><span class="n">Yosemite</span><span class="p">.</span><span class="n">pkg</span> <span class="o">-</span><span class="n">target</span> <span class="o">/</span>
</pre></div>


<p><a href="https://guide.macports.org/#installing.shell">2.5.1. The Postflight Script</a>の説明に従って、環境変数PATHとMANPATHの設定を追加します。以下はシェルはbashを使っていて~/.bash_profileに追加する場合の例です。</p>
<div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/</span><span class="p">.</span><span class="n">bash_profile</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">export</span> <span class="n">MANPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="k">share</span><span class="o">/</span><span class="n">man</span><span class="p">:</span><span class="err">$</span><span class="n">MANPATH</span>
<span class="n">EOF</span>
</pre></div>


<p>以下のコマンドを実行して、上で追加した設定を有効にします。</p>
<div class="highlight"><pre><span></span><span class="k">exec</span> $<span class="nv">SHELL</span> <span class="o">-</span><span class="nv">l</span>
</pre></div>


<p>portコマンドにPATHが通ったことを確認します。</p>
<div class="highlight"><pre><span></span>$ which port
/opt/local/bin/port
</pre></div>


<p><a href="https://www.macports.org/install.php#pkg">Mac OS X Package (.pkg) Installer</a>の説明に従って、MacPorts自体のアップデートを行います。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">port</span> <span class="o">-</span><span class="n">v</span> <span class="n">selfupdate</span>
</pre></div>


<p>出力の最後に以下のように表示されたので、既に最新版になっていたそうです。</p>
<div class="highlight"><pre><span></span><span class="c1">---&gt;  MacPorts base is already the latest version</span>

<span class="n">The</span> <span class="n">ports</span> <span class="n">tree</span> <span class="n">has</span> <span class="n">been</span> <span class="n">updated</span><span class="p">.</span> <span class="k">To</span> <span class="n">upgrade</span> <span class="n">your</span> <span class="n">installed</span> <span class="n">ports</span><span class="p">,</span> <span class="n">you</span> <span class="n">should</span> <span class="n">run</span>
  <span class="n">port</span> <span class="n">upgrade</span> <span class="n">outdated</span>
</pre></div>


<p>上記の説明によるとインストールしたportsをアップグレードするときは <code>ports upgrade outdated</code> と実行すればよいそうです。</p>
<h1>pkgngをソースからビルド</h1>
<p>FreeBSDのpkgはpkgngと呼ばれることもあります。<a href="https://wiki.freebsd.org/pkgng">pkgng - FreeBSD Wiki</a>によるとngはNext Generationの略のようです。</p>
<p>githubにソースレポジトリ <a href="https://github.com/freebsd/pkg">freebsd/pkg</a>があったので、ソースからビルドして入れてみます。</p>
<p>ホームディレクトリ直下にpkgディレクトリを作るようにして入れてみました。</p>
<div class="highlight"><pre><span></span><span class="n">cd</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">freebsd</span><span class="o">/</span><span class="n">pkg</span>
<span class="n">cd</span> <span class="n">pkg</span>
</pre></div>


<p><code>git tag</code> で確認すると最新のリリースは 1.5.3 でしたので、それにしてみます。</p>
<div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">3</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">3</span>
</pre></div>


<p><a href="https://github.com/freebsd/pkg#building-pkg-using-sources-from-git">freebsd/pkg</a>を参考にやってみました。この手順ではビルドに必要なパッケージをFreeBSDにインストール済みの古いバージョンの <code>pkg</code> コマンドで入れていますが、OS Xの場合は無いのでMacPortsで入れます。</p>
<p>また <code>pkgconf</code> はMacPortsでは <code>pkgconfig</code> という名前なのでそこも変えています。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">autoconf</span> <span class="n">automake</span> <span class="n">libtool</span> <span class="n">pkgconfig</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">autogen</span><span class="p">.</span><span class="n">sh</span>
<span class="p">.</span><span class="o">/</span><span class="n">configure</span>
</pre></div>


<p><code>./configure</code> が以下のようにエラーになってしまいました。</p>
<div class="highlight"><pre><span></span>…<span class="ss">(</span>略<span class="ss">)</span>…
<span class="nv">checking</span> <span class="k">for</span> <span class="nv">library</span> <span class="nv">containing</span> <span class="nv">archive_read_open</span>... <span class="o">-</span><span class="nv">larchive</span>
<span class="nv">checking</span> <span class="nv">archive</span>.<span class="nv">h</span> <span class="nv">usability</span>... <span class="nv">no</span>
<span class="nv">checking</span> <span class="nv">archive</span>.<span class="nv">h</span> <span class="nv">presence</span>... <span class="nv">no</span>
<span class="nv">checking</span> <span class="k">for</span> <span class="nv">archive</span>.<span class="nv">h</span>... <span class="nv">no</span>
<span class="nv">configure</span>: <span class="nv">error</span>: <span class="nv">Unable</span> <span class="nv">to</span> <span class="nv">find</span> <span class="nv">the</span> <span class="nv">libarchive</span> <span class="nv">headers</span>
</pre></div>


<p>そこでlibarchiveをMacPortsでインストールしました。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">libarchive</span>
</pre></div>


<p>MacPortsでインストールしたパッケージを見つけてもらうため、<a href="http://blog.francoismaillet.com/compile-against-libraries-installed-with-macports/">Compile against libraries installed with MacPorts | Blog de François Maillet</a>を参考に以下のようにオプションをつけて <code>./configure</code> を再度実行しました。pkgのsrcディレクトリを見ると、pkgはC++ではなくCで実装されていますので、 <code>configure</code> の引数もCPPFLAGSではなくCFLAGSにしています。
今度は <code>configure</code> が成功しました。</p>
<div class="highlight"><pre><span></span>.<span class="o">/</span><span class="nv">configure</span> <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">-I/opt/local/include</span><span class="s2">&quot;</span> <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">-L/opt/local/lib</span><span class="s2">&quot;</span>
</pre></div>


<p><code>configure</code> の次は <code>make</code> を実行します。</p>
<div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>


<p>1つ警告が出ました。</p>
<div class="highlight"><pre><span></span><span class="err">…</span><span class="p">(</span><span class="err">略</span><span class="p">)</span><span class="err">…</span>
  <span class="n">CCLD</span>     <span class="n">pkg</span><span class="o">-</span><span class="k">static</span>
<span class="n">libtool</span><span class="p">:</span> <span class="n">warning</span><span class="p">:</span> <span class="n">complete</span> <span class="k">static</span> <span class="n">linking</span> <span class="k">is</span> <span class="n">impossible</span> <span class="k">in</span> <span class="n">this</span> <span class="n">configuration</span>
  <span class="n">CCLD</span>     <span class="n">pkg</span>
<span class="err">…</span><span class="p">(</span><span class="err">略</span><span class="p">)</span><span class="err">…</span>
</pre></div>


<p><code>./configure --help</code> してみると</p>
<div class="highlight"><pre><span></span>  <span class="c1">--with-staticonly       Only build the static version (default is no)</span>
</pre></div>


<p>というオプションがあり、デフォルトではスタティックリンクするバージョンとしないバージョンの両方を作るようになっているようです。</p>
<p>とりあえずスタティックリンクしないバージョンはビルドできているのでとりあえず先に進みます。</p>
<p>以下のコマンドを実行してインストールします。</p>
<div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>


<p>/usr/localに以下のようなファイルとディレクトリが作られました。</p>
<div class="highlight"><pre><span></span>$ <span class="nv">find</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">bash_completion</span>.<span class="nv">d</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">bash_completion</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">_pkg</span>.<span class="nv">bash</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">daily</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">daily</span><span class="o">/</span><span class="mi">411</span>.<span class="nv">pkg</span><span class="o">-</span><span class="nv">backup</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">daily</span><span class="o">/</span><span class="mi">490</span>.<span class="nv">status</span><span class="o">-</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">changes</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">security</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">security</span><span class="o">/</span><span class="mi">410</span>.<span class="nv">pkg</span><span class="o">-</span><span class="nv">audit</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">security</span><span class="o">/</span><span class="mi">460</span>.<span class="nv">pkg</span><span class="o">-</span><span class="nv">checksum</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">weekly</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">periodic</span><span class="o">/</span><span class="nv">weekly</span><span class="o">/</span><span class="mi">400</span>.<span class="nv">status</span><span class="o">-</span><span class="nv">pkg</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">pkg</span>.<span class="nv">conf</span>.<span class="nv">sample</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="k">include</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="k">include</span><span class="o">/</span><span class="nv">pkg</span>.<span class="nv">h</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">libpkg</span>.<span class="mi">3</span>.<span class="nv">dylib</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">libpkg</span>.<span class="nv">dylib</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">libpkg</span>.<span class="nv">la</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">libpkg_static</span>.<span class="nv">a</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">libpkg_static</span>.<span class="nv">la</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">libdata</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">libdata</span><span class="o">/</span><span class="nv">pkgconfig</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">libdata</span><span class="o">/</span><span class="nv">pkgconfig</span><span class="o">/</span><span class="nv">pkg</span>.<span class="nv">pc</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man3</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man3</span><span class="o">/</span><span class="nv">pkg_printf</span>.<span class="mi">3</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man3</span><span class="o">/</span><span class="nv">pkg_repos</span>.<span class="mi">3</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man5</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man5</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">repository</span>.<span class="mi">5</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man5</span><span class="o">/</span><span class="nv">pkg</span>.<span class="nv">conf</span>.<span class="mi">5</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">add</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">alias</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">annotate</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">audit</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">autoremove</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">backup</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">check</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">clean</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">config</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">convert</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">create</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">delete</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">fetch</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">info</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">install</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">lock</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">query</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">register</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">remove</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">repo</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">rquery</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">search</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">set</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">shell</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">shlib</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">ssh</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">static</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">stats</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">unlock</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">update</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">updating</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">upgrade</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">version</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">which</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">man</span><span class="o">/</span><span class="nv">man8</span><span class="o">/</span><span class="nv">pkg</span>.<span class="mi">8</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">sbin</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">pkg</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">pkg</span><span class="o">-</span><span class="nv">static</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">pkg2ng</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">zsh</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">zsh</span><span class="o">/</span><span class="nv">site</span><span class="o">-</span><span class="nv">functions</span>
<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">zsh</span><span class="o">/</span><span class="nv">site</span><span class="o">-</span><span class="nv">functions</span><span class="o">/</span><span class="nv">_pkg</span>
</pre></div>


<p>pkgコマンドとpkg-staticコマンドは/usr/local/sbinにインストールされていました。
<code>otool -L</code> で確認すると両方ともダイナミックリンクになっていました。</p>
<div class="highlight"><pre><span></span>$ otool -L /usr/local/sbin/pkg
/usr/local/sbin/pkg:
        /usr/local/lib/libpkg.3.dylib <span class="o">(</span>compatibility version <span class="m">4</span>.0.0, current version <span class="m">4</span>.0.0<span class="o">)</span>
        /opt/local/lib/libssl.1.0.0.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /usr/lib/libSystem.B.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1213</span>.0.0<span class="o">)</span>
        /usr/lib/libutil.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /opt/local/lib/libcrypto.1.0.0.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /usr/lib/libresolv.9.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /opt/local/lib/libarchive.13.dylib <span class="o">(</span>compatibility version <span class="m">15</span>.0.0, current version <span class="m">15</span>.2.0<span class="o">)</span>
        /opt/local/lib/libz.1.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.2.8<span class="o">)</span>
        /opt/local/lib/libbz2.1.0.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.6<span class="o">)</span>
        /opt/local/lib/liblzma.5.dylib <span class="o">(</span>compatibility version <span class="m">8</span>.0.0, current version <span class="m">8</span>.1.0<span class="o">)</span>
$ otool -L /usr/local/sbin/pkg-static
/usr/local/sbin/pkg-static:
        /usr/lib/libutil.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /opt/local/lib/libssl.1.0.0.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /opt/local/lib/libcrypto.1.0.0.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /usr/lib/libSystem.B.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1213</span>.0.0<span class="o">)</span>
        /usr/lib/libresolv.9.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.0<span class="o">)</span>
        /opt/local/lib/libarchive.13.dylib <span class="o">(</span>compatibility version <span class="m">15</span>.0.0, current version <span class="m">15</span>.2.0<span class="o">)</span>
        /opt/local/lib/libz.1.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.2.8<span class="o">)</span>
        /opt/local/lib/libbz2.1.0.dylib <span class="o">(</span>compatibility version <span class="m">1</span>.0.0, current version <span class="m">1</span>.0.6<span class="o">)</span>
        /opt/local/lib/liblzma.5.dylib <span class="o">(</span>compatibility version <span class="m">8</span>.0.0, current version <span class="m">8</span>.1.0<span class="o">)</span>
</pre></div>


<p>/usr/local/sbinにはPATHが通っていなかったので、設定を変更して有効にしました。</p>
<div class="highlight"><pre><span></span><span class="nv">echo</span> <span class="s1">&#39;</span><span class="s">export PATH=/usr/local/sbin:$PATH</span><span class="s1">&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/</span>.<span class="nv">bash_profile</span>
<span class="k">exec</span> $<span class="nv">SHELL</span> <span class="o">-</span><span class="nv">l</span>
</pre></div>


<div class="highlight"><pre><span></span>$ which pkg
/usr/local/sbin/pkg
$ pkg --version
<span class="m">1</span>.5.3-cfa5423
</pre></div>


<p>というわけでビルドは出来ました。が OS X用のバイナリパッケージレポジトリの情報は見つけられず。</p>
<p>pkgコマンドの使い方については<a href="https://github.com/freebsd/pkg#a-quick-usage-introduction-to-pkg">freebsd/pkg</a>のREADMEに<a href="https://github.com/freebsd/pkg#a-quick-usage-introduction-to-pkg">A quick usage introduction to pkg</a>というセクションがありました。</p>
<h1>情報収集中</h1>
<p><a href="https://news.ycombinator.com/item?id=8828866">Baseline Mac OS X Support merged into FreeBSD package manager | Hacker News</a>にいくつか有用な情報がありました。</p>
<ul>
<li><a href="https://news.ycombinator.com/item?id=8829040">This change was written by Landon Fuller, one of the founders of MacPorts. There... | Hacker News</a><ul>
<li>pkgngをOS X対応にするプルリクエスト <a href="https://github.com/freebsd/pkg/pull/1113">Baseline Mac OS X Support by landonf · Pull Request #1113 · freebsd/pkg</a>はMacPorts創始者の1人によるもので、<a href="https://github.com/freebsd/pkg/pull/1113#issuecomment-68063964">Baseline Mac OS X Support by landonf · Pull Request #1113 · freebsd/pkg</a>のコメントによるとMacPortsのtclで書いている部分をlibpkgを使って書き直すことが出来るかを模索するつもりらしいです。</li>
</ul>
</li>
<li><a href="https://news.ycombinator.com/item?id=8829179">You can already have that with pkgsrc for osx - joyent maintains the osx binary ... | Hacker News</a><ul>
<li>このスレッドによるとpkgngがOS X対応する前から<a href="http://pkgsrc.joyent.com/">pkgsrc</a>というパッケージ管理システムがあるそうです。Node.jsのJoyent, Inc.が作ってるんですね。</li>
<li><a href="http://www.saveosx.org/">saveosx</a>にYosemite 64bit用のバイナリパッケージがあるようです。</li>
</ul>
</li>
</ul>
<p>ということで、今後どうなっていくか要注目です。</p>
<h1>2015-06-13追記 pkgsrcについて訂正</h1>
<p><a href="https://www.pkgsrc.org/">pkgsrc</a>自体はFreeBSDのportsからフォークしてNetBSDで開発されているもので、Joyent, Inc.が提供しているのはSmartOS/illumos, Mac OS X, and Linux用のバイナリバッケージでした。</p>
<ul>
<li><a href="http://pkgsrc.joyent.com/">pkgsrc</a></li>
<li><a href="https://en.wikipedia.org/wiki/Pkgsrc">pkgsrc - Wikipedia, the free encyclopedia</a></li>
</ul>
<p>また <a href="http://www.saveosx.org/">saveosx</a>は<a href="https://github.com/cmacrae/saveosx">cmacrae/saveosx</a>を見るとOS X用のpkgsrcをインストールするためのスクリプトでした。パッケージ自体はJoyentが提供しているそうです。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>