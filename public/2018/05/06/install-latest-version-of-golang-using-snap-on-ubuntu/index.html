<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>Ubuntuでsnapを使って最新バージョンのgoをインストール</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2018/05/06/install-latest-version-of-golang-using-snap-on-ubuntu/" rel="bookmark"
           title="Permalink to Ubuntuでsnapを使って最新バージョンのgoをインストール">Ubuntuでsnapを使って最新バージョンのgoをインストール</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-05-06T15:10:00+09:00">
                Published: 2018-05-06
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/ubuntu.html">ubuntu</a> <a href="../../../../tag/snap.html">snap</a> <a href="../../../../tag/go.html">go</a> </p>
</footer><!-- /.post-info -->      <div class="section" id="id1">
<h2>結論</h2>
<p>私が今後あちこちの環境でインストールすることになるので結論を先にメモしておきます。</p>
<p>Ubuntuでsnapを使ってgo 1.10.xの最新版をインストールするには以下のコマンドを実行すればOKです。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo snap install --channel<span class="o">=</span><span class="m">1</span>.10/stable --classic go
</pre></div>
</div>
<div class="section" id="id2">
<h2>背景</h2>
<p>Ubuntu 18.04をリリースしてすぐに試してみたところ、aptでgoの1.10.1がインストールできました。その後 2018-05-01 に 1.10.2 がリリースされました (<a class="reference external" href="https://golang.org/doc/devel/release.html">Release History - The Go Programming Language</a> 参照)が、2018-05-16時点ではaptでインストールできるdebパッケージは1.10.1のままでした。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> apt show golang-1.10 <span class="p">|</span> head -10

<span class="go">WARNING: apt does not have a stable CLI interface. Use with caution in scripts.</span>

<span class="go">Package: golang-1.10</span>
<span class="go">Version: 1.10.1-1ubuntu2</span>
<span class="go">Priority: optional</span>
<span class="go">Section: devel</span>
<span class="go">Origin: Ubuntu</span>
<span class="go">Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;</span>
<span class="go">Original-Maintainer: Go Compiler Team &lt;pkg-golang-devel@lists.alioth.debian.org&gt;</span>
<span class="go">Bugs: https://bugs.launchpad.net/ubuntu/+filebug</span>
<span class="go">Installed-Size: 86.0 kB</span>
<span class="go">Depends: golang-1.10-doc (&gt;= 1.10.1-1ubuntu2), golang-1.10-go (&gt;= 1.10.1-1ubuntu2), golang-1.10-src (&gt;= 1.10.1-1ubuntu2)</span>
</pre></div>
<p>一方、snap (<a class="reference external" href="https://snapcraft.io/">Snapcraft - Snaps are universal Linux packages</a> ) ではチャンネルを選択することで1.10.2がインストール可能でした。ということで手順をメモしておきます。</p>
</div>
<div class="section" id="snapgo">
<h2>snapでgoの最新版をインストール</h2>
<div class="section" id="id3">
<h3>チャンネルごとのバージョン確認</h3>
<p>snapのパッケージは複数のチャンネルを持つことができ、安定版とベータ版を両方インストールしておいて切り替えて使うことができるようです。 <a class="reference external" href="https://docs.snapcraft.io/reference/channels">Channels - Snaps are universal Linux packages</a> を参照してください。</p>
<p>まずgoパッケージの情報を表示してチャンネル毎のバージョンを確認します。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> snap info go
<span class="go">name:      go</span>
<span class="go">summary:   Go programming language compiler, linker, stdlib</span>
<span class="go">publisher: mwhudson</span>
<span class="go">contact:   michael.hudson@ubuntu.com</span>
<span class="go">license:   BSD-3-Clause</span>
<span class="go">description: |</span>
<span class="go">  This snap provides an assembler, compiler, linker, and compiled libraries for the Go programming</span>
<span class="go">  language.</span>
<span class="go">snap-id: Md1HBASHzP4i0bniScAjXGnOII9cEK6e</span>
<span class="go">channels:</span>
<span class="go">  stable:         1.10.1        (1688) 66MB classic</span>
<span class="go">  candidate:      ↑</span>
<span class="go">  beta:           ↑</span>
<span class="go">  edge:           devel-5cf3e34 (1904) 77MB classic</span>
<span class="go">  1.10/stable:    1.10.2        (1880) 66MB classic</span>
<span class="go">  1.10/candidate: ↑</span>
<span class="go">  1.10/beta:      ↑</span>
<span class="go">  1.10/edge:      ↑</span>
<span class="go">  1.6/stable:     1.6.4         (122)  49MB classic</span>
<span class="go">  1.6/candidate:  ↑</span>
<span class="go">  1.6/beta:       ↑</span>
<span class="go">  1.6/edge:       ↑</span>
<span class="go">  1.7/stable:     1.7.6         (324)  48MB classic</span>
<span class="go">  1.7/candidate:  ↑</span>
<span class="go">  1.7/beta:       ↑</span>
<span class="go">  1.7/edge:       ↑</span>
<span class="go">  1.8/stable:     1.8.7         (1407) 51MB classic</span>
<span class="go">  1.8/candidate:  ↑</span>
<span class="go">  1.8/beta:       ↑</span>
<span class="go">  1.8/edge:       ↑</span>
<span class="go">  1.9/stable:     1.9.6         (1873) 58MB classic</span>
<span class="go">  1.9/candidate:  ↑</span>
<span class="go">  1.9/beta:       ↑</span>
<span class="go">  1.9/edge:       ↑</span>
</pre></div>
<p>デフォルトのstableチャンネルではgoのバージョンは1.10.1ですが、1.10/stableチャンネルなら1.10.2であることがわかります。</p>
</div>
<div class="section" id="snapconfinement">
<h3>(参考) snapのconfinementについて</h3>
<p>1.10/stableチャンネルを指定してgoをインストールしようとすると、以下のエラーが出ました。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo snap install --channel<span class="o">=</span><span class="m">1</span>.10/stable go
<span class="go">error: This revision of snap &quot;go&quot; was published using classic confinement and thus may perform</span>
<span class="go">       arbitrary system changes outside of the security sandbox that snaps are usually confined to,</span>
<span class="go">       which may put your system at risk.</span>

<span class="go">       If you understand and want to proceed repeat the command including --classic.</span>
</pre></div>
<p>classic confinementというのは何だろうと思って検索すると
<a class="reference external" href="https://insights.ubuntu.com/2017/01/09/how-to-snap-introducing-classic-confinement">How to snap: introducing classic confinement | Ubuntu Insights</a>
とそこからリンクされている <a class="reference external" href="https://docs.snapcraft.io/reference/confinement">Confinement - Snaps are universal Linux packages</a> に説明がありました。</p>
<p><a class="reference external" href="https://eow.alc.co.jp/search?q=confinement">confinementの意味・用例｜英辞郎 on the WEB：アルク</a> によるとconfiementは「監禁」や「閉じ込め」という意味です。</p>
<p>snapのパッケージのconfinementはデフォルトではstrictというのになっていて、パッケージが依存するライブラリはすべてバンドルし、パッケージが読み書き可能なディレクトリはsnap用の特定のディレクトリに限定されるようになっているそうです。</p>
<p>一方classic confinementでは従来のdebパッケージのようにシステム全体にフルアクセスが可能とのことです。</p>
</div>
<div class="section" id="go-1-10-x1-10-2">
<h3>go 1.10.xの最新版1.10.2をインストール</h3>
<p><code>snap install</code> のオプションを確認します。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> snap install --help
<span class="go">Usage:</span>
<span class="go">  snap [OPTIONS] install [install-OPTIONS] &lt;snap&gt;...</span>

<span class="go">The install command installs the named snap in the system.</span>

<span class="go">Application Options:</span>
<span class="go">      --version              Print the version and exit</span>

<span class="go">Help Options:</span>
<span class="go">  -h, --help                 Show this help message</span>

<span class="go">[install command options]</span>
<span class="go">          --channel=         Use this channel instead of stable</span>
<span class="go">          --edge             Install from the edge channel</span>
<span class="go">          --beta             Install from the beta channel</span>
<span class="go">          --candidate        Install from the candidate channel</span>
<span class="go">          --stable           Install from the stable channel</span>
<span class="go">          --devmode          Put snap in development mode and disable security confinement</span>
<span class="go">          --jailmode         Put snap in enforced confinement mode</span>
<span class="go">          --classic          Put snap in classic mode and disable security confinement</span>
<span class="go">          --revision=        Install the given revision of a snap, to which you must have developer access</span>
<span class="go">          --dangerous        Install the given snap file even if there are no pre-acknowledged signatures for it, meaning it was not verified and</span>
<span class="go">                             could be dangerous (--devmode implies this)</span>
<span class="go">          --unaliased        Install the given snap without enabling its automatic aliases</span>
</pre></div>
<p>以下のコマンドで1.10.xの最新版をインストールします。</p>
<div class="highlight"><pre><span></span><span class="go">sudo snap install --channel=1.10/stable --classic go</span>
</pre></div>
<p>インストールしたgoのパスとバージョンを確認すると以下のようになっていました。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> which go
<span class="go">/snap/bin/go</span>
<span class="gp">$</span> go version
<span class="go">go version go1.10.2 linux/amd64</span>
</pre></div>
</div>
<div class="section" id="snap-refresh">
<h3>(参考) インストール後のチャンネル切り替えはsnap refreshで</h3>
<p>最初に試したときはまず以下のコマンドで stable チャンネルのgo 1.10.1をインストールしていました。</p>
<div class="highlight"><pre><span></span><span class="go">sudo snap install --classic go</span>
</pre></div>
<p>goのパスとバージョンは以下のとおりです。</p>
<p>ちなみに、aptでもgolangをインストールしているとそちらが優先されます。 <code>PATH</code> 環境変数を確認すると <code>/usr/bin</code> が <code>/snap/bin</code> よりも先に指定されていました。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> which go
<span class="go">/snap/bin/go</span>
<span class="gp">$</span> go version
<span class="go">go version go1.10.1 linux/amd64</span>
</pre></div>
<p>この状態で <code>1.10/stable</code> チャンネルのgoをインストールしようとして以下のコマンドを試してみるとすでにインストール済みなので snap refresh を使うように言われました。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo snap install --classic --channel<span class="o">=</span><span class="m">1</span>.10/stable go
<span class="go">snap &quot;go&quot; is already installed, see &quot;snap refresh --help&quot;</span>
</pre></div>
<p>以下のようにすればインストールして切り替えできました。</p>
<div class="highlight"><pre><span></span><span class="go">sudo snap refresh --classic --channel=1.10/stable go</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="gp">$</span> which go
<span class="go">/snap/bin/go</span>
<span class="gp">$</span> go version
<span class="go">go version go1.10.2 linux/amd64</span>
</pre></div>
</div>
</div>
<div class="section" id="godoc">
<h2>godocは別途インストールが必要</h2>
<p>godocを使おうとしたら以下のエラーになり <code>golang-golang-x-tools</code> パッケージをインストールすれば使えるとのことでした。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> godoc -http<span class="o">=</span>:6060
<span class="go">The program &#39;godoc&#39; is currently not installed. You can install it by typing:</span>
<span class="go">sudo apt install golang-golang-x-tools</span>
</pre></div>
<p>2018-05-06時点では <code>golang-golang-x-tools</code> パッケージのバージョンは以下のように 2016-03-15時点の
<a class="reference external" href="https://github.com/golang/tools/commit/f42ec616d3061dd0a453e8f174d62b38eddab928">go/gcimporter15: require go1.6 for binary import/export (fix build) · golang/tools&#64;f42ec61</a>
のコミットに対応したものになっていました。</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> sudo apt show golang-golang-x-tools <span class="p">|</span> grep ^Version:
<span class="go">Version: 1:0.0~git20160315.0.f42ec61-2</span>
</pre></div>
<p>これより新しい版を使いたい場合は <a class="reference external" href="https://github.com/golang/tools">golang/tools: [mirror] Go Tools</a> にあるように <code>go get</code> でインストールするのが手軽そうです。</p>
<div class="highlight"><pre><span></span><span class="go">go get -u golang.org/x/tools/...</span>
</pre></div>
</div>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>