<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Virtualbox on hnakamur&#39;s blog at github</title>
    <link>/blog/tags/virtualbox/</link>
    <description>Recent content in Virtualbox on hnakamur&#39;s blog at github</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <lastBuildDate>Mon, 01 Jun 2015 06:04:04 +0900</lastBuildDate>
    <atom:link href="/blog/tags/virtualbox/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Vagrant &#43; Virtualboxでのディスク追加</title>
      <link>/blog/2015/06/01/add_secondary_disk_to_vagrant_virtualbox/</link>
      <pubDate>Mon, 01 Jun 2015 06:04:04 +0900</pubDate>
      
      <guid>/blog/2015/06/01/add_secondary_disk_to_vagrant_virtualbox/</guid>
      <description>

&lt;p&gt;Vagrant + Virtualboxでのディスク追加についてのメモです。&lt;/p&gt;

&lt;h2 id=&#34;ディスク追加の設定:40c70228a5a6466de34e77416297a27f&#34;&gt;ディスク追加の設定&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://stackoverflow.com/questions/21050496/vagrant-virtualbox-second-disk-path/26743144#26743144&#34;&gt;http://stackoverflow.com/questions/21050496/vagrant-virtualbox-second-disk-path/26743144#26743144&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://gist.github.com/leifg/4713995#comment-1206250&#34;&gt;https://gist.github.com/leifg/4713995#comment-1206250&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;を参考に以下のようにしました。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(2) do |config|
  config.vm.box = &#39;base&#39;

  config.vm.provider &amp;quot;virtualbox&amp;quot; do |p|
    vagrant_root = File.dirname(File.expand_path(__FILE__))
    file_to_disk = File.join(vagrant_root, &#39;ad1.vdi&#39;)
    unless File.exist?(file_to_disk)
      vb.customize [&#39;createhd&#39;, &#39;--filename&#39;, file_to_disk, &#39;--size&#39;, 500 * 1024]
    end
    vb.customize [&#39;storageattach&#39;, :id, &#39;--storagectl&#39;, &#39;SATA Controller&#39;, &#39;--port&#39;, 1, &#39;--device&#39;, 0, &#39;--type&#39;, &#39;hdd&#39;, &#39;--medium&#39;, file_to_disk]
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上記の後者のリンク先では &lt;code&gt;Vagrantfile&lt;/code&gt; のあるディレクトリを &lt;code&gt;VAGRANT_ROOT&lt;/code&gt; と大文字で定数に設定していますが、私は &lt;code&gt;vagrant_root&lt;/code&gt; と小文字で変数にしました。&lt;/p&gt;

&lt;p&gt;デバッグプリントを入れてみてわかったのですが、このブロックは1度ではなく複数回呼ばれます。定数だと既に初期化済みの警告が出るので変数にしたというわけです。&lt;/p&gt;

&lt;h2 id=&#34;sata-controllerの作成はpackerで行っておく:40c70228a5a6466de34e77416297a27f&#34;&gt;SATA Controllerの作成はpackerで行っておく&lt;/h2&gt;

&lt;p&gt;上の設定だけでは &lt;a href=&#34;https://github.com/hnakamur/freebsd-packer/tree/ef57aff51b02a03e658f0348eb5e463ed08735aa&#34;&gt;https://github.com/hnakamur/freebsd-packer/tree/ef57aff51b02a03e658f0348eb5e463ed08735aa&lt;/a&gt; で作ったFreeBSD 10.1 amd64のboxではSATA Controllerが無いためうまく行きませんでした。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://gist.github.com/leifg/4713995#comment-1374268&#34;&gt;https://gist.github.com/leifg/4713995#comment-1374268&lt;/a&gt; でVagrantにモンキーパッチで対応しようとしているがうまくいかない例がありました。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/mitchellh/vagrant/issues/4015#issuecomment-45930125&#34;&gt;Rescue customization exception · Issue #4015 · mitchellh/vagrant&lt;/a&gt;のVagrant開発者のコメントで、Vagrantfileの設定は手続き型ではなく宣言型なので、Vagrantfileの設定では無理でVagrantプラグインを作る必要があると書かれています。&lt;/p&gt;

&lt;p&gt;結局 &lt;a href=&#34;https://github.com/hnakamur/freebsd-packer/commit/fc041427ffd9de330d390036ebd0948f01e707fe&#34;&gt;https://github.com/hnakamur/freebsd-packer/commit/fc041427ffd9de330d390036ebd0948f01e707fe&lt;/a&gt; のようにpackerのテンプレートを作る際にSATA Controllerも作っておくのがお手軽だったのでそうしました。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>