<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.122.0">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Ubuntuで日本語キーボードのCapsLockをControlに変更する &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMMXGG2Z56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMMXGG2Z56');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2024. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Ubuntuで日本語キーボードのCapsLockをControlに変更する</h1>
  <time datetime=2022-09-19T10:25:42&#43;0900 class="post-date">2022-09-19</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#英語キーボードでcapslockとcontrol入れ替え">英語キーボードでCapsLockとControl入れ替え</a></li>
    <li><a href="#日本語キーボードではcapslockをcontrolに置き換え">日本語キーボードではCapsLockをControlに置き換え</a></li>
    <li><a href="#余談-ctrlnocaps-と-capsctrl_modifier-の違い">余談: <code>ctrl:nocaps</code> と <code>caps:ctrl_modifier</code> の違い</a></li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p>英語キーボードだけ使うようになって随分経つのですが、また日本語キーボードも併用できるようにしようと日本語キーボードも使い始めています。</p>
<h2 id="英語キーボードでcapslockとcontrol入れ替え">英語キーボードでCapsLockとControl入れ替え</h2>
<p>英語キーボードのときは以下のように設定変更してCapsLockとControlと入れ替えていました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo sed -i <span class="s1">&#39;s/^XKBOPTIONS=.*/XKBOPTIONS=&#34;ctrl:swapcaps&#34;/&#39;</span> /etc/default/keyboard
</span></span></code></pre></div><p>XKBOPTIONSの設定値は /usr/share/X11/xkb/rules/xorg.lst に書いてあります (<code>man 5 keyboard</code> のFILESセクションで知りました)。</p>
<p>反映はGNOMEをログアウト、ログインにしていましたが、<a href="https://linux.just4fun.biz/?Ubuntu/Caps-Lock%E3%82%AD%E3%83%BC%E3%82%92Ctrl%E3%82%AD%E3%83%BC%E3%81%AB%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95">Ubuntu/Caps-LockキーをCtrlキーにする方法 - Linuxと過ごす</a> によると <code>sudo systemctl restart console-setup</code> で良いそうです。</p>
<h2 id="日本語キーボードではcapslockをcontrolに置き換え">日本語キーボードではCapsLockをControlに置き換え</h2>
<p>CapsLockとControl入れ替えだとControl+Shiftを押したときにCapsLockが動いてしまうことがわかりました。</p>
<p>ターミナルでのコピーとペーストに Control+Shift+C と Control+Shift+V を多用するのでこれはつらいです。</p>
<p>そこで以下のようにCapsLockをControlにする設定を試してみました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo sed -i <span class="s1">&#39;s/^XKBOPTIONS=.*/XKBOPTIONS=&#34;ctrl:nocaps&#34;/&#39;</span> /etc/default/keyboard
</span></span></code></pre></div><p>が、これでも Control+Shift を押したときに CapsLock が動いてしまうようです。</p>
<p><code>gsettings</code> で <code>org.gnome.desktop.input-sources</code> の <code>xkb-options</code> を確認してみたところ、以下のように <code>ctrl:swapcaps</code> になっていました。</p>
<pre tabindex="0"><code>$ gsettings get org.gnome.desktop.input-sources xkb-options
[&#39;ctrl:swapcaps&#39;]
</code></pre><p>以下のように <code>gsettings</code> でも <code>ctrl:nocaps</code> に設定すると期待の動きになりました。 <code>gsettings set</code> は追加の操作なしで即座に反映されるようです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gsettings <span class="nb">set</span> org.gnome.desktop.input-sources xkb-options <span class="s2">&#34;[&#39;ctrl:nocaps&#39;]&#34;</span>
</span></span></code></pre></div><h2 id="余談-ctrlnocaps-と-capsctrl_modifier-の違い">余談: <code>ctrl:nocaps</code> と <code>caps:ctrl_modifier</code> の違い</h2>
<p>検索してたら <code>caps:ctrl_modifier</code> というのもあることを知りました。
ただ <code>/usr/share/X11/xkb/rules/xorg.lst</code> の説明は以下のようになっていて違いがよくわかりません。</p>
<pre tabindex="0"><code>$ grep -E &#39;(ctrl:nocaps|caps:ctrl_modifier)&#39; /usr/share/X11/xkb/rules/xorg.lst
  ctrl:nocaps          Caps Lock as Ctrl
  caps:ctrl_modifier   Make Caps Lock an additional Ctrl
</code></pre><p>検索すると
<a href="https://www.reddit.com/r/commandline/comments/4gusjx/setxkbmap_whats_the_difference_between_capsctrl/">setxkbmap: What&rsquo;s the difference between caps:ctrl_modifier and ctrl:nocaps? : commandline</a> で2つの定義などがコメントされていました。</p>
<p>Ubuntu 22.04 LTS の環境では以下のようになっていました。</p>
<p><code>/usr/share/X11/xkb/symbols/ctrl</code></p>
<pre tabindex="0"><code>…(略)…
// Eliminate CapsLock, making it another Ctrl.
partial modifier_keys
xkb_symbols &#34;nocaps&#34; {
    replace key &lt;CAPS&gt; { [ Control_L, Control_L ] };
    modifier_map  Control { &lt;CAPS&gt;, &lt;LCTL&gt; };
};
…(略)…
</code></pre><p><code>/usr/share/X11/xkb/symbols/capslock</code></p>
<pre tabindex="0"><code>…(略)…
// This changes the &lt;CAPS&gt; key to become a Control modifier,
// but it will still produce the Caps_Lock keysym.
hidden partial modifier_keys
xkb_symbols &#34;ctrl_modifier&#34; {
    replace key &lt;CAPS&gt; {
        type[Group1] = &#34;ONE_LEVEL&#34;,
        symbols[Group1] = [ Caps_Lock ],
        actions[Group1] = [ SetMods(modifiers=Control) ]
    };
    modifier_map Control { &lt;CAPS&gt; };
};
…(略)…
</code></pre><p>私の用途では <code>ctrl:nocaps</code> で良さそうです。</p>
<p>上のコメントでは左右のShift同時押しでCapsLockにする設定 <code>shift:both_capslock</code> も紹介されていました。</p>
<p><code>/usr/share/X11/xkb/symbols/shift</code></p>
<pre tabindex="0"><code>…(略)…
// Toggle CapsLock when pressed together with the other Shift key.
partial modifier_keys
xkb_symbols &#34;lshift_both_capslock&#34; {
  key &lt;LFSH&gt; {
    type[Group1]=&#34;TWO_LEVEL&#34;,
    symbols[Group1] = [ Shift_L, Caps_Lock ]
  };
};
// Toggle CapsLock when pressed together with the other Shift key.
partial modifier_keys
xkb_symbols &#34;rshift_both_capslock&#34; {
  key &lt;RTSH&gt; {
    type[Group1]=&#34;TWO_LEVEL&#34;,
    symbols[Group1] = [ Shift_R, Caps_Lock ]
  };
};
partial modifier_keys
xkb_symbols &#34;both_capslock&#34; {
  include &#34;shift(lshift_both_capslock)&#34;
  include &#34;shift(rshift_both_capslock)&#34;
};
…(略)…
</code></pre>
</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>
  </body>
</html>
