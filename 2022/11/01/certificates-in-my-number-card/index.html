<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.111.2">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>マイナンバーカードに含まれる2つの電子証明書について調べてみた &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMMXGG2Z56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMMXGG2Z56');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2023. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>マイナンバーカードに含まれる2つの電子証明書について調べてみた</h1>
  <time datetime=2022-11-01T21:39:34&#43;0900 class="post-date">2022-11-01</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#マイナンバーカードに含まれる2つの電子証明">マイナンバーカードに含まれる2つの電子証明</a></li>
    <li><a href="#電子証明書の表示方法">電子証明書の表示方法</a></li>
    <li><a href="#基本4情報">基本4情報</a></li>
    <li><a href="#鍵用途">鍵用途</a>
      <ul>
        <li><a href="#2022-11-06-追記鍵用途もドキュメントに記載されていました">2022-11-06 追記。鍵用途もドキュメントに記載されていました。</a></li>
      </ul>
    </li>
    <li><a href="#x509v3-issuer-alternative-name">X509v3 Issuer Alternative Name</a></li>
    <li><a href="#認証局の自己署名証明書">認証局の自己署名証明書</a></li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p>マイナンバーカードに含まれる2つの電子証明書について調べてみたのでメモです。</p>
<h2 id="マイナンバーカードに含まれる2つの電子証明">マイナンバーカードに含まれる2つの電子証明</h2>
<p><a href="https://www.soumu.go.jp/kojinbango_card/kojinninshou-01.html">総務省｜マイナンバー制度とマイナンバーカード｜公的個人認証サービスによる電子証明書</a> によるとマイナンバーカードには2つの電子証明書が含まれています。</p>
<ul>
<li>署名用電子証明書</li>
<li>利用者証明用電子証明書</li>
</ul>
<p>上のページでは図の画像が小さいですが <a href="https://www.soumu.go.jp/main_content/000528384.pdf">マイナンバーカードと公的個人認証制度の概要について (PDF)</a> では大きな図が見られます。
なお、署名用秘密鍵と利用者証明用秘密鍵は「秘密鍵を無理に読み出そうとすると、ICチップが壊れる仕組み」とのことです。</p>
<h2 id="電子証明書の表示方法">電子証明書の表示方法</h2>
<p><a href="https://www.jpki.go.jp/download/howto_android/certificate_p01.html">証明書の表示方法 | 公的個人認証サービス ポータルサイト</a> の左のメニューに従ってAndroid用JPKI利用者ソフトアプリをインストールし、このページの手順で確認しました。</p>
<p>表示の際に以下のようにパスワードまたは暗証番号の入力を求められました。
ファイルに出力することもできました。</p>
<table>
<thead>
<tr>
<th>表示対象の証明書</th>
<th>入力するパスワード</th>
<th>出力ファイル名</th>
<th>基本4情報</th>
</tr>
</thead>
<tbody>
<tr>
<td>署名用電子証明書</td>
<td>英数のパスワード</td>
<td>CertUserSignYYYYMMDDHHMMSS.cer</td>
<td>あり</td>
</tr>
<tr>
<td>利用者証明用電子証明書</td>
<td>数字4桁の暗証番号</td>
<td>CertUserAuthYYYYMMDDHHMMSS.cer</td>
<td>なし</td>
</tr>
</tbody>
</table>
<p>出力ファイル名の日付部分は出力した際の日時になっていました。</p>
<h2 id="基本4情報">基本4情報</h2>
<p><a href="https://www.soumu.go.jp/kojinbango_card/03.html">総務省｜マイナンバー制度とマイナンバーカード｜マイナンバーカード</a> に以下の説明があります。</p>
<blockquote>
<p>「署名用電子証明書」は、氏名、住所、生年月日、性別の4情報が記載され、e-Taxの確定申告など電子文書を送信する際に使用できます。</p>
</blockquote>
<p>openssl で 署名用電子証明書の SAN (Subject Alternative Name) を見てみると以下のようになっていました。</p>
<pre tabindex="0"><code>$ openssl x509 -noout -ext subjectAltName -in CertUserSign*.cer
X509v3 Subject Alternative Name:
    othername: 1.2.392.200149.8.5.5.1::【氏名】, othername: 1.2.392.200149.8.5.5.4::【生年月日XYYYYMMDD】, othername: 1.2.392.200149.8.5.5.3::【性別】, othername: 1.2.392.200149.8.5.5.5::【住所】, othername: 1.2.392.200149.8.5.5.2::00000, othername: 1.2.392.200149.8.5.5.6::0000000000000000000000
</code></pre><p>氏名は氏と名が全角空白で区切られていました。住所は郵便番号はなしで都道府県から書かれていました。</p>
<p>2次情報ですが <a href="https://pki.world-tls.com/kojinbango-card/">マイナンバーカード（個人番号カード）に含まれている個人情報・電子証明書の詳細 | Japanese PKI Blog</a> に説明がありましたので引用します。</p>
<pre tabindex="0"><code>X509v3 Subject Alternative Name:
    othername: 1.2.392.200149.8.5.5.1::[氏名：JIS 第 1 水準、第 2 水準、補助漢字以外の文字は代替文字に変換], 
    othername: 1.2.392.200149.8.5.5.4::[生年月日：EYYYYMMDD E=1:明治、2:大正、3:昭和、4:平成、5:令和、0:不明], 
    othername: 1.2.392.200149.8.5.5.3::[性別：1:男、2:女、3:不明], 
    othername: 1.2.392.200149.8.5.5.5::[住所：JIS 第 1 水準、第 2 水準、補助漢字以外の文字は代替文字に変換　全角ハイフン設定可能　最大文字数 200 文字], 
    othername: 1.2.392.200149.8.5.5.2::[利用者の氏名代替文字の使用位置情報：0 代替文字でない　1 代替文字], 
    othername: 1.2.392.200149.8.5.5.6::[利用者の住所代替文字の使用位置情報：0 代替文字でない　1 代替文字]
</code></pre><p>1次情報では <a href="https://www.jpki.go.jp/ca/ca_rules3.html">署名用認証局の運営に関する情報 | 公的個人認証サービス ポータルサイト</a> の <a href="https://www.jpki.go.jp/ca/pdf/sign_cps.pdf">署名用認証局運用規程（PDF・574KB）</a> (PDF内のタイトル：公的個人認証サービス 署名用認証局 運用規程 第 2.1 版 2021 年 9 月 1 日) の「1.2. 文書名と識別」に OID (Object Identifier) について記載があったのですが、 1.2.392.200149.8.5.1.1.X のみで上の 1.2.392.200149.8.5.5.X については記載なしでした。</p>
<p>このファイルのp.12 (PDFのページではp.17) の「3. 識別と認証」の表にsubjectAltName, commonName, dataOfBirth, gender, address について説明がありました。次のページの「3.1.7. 署名用電子証明書の拡張領域に記録する名称の種類と形式」と「3.1.8. 署名用電子証明書の拡張領域に記録する名称の記録方法に関する規則」に使用する文字種についての説明がありました。</p>
<h2 id="鍵用途">鍵用途</h2>
<pre tabindex="0"><code>$ openssl x509 -noout -ext keyUsage -in CertUserSign*.cer
X509v3 Key Usage: critical
    Digital Signature, Non Repudiation
</code></pre><pre tabindex="0"><code>$ openssl x509 -noout -ext keyUsage -in CertUserAuth*.cer
X509v3 Key Usage: critical
    Digital Signature
</code></pre><p><a href="https://www.rfc-editor.org/rfc/rfc5280.html">RFC 5280: Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a> の <a href="https://www.rfc-editor.org/rfc/rfc5280#section-4.2.1.3">4.2.1.3.  Key Usage</a> に KeyUsage の値が書かれていました。</p>
<pre tabindex="0"><code>      KeyUsage ::= BIT STRING {
           digitalSignature        (0),
           nonRepudiation          (1), -- recent editions of X.509 have
                                -- renamed this bit to contentCommitment
           keyEncipherment         (2),
           dataEncipherment        (3),
           keyAgreement            (4),
           keyCertSign             (5),
           cRLSign                 (6),
           encipherOnly            (7),
           decipherOnly            (8) }
</code></pre><p>digitalSignature とnonRepudiation の説明を引用します。</p>
<pre tabindex="0"><code>      The digitalSignature bit is asserted when the subject public key
      is used for verifying digital signatures, other than signatures on
      certificates (bit 5) and CRLs (bit 6), such as those used in an
      entity authentication service, a data origin authentication
      service, and/or an integrity service.

      The nonRepudiation bit is asserted when the subject public key is
      used to verify digital signatures, other than signatures on
      certificates (bit 5) and CRLs (bit 6), used to provide a non-
      repudiation service that protects against the signing entity
      falsely denying some action.  In the case of later conflict, a
      reliable third party may determine the authenticity of the signed
      data.  (Note that recent editions of X.509 have renamed the
      nonRepudiation bit to contentCommitment.)
</code></pre><h3 id="2022-11-06-追記鍵用途もドキュメントに記載されていました">2022-11-06 追記。鍵用途もドキュメントに記載されていました。</h3>
<p><a href="https://www.jpki.go.jp/contact/index.html">お問い合わせ | 公的個人認証サービス ポータルサイト</a> から署名用電子証明書と利用者証明用電子証明書の鍵用途についてもサイトに記載してほしいという要望を出していたのですが、 <a href="https://www.j-lis.go.jp/file/13_profile_genkou.pdf">公的個人認証サービス プロファイル仕様書 2.2 版</a> に記載されているとご回答をいただきました。このドキュメントは <a href="https://www.j-lis.go.jp/jpki/procedure/procedure1_2_3.html">J-LIS 利用者クライアントソフトに係る技術仕様について</a> からリンクされていました。</p>
<h2 id="x509v3-issuer-alternative-name">X509v3 Issuer Alternative Name</h2>
<p>署名用電子証明書と利用者証明用電子証明書の両方で以下のようになっていました。</p>
<pre tabindex="0"><code>$ openssl x509 -noout -ext issuerAltName -in CertUserSign*.cer
X509v3 Issuer Alternative Name:
    DirName:/C=JP/O=\xE5\x85\xAC\xE7\x9A\x84\xE5\x80\x8B\xE4\xBA\xBA\xE8\xAA\x8D\xE8\xA8\xBC\xE3\x82\xB5\xE3\x83\xBC\xE3\x83\x93\xE3\x82\xB9
</code></pre><pre tabindex="0"><code>$ openssl x509 -noout -ext issuerAltName -in CertUserAuth*.cer
X509v3 Issuer Alternative Name:
    DirName:/C=JP/O=\xE5\x85\xAC\xE7\x9A\x84\xE5\x80\x8B\xE4\xBA\xBA\xE8\xAA\x8D\xE8\xA8\xBC\xE3\x82\xB5\xE3\x83\xBC\xE3\x83\x93\xE3\x82\xB9
</code></pre><p>UTF-8文字列をエスケープした部分はデコードしてみると「公的個人認証サービス」でした。</p>
<h2 id="認証局の自己署名証明書">認証局の自己署名証明書</h2>
<p>以下のページに説明と証明書がありました。</p>
<ul>
<li><a href="https://www.jpki.go.jp/ca/ca_rules3.html">署名用認証局の運営に関する情報 | 公的個人認証サービス ポータルサイト</a></li>
<li><a href="https://www.jpki.go.jp/ca/ca_rules4.html">利用者証明用認証局の運営に関する情報 | 公的個人認証サービス ポータルサイト</a></li>
</ul>

</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KMMXGG2Z56', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
