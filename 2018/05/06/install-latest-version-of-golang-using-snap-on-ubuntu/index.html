<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.74.3" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Ubuntuでsnapを使って最新バージョンのgoをインストール &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53263855-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53263855-1');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Ubuntuでsnapを使って最新バージョンのgoをインストール</h1>
  <time datetime=2018-05-06T15:10:00&#43;0900 class="post-date">2018-05-06</time>
  <h1 id="結論">結論</h1>
<p>私が今後あちこちの環境でインストールすることになるので結論を先にメモしておきます。</p>
<p>Ubuntuでsnapを使ってgo 1.10.xの最新版をインストールするには以下のコマンドを実行すればOKです。</p>
<pre><code class="language-console" data-lang="console">$ sudo snap install --channel=1.10/stable --classic go
</code></pre><h1 id="背景">背景</h1>
<p>Ubuntu 18.04をリリースしてすぐに試してみたところ、aptでgoの1.10.1がインストールできました。その後 2018-05-01 に 1.10.2 がリリースされました (<a href="https://golang.org/doc/devel/release.html">Release History - The Go Programming Language</a> 参照)が、2018-05-16時点ではaptでインストールできるdebパッケージは1.10.1のままでした。</p>
<pre><code class="language-console" data-lang="console">$ apt show golang-1.10 | head -10

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Package: golang-1.10
Version: 1.10.1-1ubuntu2
Priority: optional
Section: devel
Origin: Ubuntu
Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;
Original-Maintainer: Go Compiler Team &lt;pkg-golang-devel@lists.alioth.debian.org&gt;
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: 86.0 kB
Depends: golang-1.10-doc (&gt;= 1.10.1-1ubuntu2), golang-1.10-go (&gt;= 1.10.1-1ubuntu2), golang-1.10-src (&gt;= 1.10.1-1ubuntu2)
</code></pre><p>一方、snap (<a href="https://snapcraft.io/">Snapcraft - Snaps are universal Linux packages</a> ) ではチャンネルを選択することで1.10.2がインストール可能でした。ということで手順をメモしておきます。</p>
<h1 id="snapでgoの最新版をインストール">snapでgoの最新版をインストール</h1>
<h2 id="チャンネルごとのバージョン確認">チャンネルごとのバージョン確認</h2>
<p>snapのパッケージは複数のチャンネルを持つことができ、安定版とベータ版を両方インストールしておいて切り替えて使うことができるようです。 <a href="https://docs.snapcraft.io/reference/channels">Channels - Snaps are universal Linux packages</a> を参照してください。</p>
<p>まずgoパッケージの情報を表示してチャンネル毎のバージョンを確認します。</p>
<pre><code class="language-console" data-lang="console">$ snap info go
name:      go
summary:   Go programming language compiler, linker, stdlib
publisher: mwhudson
contact:   michael.hudson@ubuntu.com
license:   BSD-3-Clause
description: |
  This snap provides an assembler, compiler, linker, and compiled libraries for the Go programming
  language.
snap-id: Md1HBASHzP4i0bniScAjXGnOII9cEK6e
channels:
  stable:         1.10.1        (1688) 66MB classic
  candidate:      ↑
  beta:           ↑
  edge:           devel-5cf3e34 (1904) 77MB classic
  1.10/stable:    1.10.2        (1880) 66MB classic
  1.10/candidate: ↑
  1.10/beta:      ↑
  1.10/edge:      ↑
  1.6/stable:     1.6.4         (122)  49MB classic
  1.6/candidate:  ↑
  1.6/beta:       ↑
  1.6/edge:       ↑
  1.7/stable:     1.7.6         (324)  48MB classic
  1.7/candidate:  ↑
  1.7/beta:       ↑
  1.7/edge:       ↑
  1.8/stable:     1.8.7         (1407) 51MB classic
  1.8/candidate:  ↑
  1.8/beta:       ↑
  1.8/edge:       ↑
  1.9/stable:     1.9.6         (1873) 58MB classic
  1.9/candidate:  ↑
  1.9/beta:       ↑
  1.9/edge:       ↑
</code></pre><p>デフォルトのstableチャンネルではgoのバージョンは1.10.1ですが、1.10/stableチャンネルなら1.10.2であることがわかります。</p>
<h2 id="参考-snapのconfinementについて">(参考) snapのconfinementについて</h2>
<p>1.10/stableチャンネルを指定してgoをインストールしようとすると、以下のエラーが出ました。</p>
<pre><code class="language-console" data-lang="console">$ sudo snap install --channel=1.10/stable go
error: This revision of snap &quot;go&quot; was published using classic confinement and thus may perform
       arbitrary system changes outside of the security sandbox that snaps are usually confined to,
       which may put your system at risk.

       If you understand and want to proceed repeat the command including --classic.
</code></pre><p>classic confinementというのは何だろうと思って検索すると
<a href="https://insights.ubuntu.com/2017/01/09/how-to-snap-introducing-classic-confinement">How to snap: introducing classic confinement | Ubuntu Insights</a>
とそこからリンクされている <a href="https://docs.snapcraft.io/reference/confinement">Confinement - Snaps are universal Linux packages</a> に説明がありました。</p>
<p><a href="https://eow.alc.co.jp/search?q=confinement">confinementの意味・用例｜英辞郎 on the WEB：アルク</a> によるとconfiementは「監禁」や「閉じ込め」という意味です。</p>
<p>snapのパッケージのconfinementはデフォルトではstrictというのになっていて、パッケージが依存するライブラリはすべてバンドルし、パッケージが読み書き可能なディレクトリはsnap用の特定のディレクトリに限定されるようになっているそうです。</p>
<p>一方classic confinementでは従来のdebパッケージのようにシステム全体にフルアクセスが可能とのことです。</p>
<h2 id="go-110xの最新版1102をインストール">go 1.10.xの最新版1.10.2をインストール</h2>
<p><code>snap install</code> のオプションを確認します。</p>
<pre><code class="language-console" data-lang="console">$ snap install --help
Usage:
  snap [OPTIONS] install [install-OPTIONS] &lt;snap&gt;...

The install command installs the named snap in the system.

Application Options:
      --version              Print the version and exit

Help Options:
  -h, --help                 Show this help message

[install command options]
          --channel=         Use this channel instead of stable
          --edge             Install from the edge channel
          --beta             Install from the beta channel
          --candidate        Install from the candidate channel
          --stable           Install from the stable channel
          --devmode          Put snap in development mode and disable security confinement
          --jailmode         Put snap in enforced confinement mode
          --classic          Put snap in classic mode and disable security confinement
          --revision=        Install the given revision of a snap, to which you must have developer access
          --dangerous        Install the given snap file even if there are no pre-acknowledged signatures for it, meaning it was not verified and
                             could be dangerous (--devmode implies this)
          --unaliased        Install the given snap without enabling its automatic aliases
</code></pre><p>以下のコマンドで1.10.xの最新版をインストールします。</p>
<pre><code class="language-console" data-lang="console">sudo snap install --channel=1.10/stable --classic go
</code></pre><p>インストールしたgoのパスとバージョンを確認すると以下のようになっていました。</p>
<pre><code class="language-console" data-lang="console">$ which go
/snap/bin/go
$ go version
go version go1.10.2 linux/amd64
</code></pre><h2 id="参考-インストール後のチャンネル切り替えはsnap-refreshで">(参考) インストール後のチャンネル切り替えはsnap refreshで</h2>
<p>最初に試したときはまず以下のコマンドで stable チャンネルのgo 1.10.1をインストールしていました。</p>
<pre><code class="language-console" data-lang="console">sudo snap install --classic go
</code></pre><p>goのパスとバージョンは以下のとおりです。</p>
<p>ちなみに、aptでもgolangをインストールしているとそちらが優先されます。 <code>PATH</code> 環境変数を確認すると <code>/usr/bin</code> が <code>/snap/bin</code> よりも先に指定されていました。</p>
<pre><code class="language-console" data-lang="console">$ which go
/snap/bin/go
$ go version
go version go1.10.1 linux/amd64
</code></pre><p>この状態で <code>1.10/stable</code> チャンネルのgoをインストールしようとして以下のコマンドを試してみるとすでにインストール済みなので snap refresh を使うように言われました。</p>
<pre><code class="language-console" data-lang="console">$ sudo snap install --classic --channel=1.10/stable go
snap &quot;go&quot; is already installed, see &quot;snap refresh --help&quot;
</code></pre><p>以下のようにすればインストールして切り替えできました。</p>
<pre><code class="language-console" data-lang="console">sudo snap refresh --classic --channel=1.10/stable go
</code></pre><p>.. code-block:: console</p>
<pre><code>    $ which go
    /snap/bin/go
    $ go version
    go version go1.10.2 linux/amd64
</code></pre>
<h1 id="godocは別途インストールが必要">godocは別途インストールが必要</h1>
<p>godocを使おうとしたら以下のエラーになり <code>golang-golang-x-tools</code> パッケージをインストールすれば使えるとのことでした。</p>
<pre><code class="language-console" data-lang="console">$ godoc -http=:6060
The program 'godoc' is currently not installed. You can install it by typing:
sudo apt install golang-golang-x-tools
</code></pre><p>2018-05-06時点では <code>golang-golang-x-tools</code> パッケージのバージョンは以下のように 2016-03-15時点の
<a href="https://github.com/golang/tools/commit/f42ec616d3061dd0a453e8f174d62b38eddab928">go/gcimporter15: require go1.6 for binary import/export (fix build) · golang/tools@f42ec61</a>
のコミットに対応したものになっていました。</p>
<pre><code class="language-console" data-lang="console">$ sudo apt show golang-golang-x-tools | grep ^Version:
Version: 1:0.0~git20160315.0.f42ec61-2
</code></pre><p>これより新しい版を使いたい場合は <a href="https://github.com/golang/tools">golang/tools: [mirror] Go Tools</a> にあるように <code>go get</code> でインストールするのが手軽そうです。</p>
<pre><code class="language-console" data-lang="console">go get -u golang.org/x/tools/...
</code></pre>
</div>


    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-53263855-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
