<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>Ubuntu 17.10とmacOS High Sierraでデュアルブート構成にしてみた</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2018/03/23/ubuntu-17.10-mac-os-high-sierra-dual-boot/" rel="bookmark"
           title="Permalink to Ubuntu 17.10とmacOS High Sierraでデュアルブート構成にしてみた">Ubuntu 17.10とmacOS High Sierraでデュアルブート構成にしてみた</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-03-23T14:50:00+09:00">
                Published: 2018-03-23
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/ubuntu.html">ubuntu</a> <a href="../../../../tag/macos.html">macOS</a> </p>
</footer><!-- /.post-info -->      <div class="section" id="id1">
<h2>はじめに</h2>
<p>個人的にLinuxデスクトップの機運が高まってきたので、Ubuntu 17.10のデスクトップ環境を試してみました。
例によって自分用メモです。</p>
<p>FlutterでiOSアプリをビルドするのを試してみたりするのにmacOSは引き続き必要なのでデュアルブート
構成にします。</p>
<p>Antergosを試そうかとも思ったのですが、自宅サーバでUbuntuを使っていてPPAで独自debパッケージを作る
のにも慣れてきていることもあり、まずはUbuntuのデスクトップ環境を試すことにしました。</p>
<p>1ヶ月後にはUbuntu 18.04 LTSが出るので、そちらのベータとかdaily buildを試すのも良さそうかとも
思ったのですが、 Linuxデスクトップを使うのは約10年ぶりなのでまずは安定版で慣れようということで
Ubuntu 17.10にしました。</p>
<p>今回試したのは MacBook Pro 15-inch, Mid 2012 です。</p>
<p>インストールの手順自体は
<a class="reference external" href="https://linuxfan.info/ubuntu-17-10-install-guide">Ubuntu 17.10インストールガイド【スクリーンショットつき解説】 | Linux Fan</a> に詳しい説明があるのでそちらを参照してください。</p>
</div>
<div class="section" id="remix">
<h2>日本語Remixイメージをダウンロード</h2>
<p><a class="reference external" href="https://www.ubuntulinux.jp/download">Ubuntuの入手 | Ubuntu Japanese Team</a> からダウンロードしました。</p>
<p>実は最初は <a class="reference external" href="https://www.ubuntu.com/download/desktop">Download Ubuntu Desktop | Download | Ubuntu</a> のイメージを使ってインストールしてみたのですが、日本語入力の設定がよくわからなかったので、日本語Remixイメージで再インストールしました。最初から良い感じに設定されていて快適でした。ありがとうございます！</p>
</div>
<div class="section" id="etcherubuntuusb">
<h2>EtcherでUbuntuインストール用のUSBメモリ作成</h2>
<p><a class="reference external" href="https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-macos#3">Create a bootable USB stick on macOS | Ubuntu tutorials</a> で紹介されていた <a class="reference external" href="https://etcher.io/">Etcher</a> を初めて使ってみました。</p>
<p>USBメモリを1つだけ挿しておくと書き込み先は自動選択されるので、ダウンロードしたISOイメージファイルを選んで書き込み開始のボタンを押すだけで良くて非常に簡単でした。macOS、 Windows とLinuxのGUI環境でISOイメージをUSBメモリに書くときは Etcher おすすめです！</p>
</div>
<div class="section" id="macosubuntu">
<h2>macOS側でUbuntuインストール用の領域確保</h2>
<p><a class="reference external" href="https://www.karelie.net/move-from-osx-to-ubuntu/">ひょんなことからMacにUbuntuをインストールすることになった。後悔はしていない。 | カレリエ</a> と <a class="reference external" href="https://www.lifewire.com/dual-boot-linux-and-mac-os-4125733">How to Install and Dual Boot Linux and Mac OS</a> を参考に、macOS のディスクユーティリティでUbuntu用にパーティションを作成しました。</p>
<p>この時点では最終的なUbuntu用のパーティション構成を作るわけではなくて、macOSのパーティションサイズを小さくしてUbuntuをインストールする領域を確保するために1つパーティションを作る感じです。</p>
<p>で、後ほどUbuntuのインストーラでそのパーティションを一旦削除して、最終的なUbuntu用のパーティション構成を作りました。</p>
<p>High Sierraのディスクユーティリティは初めて使ったのですが、ボリュームとパーティションというのがあってどう違うのかと思ったのですが <a class="reference external" href="https://www.lifewire.com/volume-vs-partition-2260237">Is a Container, Volume, or Partition all the Same?</a> にわかりやすい記事がありました。</p>
<p>私のMacBook ProのSSDは512GB (約500GiB)だったので250GiBずつにわけることにしました。多少時間はかかりますが、macOSが起動したパーティションをその場で縮小できるのはすごいなと思いました。</p>
</div>
<div class="section" id="refind">
<h2>ブートマネージャ rEFInd は不要</h2>
<p>昔 OSX, Windows, Linux というトリプルブート環境を作ったときは <a class="reference external" href="http://www.rodsbooks.com/refind/">The rEFInd Boot Manager</a> を使ったのですが、 <a class="reference external" href="https://www.cberner.com/2017/12/03/installing-ubuntu-17-10-macbook-pro-retina-mid-2012/">Installing Ubuntu 17.10 on Macbook Pro Retina mid-2012</a> にUbuntu 17.10では16.10からの改善点の1つとしてrEFIndが不要になったと書いてあったので、今回は使いませんでした。</p>
</div>
<div class="section" id="lan">
<h2>インストール時は有線LANを使用</h2>
<p>Ubuntuのインストーラには MacBook Pro 2012 の無線LANのデバイスドライバが含まれておらず、インストーラ実行時にWifiが使えません。</p>
<p><a class="reference external" href="https://www.cberner.com/2017/12/03/installing-ubuntu-17-10-macbook-pro-retina-mid-2012/">Installing Ubuntu 17.10 on Macbook Pro Retina mid-2012</a> にはインストーラ時にはパッケージアップデートをしないようにしておいて、予めmacOSでWifiドライバと依存ライブラリをダウンロードしUSBメモリにコピーしておいてあとでUbuntuで起動したときにそこからインストールする手順が紹介されていました。</p>
<p>私は <a class="reference external" href="https://www.apple.com/jp/shop/product/MD463ZM/A/apple-thunderbolt%E3%82%AE%E3%82%AC%E3%83%93%E3%83%83%E3%83%88ethernet%E3%82%A2%E3%83%80%E3%83%97%E3%82%BF">Apple Thunderbolt - ギガビットEthernetアダプタ - Apple（日本）</a> を持っているので、インストール時は有線LANを使うことにしました。</p>
<p>インストール後SSDからUbuntuを起動した後で以下のコマンドでWifiドライバをインストールしました。</p>
<div class="highlight"><pre><span></span><span class="go">sudo apt update</span>
<span class="go">sudo apt install -y bcmwl-kernel-source</span>
</pre></div>
<p>このコマンド実行後はWifiが使えるようになりました。</p>
</div>
<div class="section" id="nvidia">
<h2>NVIDIAのプロプリエタリドライバは非使用</h2>
<p><a class="reference external" href="https://support.apple.com/kb/SP694?locale=ja_JP&amp;viewlocale=ja_JP">MacBook Pro (15-inch, Mid 2012) - 技術仕様</a> の「グラフィックスおよびビデオ」に以下のようにありますが、このMacBook ProにはNVIDIA GeForce GT 650Mが載っています。</p>
<ul class="simple">
<li>Intel HD Graphics 4000</li>
<li>NVIDIA GeForce GT 650M、512MB GDDR5メモリ（15インチ2.3GHzモデル）またはNVIDIA GeForce GT 650M、1GB GDDR5メモリ（15インチ2.6GHzモデル）、グラフィックス自動切替機能</li>
<li>デュアルディスプレイおよびビデオミラーリング：本体ディスプレイで標準解像度、外部ディスプレイで最大2,560 x 1,600ピクセル表示を同時サポート（数百万色以上対応）</li>
</ul>
<p>標準の nouveau driver で特に問題なさそうでしたので、 NVIDIAのプロプリエタリドライバは使わないことにしました。</p>
</div>
<div class="section" id="ubuntu">
<h2>Ubuntuのパーティション構成</h2>
<p>メモリが十分あればスワップパーティションは無しでも良いかと一時期思っていたのですが
<a class="reference external" href="https://chrisdown.name/2018/01/02/in-defence-of-swap.html">In defence of swap: common misconceptions</a>
という記事によるとあったほうが良いらしいので作っておくことにしました。</p>
<p>パーティション構成は <a class="reference external" href="https://help.ubuntu.com/community/DiskSpace">DiskSpace - Community Help Wiki</a> を参考にして以下のようにしました。</p>
<ul class="simple">
<li>/boot : ext4 1GB</li>
<li>swap : (物理RAMと同じ)16GB</li>
<li>/ : ext4 残り</li>
</ul>
<p>後から見つけた <a class="reference external" href="https://help.ubuntu.com/community/SwapFaq">SwapFaq - Community Help Wiki</a> によるとハイバネーションを使うなら最低で物理RAMと同じサイズが必要で、使わないなら <code>round(sqrt(RAM))</code> から物理RAMの2倍の間で選ぶ感じらしいです。</p>
<p>ブートローダのインストール先デバイスは <code>/dev/sda</code> にしました。
<a class="reference external" href="https://help.ubuntu.com/community/Grub2/Installing">Grub2/Installing - Community Help Wiki</a></p>
</div>
<div class="section" id="id2">
<h2>デュアルブートの起動切り替え</h2>
<ul class="simple">
<li>特に何もしないで起動するとUbuntuが起動します。</li>
<li>macOSを起動したいときは option (alt) キーを押しながら起動してmacOSを選択して起動します。</li>
</ul>
</div>
<div class="section" id="fn">
<h2>ファンクションキーのfnをデフォルトと逆に</h2>
<p>デフォルトではfnなしでF1〜F12を押すと画面の明るさやボリューム調整になり、
fnキーを押しながらF1などを押すとファンクションキーになります。</p>
<p>私はmacOSでも逆のほうが好きでそのように設定していたのでUbuntuでもそうすることにしました。</p>
<p>これも <a class="reference external" href="https://www.cberner.com/2017/12/03/installing-ubuntu-17-10-macbook-pro-retina-mid-2012/">Installing Ubuntu 17.10 on Macbook Pro Retina mid-2012</a> の記事に沿って設定しました。元ネタは <a class="reference external" href="https://help.ubuntu.com/community/AppleKeyboard">AppleKeyboard - Community Help Wiki</a> だそうです。</p>
<div class="highlight"><pre><span></span><span class="go">echo options hid_apple fnmode=2 | sudo tee -a /etc/modprobe.d/hid_apple.conf</span>
<span class="go">sudo update-initramfs -u -k all</span>
<span class="go">sudo reboot</span>
</pre></div>
</div>
<div class="section" id="id3">
<h2>解像度の変更</h2>
<p><a class="reference external" href="https://help.gnome.org/users/gnome-help/stable/look-resolution.html.en">Change the resolution or rotation of the screen</a> に手順が書いてあります。</p>
<p>画面左上の「アクティビティ」を押して Displays と入力していきます。インクリメンタルサーチで下にマッチしたものが出ますので、「設定」の「ディスプレイ」を選びます。</p>
<p>デフォルトでは解像度が「2800x1800(16:10)」でサイズ調整が「200%」になっていました。
解像度を「1920x1280(16:10)」、サイズ調整を「100%」にすると私がmacOSで使っていたときと
同じになりました。</p>
<p>元の設定のほうが文字はくっきりして綺麗ですが、画面が広いほうが良いのでこれで使っています。</p>
</div>
<div class="section" id="id4">
<h2>未調査の課題</h2>
<p>シャットダウンとリブートが妙に遅いときがあります。体感で2分ぐらいかかってるような。すぐ再起動するときもあるので謎です。</p>
</div>
<div class="section" id="id5">
<h2>おわりに</h2>
<p>macOSやWindowsに慣れていた私ですが違和感なく使えて非常に快適です。
Linuxデスクトップや日本語環境を作ってきてきた人たちに感謝しつつ、今後使っていこうと思います。</p>
</div>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>