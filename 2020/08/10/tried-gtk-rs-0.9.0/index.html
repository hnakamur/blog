<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.84.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>gtk-rs 0.9.0を試した &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53263855-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53263855-1');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2021. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>gtk-rs 0.9.0を試した</h1>
  <time datetime=2020-08-10T14:45:42&#43;0900 class="post-date">2020-08-10</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#windows-10">Windows 10</a>
      <ul>
        <li><a href="#msys2-のインストール">MSYS2 のインストール</a></li>
        <li><a href="#windows-terminal-に-msys2-の端末を開く設定追加">Windows Terminal に MSYS2 の端末を開く設定追加</a></li>
        <li><a href="#gtk-for-windows-のセットアップ">GTK for Windows のセットアップ</a></li>
        <li><a href="#c-言語での-gtk-のサンプルを動かしてみる">C 言語での GTK のサンプルを動かしてみる</a></li>
        <li><a href="#rust-での-gtk-のサンプルを動かしてみる">Rust での GTK のサンプルを動かしてみる</a></li>
      </ul>
    </li>
    <li><a href="#ubuntu-2004-lts">Ubuntu 20.04 LTS</a></li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p><a href="https://github.com/gtk-rs/gtk">gtk-rs/gtk: GTK+ 3.x bindings and wrappers for Rust</a> 0.9.0 を試したメモです。</p>
<p><a href="https://rustup.rs/">rustup.rs - The Rust toolchain installer</a>
はインストールしてセットアップ済みとします。</p>
<h2 id="windows-10">Windows 10</h2>
<p><a href="https://github.com/gtk-rs/gtk#building">Building</a> から
<a href="http://gtk-rs.org/docs/requirements.html">Requirements</a> を開いて
Windows のセクションを参考に MSYS2 と GTK をインストールしました。</p>
<h3 id="msys2-のインストール">MSYS2 のインストール</h3>
<p><a href="https://www.msys2.org/">MSYS2</a> からインストーラー <code>msys2-x86_64-20200720.exe</code> をダウンロードして実行。
インストール先はデフォルトの <code>C:\msys64</code> です（上記のページの画面イメージでは <code>C:\msys32</code> となっていますが）。</p>
<p>セットアップ後 MSYS2 の端末を起動して以下のコマンドでパッケージデータベースとコアシステムをアップデートします。</p>
<pre><code>pacman -Syu
</code></pre><p>その後 MSYS2 の端末を開きなおして以下のコマンドで残りのパッケージをアップデートします。</p>
<pre><code>pacman -Su
</code></pre><p>(横道) pacman コマンドについては <a href="https://wiki.archlinux.jp/index.php/Pacman">pacman - ArchWiki</a> が詳しいです。</p>
<p>ローカルにインストール済みのパッケージ名をキーワード検索するときは</p>
<pre><code>pacman -Qs キーワード
</code></pre><p>です。</p>
<h3 id="windows-terminal-に-msys2-の端末を開く設定追加">Windows Terminal に MSYS2 の端末を開く設定追加</h3>
<p><a href="https://qiita.com/yumetodo/items/4aa03d1eb3d887bca1a8">Windows Terminalでもmsys2を使おう - Qiita</a> を参考に追加しました。</p>
<p>PowerShell で以下のコマンドを実行して GUID を生成します。</p>
<pre><code>[guid]::NewGuid()
</code></pre><p>Windows Terminal の設定メニューで表示された設定の <code>&quot;profiles&quot;</code> の <code>&quot;list&quot;</code> に以下のような設定を追加しました
（私はフォントは <code>&quot;profiles&quot;</code> の <code>&quot;defaults&quot;</code> のほうに共通で設定しています）。</p>
<pre><code>{
// …(略)…
    &quot;profiles&quot;:
    {
        &quot;defaults&quot;:
        {
            // Put settings here that you want to apply to all profiles.
            &quot;fontFace&quot;: &quot;Cica&quot;,
            &quot;fontSize&quot;: 16,
            &quot;cursorColor&quot;: &quot;#FFFFFF&quot;,
            &quot;cursorShape&quot;: &quot;filledBox&quot;,
            &quot;colorScheme&quot;: &quot;Tango Dark&quot;
        },
        &quot;list&quot;:
        [
// …(略)…
            {
                &quot;guid&quot; : &quot;{8573f40a-ca5e-4739-b9a6-fb318315836d}&quot;,
                &quot;closeOnExit&quot; : true,
                &quot;commandline&quot; : &quot;cmd.exe /c \&quot;set MSYSTEM=MINGW64&amp;&amp; set MSYS=winsymlinks:nativestrict&amp;&amp; C:/msys64/usr/bin/bash.exe --login\&quot;&quot;,
                &quot;historySize&quot; : 9001,
                &quot;icon&quot;: &quot;C:/msys64/msys2.ico&quot;,
                &quot;name&quot; : &quot;MSYS2&quot;,
                &quot;startingDirectory&quot; : &quot;C:/msys64/home/hnakamur&quot;
            }
// …(略)…
</code></pre><p>startingDirectory はユーザー名に合わせて調整します。</p>
<h3 id="gtk-for-windows-のセットアップ">GTK for Windows のセットアップ</h3>
<p><a href="https://www.gtk.org/docs/installations/windows/#using-gtk-from-msys2-packages">The GTK Project - A free and open-source cross-platform widget toolkit</a> によると MSYS2 と gvsbuild の 2 種類のインストール方法があります。</p>
<p>今回は MSYS2 のほうを試しています。
MSYS2 は上記でインストールしたので
<a href="https://www.gtk.org/docs/installations/windows/#using-gtk-from-msys2-packages">Using GTK from MSYS2 packages</a>
の手順で GTK をインストールします。</p>
<p>MSYS2 の端末で以下のコマンドを実行して GTK3 と依存パッケージをインストールします。</p>
<pre><code>pacman -S mingw-w64-x86_64-gtk3
</code></pre><p>Glade もインストールしました。</p>
<pre><code>pacman -S mingw-w64-x86_64-glade
</code></pre><p><a href="https://www.gtk.org/docs/installations/windows/#using-gtk-from-msys2-packages">Building and distributing your application</a> は読みましたが、とりあえずスキップしました。</p>
<p>また、 GTK を自作アプリケーションに同梱して配布する場合は <a href="https://www.gtk.org/docs/installations/windows/#using-gtk-from-msys2-packages">Legal notes on distributing GTK with your application</a> をよく読む必要があります。これもとりあえずスキップ。</p>
<h3 id="c-言語での-gtk-のサンプルを動かしてみる">C 言語での GTK のサンプルを動かしてみる</h3>
<p><a href="https://www.gtk.org/docs/getting-started/hello-world/">Getting Started</a> を参考にして試しました。</p>
<p>このページに書かれている内容で <code>hello-world-gtk.c</code> というファイルを作成し、以下のコマンドでビルドしました。</p>
<pre><code class="language-console" data-lang="console">gcc `pkg-config --cflags gtk+-3.0` -o hello-world-gtk hello-world-gtk.c `pkg-config --libs gtk+-3.0`
</code></pre><p>しかし pkg-config で glib-2.0 が見つからないという趣旨のエラーが出ました。</p>
<p><a href="https://github.com/mitaa">pkg-config fails to find cairo.pc and glib-2.0.pc on MSYS2 Win64 · Issue #23 · rust-lang/pkg-config-rs</a> の <a href="https://github.com/rust-lang/pkg-config-rs/issues/23#issuecomment-239558109">コメント</a> を見て以下のコマンドを実行すると解消しました。</p>
<pre><code>pacman -S mingw-w64-x86_64-pkg-config
</code></pre><p>今気づきましたが <a href="http://gtk-rs.org/docs/requirements.html">Requirements</a>
の &ldquo;Using the MSYS2 MinGW shell&rdquo; の項に以下のコマンドで pkg-config のセットアップができる旨書いてありました。</p>
<pre><code>pacman -S mingw-w64-x86_64-toolchain
</code></pre><p>あと、状況を忘れてしまいましたが
<a href="https://stackoverflow.com/questions/47379214/step-by-step-instruction-to-install-rust-and-cargo-for-mingw-with-msys2/47380501#47380501">windows - Step by step instruction to install Rust and Cargo for mingw with Msys2? - Stack Overflow</a>
も参考にして以下の設定を行いました。</p>
<p>MSYS2 の端末で <code>~/.bashrc</code> に以下の行を追加。</p>
<pre><code>export PATH=/c/Users/hnakamur/.cargo/bin:$PATH
</code></pre><p><code>C:\Users\hnakamur\.cargo\config</code> (ユーザー名は適宜変更) を以下の内容で作成。</p>
<pre><code>[target.x86_64-pc-windows-gnu]
linker = &quot;C:\\msys64\\usr\\bin\\gcc.exe&quot;
ar = &quot;C:\\msys64\\usr\\bin\\ar.exe&quot;
</code></pre><h3 id="rust-での-gtk-のサンプルを動かしてみる">Rust での GTK のサンプルを動かしてみる</h3>
<p>上記の続きで以下のように rustup のツールチェインをインストールして、デフォルトにしまいｓた。</p>
<pre><code>rustup toolchain install stable-x86_64-pc-windows-gnu
rustup default stable-x86_64-pc-windows-gnu
</code></pre><p>その後 <a href="https://gtk-rs.org/#using">Gtk-rs</a> のサンプルを動かしてみました。</p>
<p>さらに Box と TextView も追加してみましたが、 IME で日本語入力・編集も問題なく行えました。</p>
<p>結果は <a href="https://github.com/hnakamur/gtk-rs-example">hnakamur/gtk-rs-example</a> に置きました。</p>
<h2 id="ubuntu-2004-lts">Ubuntu 20.04 LTS</h2>
<p><a href="http://gtk-rs.org/docs/requirements.html">Requirements</a>
に沿って必要なパッケージをインストール。</p>
<pre><code class="language-console" data-lang="console">sudo apt install libgtk-3-dev
</code></pre><p>あとは
<a href="https://github.com/hnakamur/gtk-rs-example">hnakamur/gtk-rs-example</a>
を <code>git clone</code> してきて <code>cargo run</code> で試しました。</p>
<p>こちらも日本語入力も大丈夫でした。</p>

</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-53263855-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
