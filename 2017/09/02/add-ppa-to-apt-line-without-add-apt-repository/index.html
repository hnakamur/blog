<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.87.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>add-apt-repositoryを使わずにPPAをapt-lineに追加する方法 &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-53263855-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53263855-1');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2021. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>add-apt-repositoryを使わずにPPAをapt-lineに追加する方法</h1>
  <time datetime=2017-09-02T11:47:00&#43;0900 class="post-date">2017-09-02</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#add-apt-repositoryを使わないppaの追加手順">add-apt-repositoryを使わないPPAの追加手順</a>
      <ul>
        <li><a href="#ppaの公開鍵の追加">PPAの公開鍵の追加</a></li>
        <li><a href="#apt-lineの追加">apt-lineの追加</a></li>
      </ul>
    </li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p>PPAのページにはPPAを追加するには <code>add-apt-respository</code> コマンドを使うように書かれています。</p>
<p>例えば gcc-7 などを配布しているPPA
<a href="https://launchpad.net/~ubuntu-toolchain-r/+archive/ubuntu/test">Toolchain test builds : “PPA for Ubuntu Toolchain Uploads (restricted)” team</a>
の Adding this PPA to your system には以下のように書かれています。</p>
<pre><code class="language-console" data-lang="console">sudo add-apt-repository ppa:ubuntu-toolchain-r/test
sudo apt-get update
</code></pre><p>ですが、LXDのコンテナの Ubuntu Xenial のイメージなどでは add-apt-repository が入っていないので、 <code>apt install software-properties-common</code> でインストールする必要があります。</p>
<p>わざわざこれだけのために入れるのも面倒ですし、ディスクも消費するので、 add-apt-repository を使わない方法を調べました。</p>
<h2 id="add-apt-repositoryを使わないppaの追加手順">add-apt-repositoryを使わないPPAの追加手順</h2>
<p>以下の2ステップで追加します。</p>
<ol>
<li>PPAの公開鍵の追加</li>
<li>apt-lineの追加</li>
</ol>
<h3 id="ppaの公開鍵の追加">PPAの公開鍵の追加</h3>
<p>公開鍵のIDを調べて、以下のコマンドでPPAの公開鍵を追加します。以下は公開鍵のIDが BA9EF27F の場合です。</p>
<pre><code class="language-console" data-lang="console">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv BA9EF27F
</code></pre><p><code>man apt-key</code> で確認したところ <code>adv</code> サブコマンドは引数を <code>gpg</code> に渡すようになっています。</p>
<p>この方法は <a href="https://superuser.com/questions/620765/sudo-apt-key-adv-keyserver-keyserver-ubuntu-com-recv-7f0ceb10-command-return/621258#621258">linux - sudo apt-key adv &ndash;keyserver keyserver.ubuntu.com &ndash;recv 7F0CEB10 command returns error - Super User</a> で見つけました。コメントでポート80を明示的に指定する必要があるとありましたが試してみると不要でした。</p>
<p>公開鍵のIDは以下の手順で調べられます。</p>
<ol>
<li>PPA のページの &ldquo;Adding this PPA to your system&rdquo; セクションにある &ldquo;Technical details about this PPA&rdquo; というリンクをクリック</li>
<li>展開されて表示された &ldquo;Signing Key:&rdquo; の下のリンクをクリック</li>
<li>&ldquo;Search results for &hellip;&rdquo; のページで検索結果の keyID の部分をコピー</li>
</ol>
<p>上記の例のPPAだと以下のように表示されて、 keyID は BA9EF27F となります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Search results for &#39;0x60c317803a41ba51845e371a1e9377a2ba9ef27f&#39;

Type bits/keyID     Date       User ID
pub  1024R/BA9EF27F 2009-10-22 Launchpad Toolchain builds
         Fingerprint=60C3 1780 3A41 BA51 845E  371A 1E93 77A2 BA9E F27F 
</code></pre></div><p>正しく追加できたかは <code>sudo apt-key list</code> で確認できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">root@addrepomanual:~# apt-key list
/etc/apt/trusted.gpg
--------------------
pub   1024D/437D05B5 2004-09-12
uid                  Ubuntu Archive Automatic Signing Key &lt;ftpmaster@ubuntu.com&gt;
sub   2048g/79164387 2004-09-12

pub   4096R/C0B21F32 2012-05-11
uid                  Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;

pub   4096R/EFE21092 2012-05-11
uid                  Ubuntu CD Image Automatic Signing Key (2012) &lt;cdimage@ubuntu.com&gt;

pub   1024D/FBB75451 2004-12-30
uid                  Ubuntu CD Image Automatic Signing Key &lt;cdimage@ubuntu.com&gt;

pub   1024R/BA9EF27F 2009-10-22
uid                  Launchpad Toolchain builds
</code></pre></div><p>BA9EF27F の鍵が追加されていることがわかります。</p>
<p>ちなみに別環境で <code>add-apt-repository ppa:ubuntu-toolchain-r/test</code> でPPAを追加した場合は <code>apt-key list</code> の結果は以下のようになりました。
PPA用に <code>/etc/apt/trusted.gpg.d/ubuntu-toolchain-r_ubuntu_test.gpg</code> という別のファイルが作られてそちらに鍵がインポートされています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">root@addrepo:~# sudo apt-key list
/etc/apt/trusted.gpg
--------------------
pub   1024D/437D05B5 2004-09-12
uid                  Ubuntu Archive Automatic Signing Key &lt;ftpmaster@ubuntu.com&gt;
sub   2048g/79164387 2004-09-12

pub   4096R/C0B21F32 2012-05-11
uid                  Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;

pub   4096R/EFE21092 2012-05-11
uid                  Ubuntu CD Image Automatic Signing Key (2012) &lt;cdimage@ubuntu.com&gt;

pub   1024D/FBB75451 2004-12-30
uid                  Ubuntu CD Image Automatic Signing Key &lt;cdimage@ubuntu.com&gt;

/etc/apt/trusted.gpg.d/ubuntu-toolchain-r_ubuntu_test.gpg
---------------------------------------------------------
pub   1024R/BA9EF27F 2009-10-22
uid                  Launchpad Toolchain builds
</code></pre></div><p>手動で同じ構成にするのは以下のようにすれば出来ます。</p>
<pre><code class="language-console" data-lang="console">gpg --no-default-keyring --keyring /etc/apt/trusted.gpg.d/ubuntu-toolchain-r_ubuntu_test.gpg --fingerprint
curl -sS 'http://keyserver.ubuntu.com:11371/pks/lookup?op=get&amp;search=0x1E9377A2BA9EF27F' \
        | apt-key --keyring /etc/apt/trusted.gpg.d/ubuntu-toolchain-r_ubuntu_test.gpg add -
</code></pre><p>gpg でデフォルトと別のkeyringファイルを作る方法は
<a href="https://superuser.com/questions/399938/how-to-create-additional-gpg-keyring/991139#991139">gnupg - How to create additional gpg keyring - Super User</a> で見つけました。</p>
<p>curl に指定しているURLは以下の手順で調べられます。</p>
<ol>
<li>PPA のページの &ldquo;Adding this PPA to your system&rdquo; セクションにある &ldquo;Technical details about this PPA&rdquo; というリンクをクリック</li>
<li>展開されて表示された &ldquo;Signing Key:&rdquo; の下のリンクをクリック</li>
<li>&ldquo;Search results for &hellip;&rdquo; のページで検索結果の keyID のリンクのURLをコピー</li>
</ol>
<p>このリンク先のページは公開鍵を含むHTMLになっていますが、 <code>apt-key add</code> サブコマンドは公開鍵の前後は無視して処理してくれました。</p>
<p>ただし、この手順にはcurlが必要で、LXDのxenialイメージには含まれていないので <code>apt install curl</code> でインストールが必要です。なので手軽に実行するには冒頭の手順のほうが良いです。</p>
<p>ちなみに gpg で keyring を作っておいて
<code>sudo apt-key adv --keyserver keyserver.ubuntu.com --keyring /etc/apt/trusted.gpg.d/ubuntu-toolchain-r_ubuntu_test.gpg --recv BA9EF27F</code> というのも試してみたのですが、 /etc/apt/trusted.gpg のほうにインポートされてしまいました。</p>
<h3 id="apt-lineの追加">apt-lineの追加</h3>
<p>これは <code>/etc/apt/sources.list</code> に追記するか <code>/etc/apt/sources.list.d/</code> に <code>.list</code> という拡張子を持つファイルを作ればOKです。後者のほうが管理しやすいと思います。</p>
<p>例えば ubuntu-toolchain-r/test の場合は以下のようにします。</p>
<pre><code class="language-console" data-lang="console">echo 'deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu xenial main' \
         | sudo tee /etc/apt/sources.list.d/ubuntu-toolchain-r-ubuntu-test-xenial.list
</code></pre><p>追加する内容は、 PPA のページの &ldquo;Adding this PPA to your system&rdquo; セクションにある &ldquo;Technical details about this PPA&rdquo; を展開し、 &ldquo;Display sources.list entries for:&rdquo; の右のドロップダウンリストでお使いのディストリビューションを選べば表示されます。</p>
<p>今回の例だと以下の内容です。</p>
<pre><code class="language-console" data-lang="console">deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu xenial main 
deb-src http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu xenial main 
</code></pre><p>deb-src の行は <code>apt source パッケージ名</code> でdebのソースパッケージをダウンロードするときに必要ですが、それ以外では不要なので上記では省略しています。</p>
<p>あとは <code>apt update</code> すれば <code>apt install パッケージ名</code> で必要なパッケージをインストール可能になります。</p>

</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-53263855-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
