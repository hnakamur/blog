<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.108.0">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>EdgeRouter Lite (ERLite-3)のファームウェアアップデート &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMMXGG2Z56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMMXGG2Z56');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2022. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>EdgeRouter Lite (ERLite-3)のファームウェアアップデート</h1>
  <time datetime=2017-05-03T07:30:00&#43;0900 class="post-date">2017-05-03</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#工場出荷状態の設定">工場出荷状態の設定</a></li>
    <li><a href="#lanケーブルで接続">LANケーブルで接続</a></li>
    <li><a href="#web-uiもしくはsshでcliに接続">Web UIもしくはsshでCLIに接続</a></li>
    <li><a href="#web-uiからのファームウェアのアップデートは失敗">Web UIからのファームウェアのアップデートは失敗</a></li>
    <li><a href="#cliからのファームウェアのアップデートは成功">CLIからのファームウェアのアップデートは成功</a></li>
    <li><a href="#ファームウェアのアップデート情報">ファームウェアのアップデート情報</a></li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p><a href="https://misc.mat2uken.net/blog/2015/11/09/edgerouter_lite3.html">17,000円で買えるVyOSっぽいOSが動くルーター EdgeRouter Lite(ERLite-3)を使ってみる — どこか遠くでのんびり怠惰に暮らしたい</a>
を読んで EdgeRouter Lite (ERLite-3)を買いました。</p>
<p>ということで初期設定内容をメモしておきます。今回はファームウェアのアップデートです。</p>
<p>ありがたいことに
<a href="http://edge-os.net/wiki/view/%E6%8E%A5%E7%B6%9A">接続 - EdgeOS 日本語Wiki [非公式]</a>
に非常によくまとまっていました。</p>
<h2 id="工場出荷状態の設定">工場出荷状態の設定</h2>
<ul>
<li>EdgeRouterのIPアドレスは <code>192.168.1.1</code></li>
<li>DHCPサーバはオフ</li>
<li>SSHサーバはオン</li>
<li>管理者ユーザのIDとパスワードはともに <code>ubnt</code></li>
</ul>
<h2 id="lanケーブルで接続">LANケーブルで接続</h2>
<p>Windows10が動いているThinkPadにLANケーブルを接続してEdgeRouterのeth0につないで設定しました。
別途WiFiで無線LANにもつないでいます。</p>
<ul>
<li>コントロールパネル &gt; ネットワークとインターネット &gt; ネットワークで「イーサネット」を選択してポップアップメニューの「プロパティ」を選択します。</li>
<li>「イーサネットのプロパティ」ダイアログが開いたら「ネットワーク」タブの「この接続は次の項目を使用します」のリストで「インターネットプロトコルバージョン 4 (TCP/IPv4)」を選んで「プロパティ」ボタンを押します。</li>
<li>「インターネットプロトコルバージョン 4 (TCP/IPv4)のプロパティ」ダイアログで以下のように設定します。
<ul>
<li>「次のIPアドレスを使う」ラジオボタンを選択。</li>
<li>「IPアドレス」に <code>192.168.1.2</code> と入力。</li>
<li>「サブネットマスク」に <code>255.255.255.0</code> と入力。</li>
<li>「デフォルトゲートウェイ」に <code>192.168.1.1</code> と入力。</li>
<li>「次のDNSサーバのアドレスを使う」ラジオボタンを選択。</li>
<li>「優先DNSサーバ」と「代替DNSサーバ」のアドレスは空のままにする。</li>
</ul>
</li>
</ul>
<h2 id="web-uiもしくはsshでcliに接続">Web UIもしくはsshでCLIに接続</h2>
<p>Web UIの場合はブラウザで <code>https://192.168.1.1</code> を開き、証明書のエラーを無視して進みます。
ブラウザウィンドウ内にログインダイアログが出たら、上記の管理者IDとパスワードを入力します。</p>
<p>右上の「CLI」ボタンを押すと、ブラウザウィンドウ内にCLIのウィンドウが開き、ログインプロンプトが表示されるので、再度上記の管理者IDとパスワードを入力します。</p>
<p>sshでCLIに接続するときは普通にsshコマンドでつなげばOKです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ssh ubnt@192.168.1.1
</span></span><span class="line"><span class="cl"><span class="go">Welcome to EdgeOS
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">By logging in, accessing, or using the Ubiquiti product, you
</span></span></span><span class="line"><span class="cl"><span class="go">acknowledge that you have read and understood the Ubiquiti
</span></span></span><span class="line"><span class="cl"><span class="go">License Agreement (available in the Web UI at, by default,
</span></span></span><span class="line"><span class="cl"><span class="go">http://192.168.1.1) and agree to be bound by its terms.
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">ubnt@192.168.1.1&#39;s password:
</span></span></span><span class="line"><span class="cl"><span class="go">Linux ubnt 2.6.32.13-UBNT #1 SMP Tue Jun 4 14:54:28 PDT 2013 mips64
</span></span></span><span class="line"><span class="cl"><span class="go">Welcome to EdgeOS
</span></span></span><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ ls
</span></span></span><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ pwd
</span></span></span><span class="line"><span class="cl"><span class="go">/home/ubnt
</span></span></span><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ logout
</span></span></span><span class="line"><span class="cl"><span class="go">Connection to 192.168.1.1 closed.
</span></span></span></code></pre></div><h2 id="web-uiからのファームウェアのアップデートは失敗">Web UIからのファームウェアのアップデートは失敗</h2>
<p><a href="https://help.ubnt.com/hc/en-us/articles/205146110-EdgeRouter-Upgrading-EdgeOS-firmware">EdgeRouter - Upgrading EdgeOS firmware – Ubiquiti Networks Support and Help Center</a>
にファームウェアのアップデート手順が書いてあります。
最初はVideo Tutorial (Web GUI)の動画の手順に従ってアップデートしようとしましたが、うまくいきませんでした。試した手順を記録しておきます。</p>
<p>まず、現在のバージョンを確認しておきます。Web GUIの表示は Edge Router Lite v1.2.0 でした。</p>
<p>CLIでも <code>show version</code> コマンドを実行し確認しておきました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ show version
</span></span></span><span class="line"><span class="cl"><span class="go">Version:      v1.2.0
</span></span></span><span class="line"><span class="cl"><span class="go">Build ID:     4574253
</span></span></span><span class="line"><span class="cl"><span class="go">Build on:     06/26/13 12:48
</span></span></span><span class="line"><span class="cl"><span class="go">Copyright:    2012-2013 Ubiquiti Networks, Inc.
</span></span></span><span class="line"><span class="cl"><span class="go">HW model:     EdgeRouter Lite 3-Port
</span></span></span><span class="line"><span class="cl"><span class="go">HW S/N:       F09FC2104B28
</span></span></span><span class="line"><span class="cl"><span class="go">Uptime:       10:34:58 up 35 min,  2 users,  load average: 0.00, 0.00, 0.00
</span></span></span></code></pre></div><p>Web UIの左下のSystemボタンを押すと、設定画面のポップアップが開きます。
&ldquo;Upgrade System Image&rdquo; のグループボックス内の &ldquo;To check for updates go to:&rdquo; の後のリンクをクリックすると別タブでファームウェアやマニュアルをダウンロードできるページが開きます。
この後は上記の動画とはUIが変わっていました。
左のツリーで EdgeMax &gt; EdgeRouter Lite &gt; ERLite-3 を選んで、右のリストでFIRMWAREの一覧に表示されているファームウェアの行をクリックしてファームウェアをダウンロードします。</p>
<p>2017/04/28に登録された <code>ER-e100.v1.9.1.1.4977347.tar</code> をダウンロードしました。</p>
<p>あとはWeb UIのSystemのポップアップ内の &ldquo;Upgrade System Image&rdquo; のグループボックス内の&quot;Upload a file&quot; ボタンを押して、先ほどダウンロードしたファイルを選択してアップロードします。</p>
<p>が、やってみると Upload failed と表示されて失敗してしまいました。</p>
<p>バージョンが飛びすぎなのかと思い、 &ldquo;SEE PAST FIRMWARE&rdquo; ボタンを押して過去のファームウェアを表示し、適当に間をとって v1.7.0 をダウンロードして再度試してみました。
しかしやはり失敗でした。</p>
<p>これは1つずつ順番に上げる必要があるのかと思い、v1.2.0の次のv1.3.0でも試してみましたがやはりエラーでした。</p>
<h2 id="cliからのファームウェアのアップデートは成功">CLIからのファームウェアのアップデートは成功</h2>
<p>しかたがないのでCLIからアップデートすることにしました。</p>
<p>上記のページの Instructions for Upgrading Via CLI の項ではファームウェアのURLを指定していますが、私はまだルータからインターネットにアクセスできるようにしていないので、上でダウンロードしたファイルを scp でコピーし、CLIからファイル名を指定してアップデートしました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> scp ER-e100.v1.9.1.1.4977347.tar ubnt@192.168.1.1:
</span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="gp">$</span> ssh ubnt@192.168.1.1
</span></span><span class="line"><span class="cl"><span class="go">...
</span></span></span><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ add system image ER-e100.v1.9.1.1.4977347.tar
</span></span></span><span class="line"><span class="cl"><span class="go">Checking upgrade image... Done
</span></span></span><span class="line"><span class="cl"><span class="go">Preparing to upgrade... Done
</span></span></span><span class="line"><span class="cl"><span class="go">Copying upgrade image... Done
</span></span></span><span class="line"><span class="cl"><span class="go">Removing old image... Done
</span></span></span><span class="line"><span class="cl"><span class="go">Checking upgrade image... Done
</span></span></span><span class="line"><span class="cl"><span class="go">Finishing upgrade... Done
</span></span></span><span class="line"><span class="cl"><span class="go">Upgrade completed
</span></span></span></code></pre></div><p>scpでコピーしたファイルはもう不要なので消しておきます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ rm ER-e100.v1.9.1.1.4977347.tar
</span></span></span></code></pre></div><p>今度は成功しました。現在の状態を確認します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ show system image
</span></span></span><span class="line"><span class="cl"><span class="go">The system currently has the following image(s) installed:
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">v1.9.1.1.4977347.170426.0359   (default boot)
</span></span></span><span class="line"><span class="cl"><span class="go">v1.2.0.4574253.130626.1248     (running image)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">A reboot is needed to boot default image
</span></span></span></code></pre></div><p>.. code-block:: console</p>
<pre><code>ubnt@ubnt:~$ show system image storage
Image name                        Read-Only   Read-Write        Total
------------------------------ ------------ ------------ ------------
v1.9.1.1.4977347.170426.0359          78292           56        78348
v1.2.0.4574253.130626.1248            62200        85232       147432
</code></pre>
<p>以下のコマンドで使用するシステムイメージを切り替えます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ set system image default-boot
</span></span></span><span class="line"><span class="cl"><span class="go">The system currently has the following image(s) installed:
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">v1.9.1.1.4977347.170426.0359   (default boot)
</span></span></span><span class="line"><span class="cl"><span class="go">v1.2.0.4574253.130626.1248     (running image)
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">A reboot is needed to boot default image
</span></span></span><span class="line"><span class="cl"><span class="go">Are you sure you want to switch images? (Yes/No) [Yes]: Yes
</span></span></span><span class="line"><span class="cl"><span class="go">Moving images...
</span></span></span><span class="line"><span class="cl"><span class="go">Done
</span></span></span><span class="line"><span class="cl"><span class="go">Switched from
</span></span></span><span class="line"><span class="cl"><span class="go">  Version:      v1.9.1.1.4977347.170426.0359
</span></span></span><span class="line"><span class="cl"><span class="go">to
</span></span></span><span class="line"><span class="cl"><span class="go">  Version:      v1.2.0.4574253.130626.1248
</span></span></span></code></pre></div><p>と思ったら、既に切り替わっていたのを戻してしまいました。再度実行して新しいバージョンに切り替えました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ set system image default-boot
</span></span></span><span class="line"><span class="cl"><span class="go">The system currently has the following image(s) installed:
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">v1.2.0.4574253.130626.1248     (running image) (default boot)
</span></span></span><span class="line"><span class="cl"><span class="go">v1.9.1.1.4977347.170426.0359
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Are you sure you want to switch images? (Yes/No) [Yes]: Yes
</span></span></span><span class="line"><span class="cl"><span class="go">Moving images...
</span></span></span><span class="line"><span class="cl"><span class="go">Done
</span></span></span><span class="line"><span class="cl"><span class="go">Switched from
</span></span></span><span class="line"><span class="cl"><span class="go">  Version:      v1.2.0.4574253.130626.1248
</span></span></span><span class="line"><span class="cl"><span class="go">to
</span></span></span><span class="line"><span class="cl"><span class="go">  Version:      v1.9.1.1.4977347.170426.0359
</span></span></span></code></pre></div><p><code>reboot</code> コマンドを実行して再起動します。<code>Proceed with reboot? [confirm]</code> と表示されたら <code>y</code> を押します。Enterは不要です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ reboot
</span></span></span><span class="line"><span class="cl"><span class="go">Proceed with reboot? [confirm]y
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Broadcast message from root@ubnt (pts/0) (Wed Jun  1 11:26:15 2011):
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">The system is going down for reboot NOW!
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Broadcast message from root@ubnt (pts/0) (Wed Jun  1 11:26:15 2011):
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">The system is going down for reboot NOW!
</span></span></span><span class="line"><span class="cl"><span class="go">ubnt@ubnt:~$ Connection to 192.168.1.1 closed by remote host.
</span></span></span><span class="line"><span class="cl"><span class="go">Connection to 192.168.1.1 closed.
</span></span></span></code></pre></div><p>再起動が終わったら Web UI を再度開き、画面左上でバージョンを確認すると無事に EdgeRouter Lite v1.9.1.1 となっていました。</p>
<h2 id="ファームウェアのアップデート情報">ファームウェアのアップデート情報</h2>
<p>ファームウェアのアップデート情報は <a href="https://community.ubnt.com/t5/EdgeMAX-Updates-Blog/bg-p/Blog_EdgeMAX">EdgeMAX Updates Blog - Ubiquiti Networks Community</a> を見れば良いそうです。</p>
<p>ページのソースを見ると <a href="https://community.ubnt.com/ubnt/rss/board?board.id=Blog_EdgeMAX">https://community.ubnt.com/ubnt/rss/board?board.id=Blog_EdgeMAX</a> にRSSフィードがありました。
ということでIFTTTでこのRSSフィードが来たらGmailで知らせるように設定してみました。</p>

</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KMMXGG2Z56', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
