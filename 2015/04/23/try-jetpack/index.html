<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>jetpackを試してみた</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">hnakamur's blog at github </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2015/04/23/try-jetpack/" rel="bookmark"
           title="Permalink to jetpackを試してみた">jetpackを試してみた</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-04-23T01:27:00+09:00">
                Published: 2015-04-23
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://hnakamur.github.io">Hiroaki Nakamura</a>
        </address>
<p>In <a href="../../../../category/blog.html">blog</a>.</p>
<p>tags: <a href="../../../../tag/jetpack.html">jetpack</a> </p>
</footer><!-- /.post-info -->      <h2>はじめに</h2>
<p><a href="https://github.com/3ofcoins/jetpack#using-jetpack">3ofcoins/jetpack</a>はFreeBSD, Jail, ZFSを使った<a href="https://github.com/appc/spec">App Container Spec</a>の実装です。まだプロトタイプレベルとのことです。Go言語で実装されています。</p>
<p>masterの最新を試しました。今後のためにコミットハッシュをメモしておきます。</p>
<div class="highlight"><pre><span></span><span class="nl">sunshine5</span><span class="p">:</span><span class="n">jetpack</span> <span class="n">hnakamur</span><span class="err">$</span> <span class="n">g</span> <span class="n">log</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">commit</span> <span class="mo">07</span><span class="mi">92</span><span class="n">b938c7f9bdd43f9d117bfdec6cd91e223ee5</span>
<span class="nl">Author</span><span class="p">:</span> <span class="n">Maciej</span> <span class="n">Pasternacki</span> <span class="o">&lt;</span><span class="n">maciej</span><span class="mi">@3</span><span class="n">ofcoins</span><span class="p">.</span><span class="n">net</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span>   <span class="n">Mon</span> <span class="n">Apr</span> <span class="mi">13</span> <span class="mo">06</span><span class="o">:</span><span class="mi">26</span><span class="o">:</span><span class="mi">57</span> <span class="mi">2015</span>

    <span class="n">Make</span> <span class="n">image</span> <span class="n">building</span> <span class="n">work</span> <span class="n">with</span> <span class="n">per</span><span class="o">-</span><span class="n">app</span> <span class="n">rootfs</span>
</pre></div>


<h2>セットアップ</h2>
<p>Vagrantfileが用意されているのでそれを使いました。
VirtualBox 4.3.26, Vagrant 1.7.2, OS X Yosemiteという環境で試しました。</p>
<p>VagrantのAnsibleプロビジョナを利用しているので、予めホスト側にAnsibleをセットアップしておいてください。</p>
<div class="highlight"><pre><span></span><span class="n">vagrant</span> <span class="n">up</span>
<span class="n">vagrant</span> <span class="n">ssh</span>
</pre></div>


<h2>Jetpackを使ってみる</h2>
<p><a href="https://github.com/3ofcoins/jetpack#using-jetpack">Using Jetpack</a>の説明にそって、試してみました。</p>
<p>引数無しで単に <code>jetpack</code> と実行すると説明が出ます。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">jetpack</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">jetpack</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span> <span class="n">COMMAND</span><span class="o">...</span>
<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">config</span><span class="o">=</span><span class="n">PATH</span>  <span class="n">Configuration</span> <span class="nb">file</span> <span class="p">(</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">jetpack</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>
  <span class="o">-</span><span class="n">help</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span>     <span class="n">Display</span> <span class="n">this</span> <span class="n">help</span> <span class="n">screen</span>
<span class="n">Commands</span><span class="p">:</span>
  <span class="n">help</span>                                    <span class="n">Display</span> <span class="n">this</span> <span class="n">help</span> <span class="n">screen</span>
  <span class="n">init</span>                                    <span class="n">Initialize</span> <span class="n">host</span>
  <span class="n">info</span>                                    <span class="n">Show</span> <span class="k">global</span> <span class="n">information</span>
  <span class="n">test</span>                                    <span class="n">Run</span> <span class="n">integration</span> <span class="n">tests</span>
  <span class="n">image</span> <span class="nb">list</span> <span class="p">[</span><span class="n">QUERY</span><span class="p">]</span>                      <span class="n">List</span> <span class="n">images</span>
  <span class="n">image</span> <span class="kn">import</span> <span class="nn">ARCHIVE</span> <span class="p">[</span><span class="n">MANIFEST</span><span class="p">]</span>         <span class="n">Import</span> <span class="n">image</span> <span class="kn">from</span> <span class="nn">an</span> <span class="nn">archive</span>
  <span class="n">image</span> <span class="n">IMAGE</span> <span class="n">build</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span> <span class="n">COMMAND</span><span class="o">...</span>  <span class="n">Build</span> <span class="n">new</span> <span class="n">image</span> <span class="kn">from</span> <span class="nn">an</span> <span class="nn">existing</span> <span class="nn">one</span>
                    <span class="o">-</span><span class="nb">dir</span><span class="o">=.</span>                <span class="n">Location</span> <span class="n">on</span> <span class="n">build</span> <span class="n">directory</span> <span class="n">on</span> <span class="n">host</span>
                    <span class="o">-</span><span class="n">cp</span><span class="o">=</span><span class="n">PATH</span><span class="o">...</span>           <span class="n">Copy</span> <span class="n">additional</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">host</span>
  <span class="n">image</span> <span class="n">IMAGE</span> <span class="n">show</span>                        <span class="n">Display</span> <span class="n">image</span> <span class="n">details</span>
  <span class="n">image</span> <span class="n">IMAGE</span> <span class="n">export</span> <span class="p">[</span><span class="n">PATH</span><span class="p">]</span>               <span class="n">Export</span> <span class="n">image</span> <span class="n">to</span> <span class="n">an</span> <span class="n">AMI</span> <span class="nb">file</span>
                                          <span class="n">Output</span> <span class="n">to</span> <span class="n">stdout</span> <span class="k">if</span> <span class="n">no</span> <span class="n">PATH</span> <span class="n">given</span>
  <span class="n">image</span> <span class="n">IMAGE</span> <span class="n">destroy</span>                     <span class="n">Destroy</span> <span class="n">image</span>
  <span class="n">pod</span> <span class="nb">list</span>                                <span class="n">List</span> <span class="n">pods</span>
  <span class="n">pod</span> <span class="n">create</span> <span class="p">[</span><span class="n">FLAGS</span><span class="p">]</span> <span class="n">IMAGE</span> <span class="p">[</span><span class="n">IMAGE</span> <span class="n">FLAGS</span><span class="p">]</span> <span class="p">[</span><span class="n">IMAGE</span> <span class="p">[</span><span class="n">IMAGE</span> <span class="n">FLAGS</span><span class="p">]</span> <span class="o">...</span><span class="p">]</span>
                                          <span class="n">Create</span> <span class="n">new</span> <span class="n">pod</span> <span class="kn">from</span> <span class="nn">image</span>
             <span class="o">-</span><span class="n">help</span>                        <span class="n">Show</span> <span class="n">detailed</span> <span class="n">help</span>
  <span class="n">pod</span> <span class="n">POD</span> <span class="n">show</span>                            <span class="n">Display</span> <span class="n">pod</span> <span class="n">details</span>
  <span class="n">pod</span> <span class="n">POD</span> <span class="n">run</span>                             <span class="n">Run</span> <span class="n">pod</span><span class="s1">&#39;s application</span>
  <span class="n">pod</span> <span class="n">POD</span> <span class="n">console</span> <span class="p">[</span><span class="n">USER</span><span class="p">]</span>                  <span class="n">Open</span> <span class="n">console</span> <span class="n">inside</span> <span class="n">the</span> <span class="n">pod</span>
  <span class="n">pod</span> <span class="n">POD</span> <span class="n">ps</span><span class="o">|</span><span class="n">top</span><span class="o">|</span><span class="n">killall</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="o">...</span><span class="p">]</span>
                                          <span class="n">Manage</span> <span class="n">pod</span><span class="s1">&#39;s processes</span>
  <span class="n">pod</span> <span class="n">POD</span> <span class="n">kill</span>                <span class="n">Kill</span> <span class="n">running</span> <span class="n">pod</span>
  <span class="n">pod</span> <span class="n">POD</span> <span class="n">destroy</span>             <span class="n">Destroy</span> <span class="n">pod</span>
<span class="n">Needs</span> <span class="n">Explanation</span><span class="p">:</span>
  <span class="n">ARCHIVE</span><span class="p">,</span> <span class="n">MANIFEST</span>  <span class="n">May</span> <span class="n">be</span> <span class="n">filesystem</span> <span class="n">paths</span> <span class="ow">or</span> <span class="n">URLs</span><span class="o">.</span>
            <span class="n">cp</span><span class="o">=</span><span class="n">PATH</span>  <span class="n">This</span> <span class="n">option</span> <span class="n">can</span> <span class="n">be</span> <span class="n">given</span> <span class="n">multiple</span> <span class="n">times</span>
              <span class="n">QUERY</span>  <span class="n">Is</span> <span class="n">an</span> <span class="n">expression</span> <span class="n">that</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
                      <span class="o">-</span> <span class="n">NAME</span><span class="p">[,</span><span class="n">LABEL</span><span class="o">=</span><span class="n">VALUE</span><span class="p">[,</span><span class="n">LABEL</span><span class="o">=</span><span class="n">VALUE</span><span class="p">[,</span><span class="o">...</span><span class="p">]]]</span>
                      <span class="o">-</span> <span class="n">NAME</span><span class="p">:</span><span class="n">VERSION</span> <span class="p">(</span><span class="n">alias</span> <span class="k">for</span> <span class="n">NAME</span><span class="p">:</span><span class="n">version</span><span class="o">=</span><span class="n">VERSION</span><span class="p">)</span>
              <span class="n">IMAGE</span>  <span class="n">Can</span> <span class="n">be</span><span class="p">:</span>
                      <span class="o">-</span> <span class="n">an</span> <span class="n">UUID</span> <span class="p">(</span><span class="n">XXXXXXXX</span><span class="o">-</span><span class="n">XXXX</span><span class="o">-</span><span class="n">XXXX</span><span class="o">-</span><span class="n">XXXX</span><span class="o">-</span><span class="n">XXXXXXXX</span><span class="p">),</span>
                      <span class="o">-</span> <span class="n">a</span> <span class="n">checksum</span> <span class="p">(</span><span class="n">sha512</span><span class="o">-...</span><span class="p">),</span> <span class="ow">or</span>
                      <span class="o">-</span> <span class="n">a</span> <span class="n">QUERY</span> <span class="p">(</span><span class="n">which</span> <span class="n">can</span><span class="s1">&#39;t be ambiguous).</span>
          <span class="n">POD</span>  <span class="n">Has</span> <span class="n">to</span> <span class="n">be</span> <span class="n">an</span> <span class="n">UUID</span> <span class="k">for</span> <span class="n">now</span>
<span class="n">Helpful</span> <span class="n">Aliases</span><span class="p">:</span>
  <span class="n">i</span><span class="o">|</span><span class="n">img</span> <span class="o">...</span> <span class="o">--</span> <span class="n">image</span> <span class="o">...</span>
  <span class="n">p</span> <span class="o">...</span> <span class="o">--</span> <span class="n">pod</span> <span class="o">...</span>
  <span class="n">image</span><span class="p">,</span> <span class="n">images</span> <span class="o">--</span> <span class="n">image</span> <span class="nb">list</span>
  <span class="n">pod</span><span class="p">,</span> <span class="n">pods</span> <span class="o">--</span> <span class="n">pod</span> <span class="nb">list</span>
  <span class="n">image</span> <span class="n">build</span><span class="o">|</span><span class="n">show</span><span class="o">|</span><span class="n">export</span><span class="o">|</span><span class="n">destroy</span> <span class="n">IMAGE</span> <span class="o">...</span> <span class="o">--</span> <span class="n">image</span> <span class="n">IMAGE</span> <span class="n">build</span><span class="o">|</span><span class="n">show</span><span class="o">|...</span> <span class="o">...</span>
</pre></div>


<p><code>jetpack init</code> でZFSのデータセットとディレクトリ構造を初期化します。が、これはプロビジョニングで実行済みだったようです。</p>
<div class="highlight"><pre><span></span>$ jetpack init
/vagrant/jetpack/host.go:82: Host already initialized
</pre></div>


<p><code>jetpack info</code> で状態を確認してみました。</p>
<div class="highlight"><pre><span></span>$ jetpack info
JetPack <span class="m">0</span>.0.1 <span class="o">(</span>v0.0.1-81-g0792b93<span class="o">)</span>, compiled on <span class="m">2015</span>-04-22T15:38:43Z
ZFS Dataset zroot/jetpack
  Mountpoint  /var/jetpack
Configuration:
  root.zfs                zroot/jetpack
  root.zfs.mountpoint     /var/jetpack
  images.ami.store        no
  images.ami.compression  xz
  images.zfs.atime        off
  images.zfs.compress     lz4
  jail.interface          lo1
  jail.namePrefix         jetpack/
  debug                   off
</pre></div>


<p><code>jetpack test</code> でスモークテストを実行してみましたが、一般ユーザでは権限不足でした。</p>
<div class="highlight"><pre><span></span>$ <span class="nv">jetpack</span> <span class="nv">test</span>
<span class="nv">ERROR</span>: <span class="nv">mkdir</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">test</span>.<span class="mi">881699652</span>: <span class="nv">permission</span> <span class="nv">denied</span>
<span class="nv">run</span>.<span class="nv">Command</span>[<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">libexec</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">test</span>.<span class="nv">integration</span> <span class="nv">dataset</span><span class="o">=</span><span class="nv">zroot</span><span class="o">/</span><span class="nv">jetpack</span>]: <span class="k">exit</span> <span class="nv">status</span> <span class="mi">2</span>
</pre></div>


<p>スモークテストという言葉は知らなかったのですが、本格的なテストの前の簡易テストという意味だそうです。</p>
<ul>
<li><a href="http://nolan00267.blogspot.jp/2013/12/itsmoke-test.html">ビジネス英語とアメリカ生活 | カリフォルニアの陽射しの中で: IT英語:　ソフトウェアの試験なのにSmoke Testとは、これいかに?</a></li>
<li><a href="http://www.itmedia.co.jp/im/articles/1111/07/news166.html">情報システム用語事典：スモークテスト（すもーくてすと） - ITmedia エンタープライズ</a></li>
</ul>
<p>sudoつきで実行すると、さっきよりは進みましたが <code>resolv.conf</code> が無いというエラーになってしまいました。</p>
<div class="highlight"><pre><span></span>$ <span class="nv">sudo</span> <span class="nv">jetpack</span> <span class="nv">test</span>
...<span class="ss">(</span><span class="nv">snip</span><span class="ss">)</span>...
<span class="nv">Pod</span> <span class="nv">dying</span> <span class="nv">since</span> <span class="mi">51</span>.<span class="mi">336704525</span><span class="nv">s</span>, <span class="nv">waiting</span>...
<span class="nv">Image</span> <span class="mi">6</span><span class="nv">d058709</span><span class="o">-</span><span class="nv">d7f9</span><span class="o">-</span><span class="mi">45</span><span class="nv">c5</span><span class="o">-</span><span class="nv">a40b</span><span class="o">-</span><span class="mi">0</span><span class="nv">f9a5c81a90b</span>
  <span class="nv">Hash</span>       <span class="nv">sha512</span><span class="o">-</span><span class="mi">3</span><span class="nv">d526a2a0e40605d1d5f50a6596f210ff26d7486867f12f4ffa395c3600028a01473c126c11b1030a4c299c82799b56a3493773d008743ae33f1230dc71384a1</span>
  <span class="nv">Origin</span>     <span class="nv">b73f4bf5</span><span class="o">-</span><span class="mi">8988</span><span class="o">-</span><span class="mi">4</span><span class="nv">e0f</span><span class="o">-</span><span class="mi">87</span><span class="nv">f4</span><span class="o">-</span><span class="mi">31723167</span><span class="nv">e2ef</span>
  <span class="nv">Timestamp</span>  <span class="mi">2015</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">16</span>:<span class="mi">24</span>:<span class="mi">15</span>.<span class="mi">597136136</span> <span class="o">+</span><span class="mi">0000</span> <span class="nv">UTC</span>
  <span class="nv">Manifest</span> <span class="nv">freebsd</span><span class="o">-</span><span class="nv">base</span>
    <span class="nv">Labels</span>
      <span class="nv">version</span>  <span class="mi">10</span>.<span class="mi">1</span>.<span class="mi">9</span>
      <span class="nv">os</span>       <span class="nv">freebsd</span>
      <span class="nv">arch</span>     <span class="nv">amd64</span>
    <span class="nv">Annotations</span>
      <span class="nv">timestamp</span>  <span class="mi">2015</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span><span class="nv">T16</span>:<span class="mi">24</span>:<span class="mi">15</span>.<span class="mi">595105431</span><span class="nv">Z</span>
<span class="nv">jetpack</span> <span class="nv">image</span> <span class="nv">freebsd</span><span class="o">-</span><span class="nv">base</span> <span class="nv">build</span> <span class="o">-</span><span class="nv">cp</span><span class="o">=/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">jetpack</span>.<span class="nv">image</span>.<span class="nv">mk</span>  <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">make</span> .<span class="nv">jetpack</span>.<span class="nv">build</span>.
<span class="nv">open</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">test</span>.<span class="mi">467360619</span><span class="o">/</span><span class="nv">pods</span><span class="o">/</span><span class="mi">4</span><span class="nv">c518b91</span><span class="o">-</span><span class="nv">afa8</span><span class="o">-</span><span class="mi">4</span><span class="nv">e28</span><span class="o">-</span><span class="mi">86</span><span class="nv">ca</span><span class="o">-</span><span class="mi">4</span><span class="nv">c4d0fedc313</span><span class="o">/</span><span class="nv">rootfs</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">resolv</span>.<span class="nv">conf</span>: <span class="nv">no</span> <span class="nv">such</span> <span class="nv">file</span> <span class="nv">or</span> <span class="nv">directory</span>
<span class="o">/</span><span class="nv">vagrant</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">pod</span>.<span class="nv">go</span>:<span class="mi">281</span>:
<span class="o">/</span><span class="nv">vagrant</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">pod</span>.<span class="nv">go</span>:<span class="mi">500</span>:
<span class="o">/</span><span class="nv">vagrant</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">pod</span>.<span class="nv">go</span>:<span class="mi">501</span>:
<span class="o">/</span><span class="nv">vagrant</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">image</span>.<span class="nv">go</span>:<span class="mi">331</span>:
<span class="o">***</span> <span class="nv">Error</span> <span class="nv">code</span> <span class="mi">1</span>

<span class="nv">Stop</span>.
<span class="nv">make</span>: <span class="nv">stopped</span> <span class="nv">in</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">examples</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">example</span>.<span class="nv">showenv</span>
<span class="nv">ERROR</span>: <span class="nv">run</span>.<span class="nv">Command</span>[<span class="nv">make</span> <span class="o">-</span><span class="nv">C</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">examples</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">example</span>.<span class="nv">showenv</span>]: <span class="k">exit</span> <span class="nv">status</span> <span class="mi">1</span>
<span class="nv">run</span>.<span class="nv">Command</span>[<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">libexec</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">test</span>.<span class="nv">integration</span> <span class="nv">dataset</span><span class="o">=</span><span class="nv">zroot</span><span class="o">/</span><span class="nv">jetpack</span>]: <span class="k">exit</span> <span class="nv">status</span> <span class="mi">2</span>
</pre></div>


<p>一旦置いておいて、先に進みます。</p>
<p>rootユーザで <code>/usr/local/share/examples/jetpack</code> 以下の <code>freebsd-base.release</code>, <code>freebsd-base</code>, <code>example.showenv</code> イメージを順に作成します。</p>
<p>まず <code>freebsd-base.release</code> イメージを作ります。</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">i</span>
<span class="n">root</span><span class="nd">@packer</span><span class="o">-</span><span class="n">freebsd</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="o">~</span> <span class="c1"># cd /usr/local/share/examples/jetpack</span>
<span class="n">root</span><span class="nd">@packer</span><span class="o">-</span><span class="n">freebsd</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jetpack</span> <span class="c1"># cd freebsd-base.release/</span>
<span class="n">root</span><span class="nd">@packer</span><span class="o">-</span><span class="n">freebsd</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">freebsd</span><span class="o">-</span><span class="n">base</span><span class="o">.</span><span class="n">release</span> <span class="c1"># make</span>
<span class="n">sha256</span> <span class="o">-</span><span class="n">c</span> <span class="mi">2</span><span class="n">b028a894d25711ad496762622a52d74b1e32ee04693ad1cf056e3ddcdc23975</span> <span class="n">base</span><span class="o">.</span><span class="n">txz</span>
<span class="n">SHA256</span> <span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">txz</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="n">b028a894d25711ad496762622a52d74b1e32ee04693ad1cf056e3ddcdc23975</span>
<span class="n">jetpack</span> <span class="n">image</span> <span class="kn">import</span> <span class="nn">base.txz</span> <span class="nn">manifest.json</span>
<span class="o">-</span>                                             <span class="mi">100</span><span class="o">%</span> <span class="n">of</span>   <span class="mi">63</span> <span class="n">MB</span> <span class="mi">6067</span> <span class="n">kBps</span> <span class="mo">00</span><span class="n">m11s</span>
<span class="o">-</span>                                             <span class="mi">100</span><span class="o">%</span> <span class="n">of</span>  <span class="mi">184</span>  <span class="n">B</span>  <span class="mi">519</span> <span class="n">kBps</span> <span class="mo">00</span><span class="n">m00s</span>
<span class="n">Image</span> <span class="mi">445</span><span class="n">da390</span><span class="o">-</span><span class="mf">2e49</span><span class="o">-</span><span class="mi">4</span><span class="n">b7f</span><span class="o">-</span><span class="mi">921</span><span class="n">d</span><span class="o">-</span><span class="mi">47</span><span class="n">ce6114cb02</span>
  <span class="n">Hash</span>       <span class="n">sha512</span><span class="o">-</span><span class="mf">3e5767</span><span class="n">bda2018294312cce0d0ef2003cf886af246cbbfe5050a266a94bdcfe9df94c9e73ef4452b487cf8bdc8279806e70aef75ea8f644d24223cf227bc75df8</span>
  <span class="n">Origin</span>     <span class="n">base</span><span class="o">.</span><span class="n">txz</span>
  <span class="n">Timestamp</span>  <span class="mi">2015</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">16</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">07.861508005</span> <span class="o">+</span><span class="mo">0000</span> <span class="n">UTC</span>
  <span class="n">Manifest</span> <span class="n">freebsd</span><span class="o">-</span><span class="n">base</span><span class="o">/</span><span class="n">release</span>
    <span class="n">Labels</span>
      <span class="n">version</span>  <span class="mf">10.1</span>
      <span class="n">os</span>       <span class="n">freebsd</span>
      <span class="n">arch</span>     <span class="n">amd64</span>
    <span class="n">Annotations</span>
      <span class="n">timestamp</span>  <span class="mi">2015</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">22</span><span class="n">T16</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">18.685140617</span><span class="n">Z</span>
</pre></div>


<p>次に <code>freebsd-base</code> イメージを作ります。</p>
<div class="highlight"><pre><span></span><span class="nv">root</span>@<span class="nv">packer</span><span class="o">-</span><span class="nv">freebsd</span><span class="o">-</span><span class="mi">10</span>:<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">examples</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">base</span>.<span class="nv">release</span> # <span class="nv">cd</span> ..<span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">base</span>
<span class="nv">root</span>@<span class="nv">packer</span><span class="o">-</span><span class="nv">freebsd</span><span class="o">-</span><span class="mi">10</span>:<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">examples</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">base</span> # <span class="nv">make</span>
<span class="nv">jetpack</span> <span class="nv">image</span> <span class="nv">freebsd</span><span class="o">-</span><span class="nv">base</span><span class="o">/</span><span class="nv">release</span> <span class="nv">build</span> <span class="o">-</span><span class="nv">cp</span><span class="o">=/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">share</span><span class="o">/</span><span class="nv">jetpack</span><span class="o">/</span><span class="nv">jetpack</span>.<span class="nv">image</span>.<span class="nv">mk</span>  <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">make</span> .<span class="nv">jetpack</span>.<span class="nv">build</span>.
<span class="nv">sed</span> <span class="o">-</span><span class="nv">i</span> <span class="s1">&#39;&#39;</span> <span class="s1">&#39;</span><span class="s">s|^Components.*|Components world/base|</span><span class="s1">&#39;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span>.<span class="nv">conf</span>
<span class="nv">install</span> <span class="o">-</span><span class="nv">v</span> <span class="o">-</span><span class="nv">m</span> <span class="mi">0644</span> <span class="nv">rc</span>.<span class="nv">conf</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">conf</span>
<span class="nv">install</span>: <span class="nv">rc</span>.<span class="nv">conf</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">conf</span>
<span class="nv">install</span> <span class="o">-</span><span class="nv">v</span> <span class="o">-</span><span class="nv">m</span> <span class="mi">0600</span> <span class="nv">entropy</span> <span class="o">/</span><span class="nv">entropy</span>
<span class="nv">install</span>: <span class="nv">entropy</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="nv">entropy</span>
<span class="nv">patch</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span> <span class="o">&lt;</span> <span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span>.<span class="nv">patch</span>
<span class="nv">Hmm</span>...  <span class="nv">Looks</span> <span class="nv">like</span> <span class="nv">a</span> <span class="nv">unified</span> <span class="nv">diff</span> <span class="nv">to</span> <span class="nv">me</span>...
<span class="nv">The</span> <span class="nv">text</span> <span class="nv">leading</span> <span class="nv">up</span> <span class="nv">to</span> <span class="nv">this</span> <span class="nv">was</span>:
<span class="o">--------------------------</span>
<span class="o">|---</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span>   <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">22</span>:<span class="mi">15</span>:<span class="mi">58</span>.<span class="mi">178818000</span> <span class="o">+</span><span class="mi">0100</span>
<span class="o">|+++</span> <span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">09</span> <span class="mi">13</span>:<span class="mi">45</span>:<span class="mi">42</span>.<span class="mi">202917000</span> <span class="o">+</span><span class="mi">0100</span>
<span class="o">--------------------------</span>
<span class="nv">Patching</span> <span class="nv">file</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span> <span class="nv">using</span> <span class="nv">Plan</span> <span class="nv">A</span>...
<span class="nv">Hunk</span> <span class="sc">#1</span> <span class="nv">succeeded</span> <span class="nv">at</span> <span class="mi">610</span> <span class="ss">(</span><span class="nv">offset</span> <span class="o">-</span><span class="mi">8</span> <span class="nv">lines</span><span class="ss">)</span>.
<span class="nv">done</span>
<span class="nv">env</span> <span class="nv">PAGER</span><span class="o">=</span><span class="nv">cat</span> <span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">update6</span>.<span class="nv">freebsd</span>.<span class="nv">org</span> <span class="nv">fetch</span> <span class="nv">install</span>
<span class="nv">Looking</span> <span class="nv">up</span> <span class="nv">update6</span>.<span class="nv">freebsd</span>.<span class="nv">org</span> <span class="nv">mirrors</span>... <span class="nv">none</span> <span class="nv">found</span>.
<span class="nv">Fetching</span> <span class="nv">public</span> <span class="nv">key</span> <span class="nv">from</span> <span class="nv">update6</span>.<span class="nv">freebsd</span>.<span class="nv">org</span>... <span class="nv">done</span>.
<span class="nv">Fetching</span> <span class="nv">metadata</span> <span class="nv">signature</span> <span class="k">for</span> <span class="mi">10</span>.<span class="mi">1</span><span class="o">-</span><span class="nv">RELEASE</span> <span class="nv">from</span> <span class="nv">update6</span>.<span class="nv">freebsd</span>.<span class="nv">org</span>... <span class="nv">done</span>.
<span class="nv">Fetching</span> <span class="nv">metadata</span> <span class="nv">index</span>... <span class="nv">done</span>.
<span class="nv">Fetching</span> <span class="mi">2</span> <span class="nv">metadata</span> <span class="nv">files</span>... <span class="nv">done</span>.
<span class="nv">Inspecting</span> <span class="nv">system</span>... <span class="nv">done</span>.
<span class="nv">Preparing</span> <span class="nv">to</span> <span class="nv">download</span> <span class="nv">files</span>... <span class="nv">done</span>.
<span class="nv">Fetching</span> <span class="mi">706</span> <span class="nv">patches</span>.....<span class="mi">10</span>....<span class="mi">20</span>....<span class="mi">30</span>....<span class="mi">40</span>....<span class="mi">50</span>....<span class="mi">60</span>....<span class="mi">70</span>....<span class="mi">80</span>....<span class="mi">90</span>....<span class="mi">100</span>....<span class="mi">110</span>....<span class="mi">120</span>....<span class="mi">130</span>....<span class="mi">140</span>....<span class="mi">150</span>....<span class="mi">160</span>....<span class="mi">170</span>....<span class="mi">180</span>....<span class="mi">190</span>....<span class="mi">200</span>....<span class="mi">210</span>....<span class="mi">220</span>....<span class="mi">230</span>....<span class="mi">240</span>....<span class="mi">250</span>....<span class="mi">260</span>....<span class="mi">270</span>....<span class="mi">280</span>....<span class="mi">290</span>....<span class="mi">300</span>....<span class="mi">310</span>....<span class="mi">320</span>....<span class="mi">330</span>....<span class="mi">340</span>....<span class="mi">350</span>....<span class="mi">360</span>....<span class="mi">370</span>....<span class="mi">380</span>....<span class="mi">390</span>....<span class="mi">400</span>....<span class="mi">410</span>....<span class="mi">420</span>....<span class="mi">430</span>....<span class="mi">440</span>....<span class="mi">450</span>....<span class="mi">460</span>....<span class="mi">470</span>....<span class="mi">480</span>....<span class="mi">490</span>....<span class="mi">500</span>....<span class="mi">510</span>....<span class="mi">520</span>....<span class="mi">530</span>....<span class="mi">540</span>....<span class="mi">550</span>....<span class="mi">560</span>....<span class="mi">570</span>....<span class="mi">580</span>....<span class="mi">590</span>....<span class="mi">600</span>....<span class="mi">610</span>....<span class="mi">620</span>....<span class="mi">630</span>....<span class="mi">640</span>....<span class="mi">650</span>....<span class="mi">660</span>....<span class="mi">670</span>....<span class="mi">680</span>....<span class="mi">690</span>....<span class="mi">700</span>... <span class="nv">done</span>.
<span class="nv">Applying</span> <span class="nv">patches</span>... <span class="nv">done</span>.
<span class="nv">Fetching</span> <span class="mi">1</span> <span class="nv">files</span>... <span class="nv">done</span>.

<span class="nv">The</span> <span class="nv">following</span> <span class="nv">files</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">updated</span> <span class="nv">as</span> <span class="nv">part</span> <span class="nv">of</span> <span class="nv">updating</span> <span class="nv">to</span> <span class="mi">10</span>.<span class="mi">1</span><span class="o">-</span><span class="nv">RELEASE</span><span class="o">-</span><span class="nv">p9</span>:
<span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">version</span>
<span class="o">/</span><span class="nv">boot</span><span class="o">/</span><span class="nv">boot1</span>.<span class="nv">efi</span>
<span class="o">/</span><span class="nv">boot</span><span class="o">/</span><span class="nv">boot1</span>.<span class="nv">efifat</span>
...<span class="ss">(</span>略<span class="ss">)</span>...
<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">db</span><span class="o">/</span><span class="nv">mergemaster</span>.<span class="nv">mtree</span>
<span class="nv">Installing</span> <span class="nv">updates</span>... <span class="nv">done</span>.
<span class="nv">rm</span> <span class="o">-</span><span class="nv">rf</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">db</span><span class="o">/</span><span class="nv">freebsd</span><span class="o">-</span><span class="nv">update</span><span class="cm">/*</span>
<span class="cm">./manifest.json.sh &gt; manifest.json</span>
<span class="cm">Pod dying since 64.761583ms, waiting...</span>
<span class="cm">...(略)...</span>
<span class="cm">Pod dying since 51.461102458s, waiting...</span>
<span class="cm">Image 9323ac42-0f39-4f42-90de-ac4de60420dd</span>
<span class="cm">  Hash       sha512-3fb309e4d9a998bd910ce07dbfcef447508ea2146fabd88056975abc224d49094b3ff22c61c6c3aae170ee5e69bff72c43fb6e1153ae4f68607246cb50cc4d3d</span>
<span class="cm">  Origin     445da390-2e49-4b7f-921d-47ce6114cb02</span>
<span class="cm">  Timestamp  2015-04-22 16:38:35.737407036 +0000 UTC</span>
<span class="cm">  Manifest freebsd-base</span>
<span class="cm">    Labels</span>
<span class="cm">      version  10.1.9</span>
<span class="cm">      os       freebsd</span>
<span class="cm">      arch     amd64</span>
<span class="cm">    Annotations</span>
</pre></div>


<p>次に <code>freebsd-base</code> イメージを作ります。</p>
<div class="highlight"><pre><span></span><span class="n">root</span><span class="nv">@packer</span><span class="o">-</span><span class="n">freebsd</span><span class="o">-</span><span class="mi">10</span><span class="err">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">freebsd</span><span class="o">-</span><span class="n">base</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="n">example</span><span class="p">.</span><span class="n">showenv</span><span class="o">/</span><span class="w"></span>
<span class="n">root</span><span class="nv">@packer</span><span class="o">-</span><span class="n">freebsd</span><span class="o">-</span><span class="mi">10</span><span class="err">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">example</span><span class="p">.</span><span class="n">showenv</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">make</span><span class="w"></span>
<span class="n">jetpack</span><span class="w"> </span><span class="nc">image</span><span class="w"> </span><span class="n">freebsd</span><span class="o">-</span><span class="n">base</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">cp</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">jetpack</span><span class="p">.</span><span class="nc">image</span><span class="p">.</span><span class="n">mk</span><span class="w">  </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">make</span><span class="w"> </span><span class="p">.</span><span class="n">jetpack</span><span class="p">.</span><span class="n">build</span><span class="p">.</span><span class="w"></span>
<span class="k">open</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">pods</span><span class="o">/</span><span class="n">eaa0ec11</span><span class="o">-</span><span class="n">a7ad</span><span class="o">-</span><span class="mi">4170</span><span class="o">-</span><span class="n">ac30</span><span class="o">-</span><span class="mi">472444</span><span class="n">b9f849</span><span class="o">/</span><span class="n">rootfs</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">resolv</span><span class="p">.</span><span class="nl">conf</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">directory</span><span class="w"></span>
<span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">pod</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">281</span><span class="err">:</span><span class="w"></span>
<span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">pod</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">500</span><span class="err">:</span><span class="w"></span>
<span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">pod</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">501</span><span class="err">:</span><span class="w"></span>
<span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="nc">image</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">331</span><span class="err">:</span><span class="w"></span>
<span class="o">***</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="n">Stop</span><span class="p">.</span><span class="w"></span>
<span class="nl">make</span><span class="p">:</span><span class="w"> </span><span class="n">stopped</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jetpack</span><span class="o">/</span><span class="n">example</span><span class="p">.</span><span class="n">showenv</span><span class="w"></span>
</pre></div>


<p>スモークテストの時と同じエラーが出ました。
とりあえず今回はここまでとします。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a custom version based on <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53263855-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>