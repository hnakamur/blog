<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.111.2">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>GeForce搭載の旧モデルMacBook ProでCUDAをセットアップする手順のメモ &middot; hnakamur&#39;s blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/copy-button.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hnakamur.github.io/blog/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://hnakamur.github.io/blog/favicon.png">

  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMMXGG2Z56"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMMXGG2Z56');
</script>



</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog</h1></a>
      <p class="lead">
       my tech memo 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://hnakamur.github.io/blog/"> blog home </a></li><li><a href="https://github.com/hnakamur"> github @hnakamur </a></li><li><a href="https://twitter.com/hnakamur2"> twitter @hnakamur2 </a></li>
      </ul>
    </nav>

    <p>powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://pages.github.com/">GitHub Pages</a></p>
    <p>&copy; 2023. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>GeForce搭載の旧モデルMacBook ProでCUDAをセットアップする手順のメモ</h1>
  <time datetime=2015-07-25T17:37:59&#43;0900 class="post-date">2015-07-25</time>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#cudaドライバのインストールとアップデート">CUDAドライバのインストールとアップデート</a></li>
    <li><a href="#cudaツールキットのインストール">CUDAツールキットのインストール</a>
      <ul>
        <li><a href="#cudaツールキット用の環境変数設定">CUDAツールキット用の環境変数設定</a></li>
        <li><a href="#統合gpuではなくgeforceを使うように切り替える設定">統合GPUではなくGeForceを使うように切り替える設定</a></li>
      </ul>
    </li>
    <li><a href="#cudaのサンプルを試す">CUDAのサンプルを試す</a></li>
  </ul>
</nav>
  <h2 id="はじめに">はじめに</h2>
<p><a href="http://www.apple.com/jp/macbook-pro/specs-retina/">MacBook Pro現行モデルの技術仕様</a>を見ると最上位機種のグラフィックスチップはIntel Iris Pro GraphicsとAMD Radeon R9 M370Xとなっており、NVIDIA GeForceは搭載されていません。</p>
<p>ですが、<a href="https://support.apple.com/kb/SP694?locale=ja_JP&amp;viewlocale=ja_JP">MacBook Pro (15-inch, Mid 2012) - 技術仕様</a>を見ると、私が持っているMacBook Proは15インチ2.6GHzモデルなのでNVIDIA GeForce GT 650M、1GB GDDR5メモリが搭載されています。</p>
<p><a href="http://www.nvidia.co.jp/object/geforce-gt-650m-jp.html#pdpContent=2">GeForce GT 650M | NVIDIA</a>には「プログラミング環境」の行に「CUDA」とあるのでCUDAが使えるようです。</p>
<p>ということでCUDAを試してみたので、手順をメモしておきます。試した時のOS Xのバージョンは10.10.4、Xcodeのバージョンは6.4です。</p>
<h2 id="cudaドライバのインストールとアップデート">CUDAドライバのインストールとアップデート</h2>
<p>後述のCUDAツールキットのインストール中の画面にCUDAドライバも含まれているような記述があったので、この手順は不要かもしれません。が、今回はそれを知らずに先にCUDAドライバを単体でインストールしたので、一応書いておきます。</p>
<p><a href="http://www.nvidia.co.jp/object/mac-driver-archive-jp.html">MAC アーカイブ用CUDA ドライバ | NVIDIA</a>から最新のドライバをダウンロード、インストールします。</p>
<p><a href="http://www.nvidia.co.jp/object/macosx-cuda-7.0.36-driver-jp.html">NVIDIA DRIVERS 7.0.36</a>の「リリースハイライト」によると、[システム環境設定]→[CUDA]でインストール済みのCUDAドライバのバージョンと最新バージョンの確認が出来て、アップデートもできるそうです。</p>
<p>早速確認してみると、インストール済みのCUDA Driver Versionは7.0.29となっており、CUDA 7.0.52 Driver update is availableと表示されていました。</p>
<p>7.0.36のドライバを単体でインストールしたのに7.0.29になっているのは後述のCUDAツールキットのインストールで上書きされたのだと思われます。ついでなので、[Install CUDA Update]ボタンを押してアップデートしておきました。</p>
<h2 id="cudaツールキットのインストール">CUDAツールキットのインストール</h2>
<p><a href="http://docs.nvidia.com/cuda/index.html#axzz3gt2fIbGh">CUDA Toolkit Documentation</a>のページから<a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#axzz3gt2fIbGh">Getting Started Mac OS X</a>に進み、<a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#installation">3. Installation</a>を参考にCUDAツールキットをインストールしました。</p>
<p><a href="https://developer.nvidia.com/cuda-downloads">CUDA 7 Downloads</a>で[Mac OSX]のタブに切り替えてインストーラをダウンロードします。最初Network Installerを試したのですが、ダウンロードしたdmgファイルを開いてCUDAMacOSXInstallerをダブルクリックしたら「“CUDAMacOSXInstaller”はこわれているため開けません。」というエラーが出たので、Local Installer (977MB)を試したら、こちらは無事インストール出来ました。</p>
<p>その後、cuFFT Patchをダウンロードして、<a href="http://developer.download.nvidia.com/compute/cuda/7_0/Prod/cufft_update/README_mac.txt">README</a>を参考にターミナルで以下のコマンドを実行してパッチを適用しました。</p>
<pre tabindex="0"><code>sudo tar zxf ~/Downloads/cufft_patch_mac.tar.gz -C /Developer/NVIDIA/CUDA-7.0
</code></pre><h3 id="cudaツールキット用の環境変数設定">CUDAツールキット用の環境変数設定</h3>
<p><a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#axzz3gt2fIbGh">Getting Started Mac OS X</a>の<a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#install">3.2. Install</a>で環境変数 <code>PATH</code> と <code>DYLD_LIBRARY_PATH</code> の設定方法が書いてあるのですが、この通りだとあとでPyCUDAをインストールするときに <code>-lcuda</code> が見つからずリンクエラーになりました。</p>
<p>検索してみると<a href="https://code.google.com/p/pyrit/issues/detail?id=248">Issue 248 - pyrit - Build script can&rsquo;t find CUDA library directory on OS X. - WPA/WPA2-PSK and a world of affordable many-core platforms - Google Project Hosting</a> で <code>/usr/local/cuda</code> というディレクトリがあることを知り、<code>/usr/local/cuda/lib</code> と <code>/Developer/NVIDIA/CUDA-7.0/lib</code> の中身を見てみると <code>libcuda.dylib</code> だけは前者にしか無いことが判明しました。</p>
<p>結局以下のように設定する必要がありました (bash以外の場合は適宜変更してください)。</p>
<pre tabindex="0"><code>echo &lt;&lt;&#39;EOF&#39; &gt;&gt; ~/.bash_profile
# CUDA
export CUDA_ROOT=/usr/local/cuda
export PATH=$CUDA_ROOT/bin:$PATH
export DYLD_LIBRARY_PATH=$CUDA_ROOT/lib:$PATH
EOF
</code></pre><p>設定ファイルを書き換えたら以下のコマンドでシェルを再起動して設定を読み込んでおきます。</p>
<pre tabindex="0"><code>exec $SHELL -l
</code></pre><h3 id="統合gpuではなくgeforceを使うように切り替える設定">統合GPUではなくGeForceを使うように切り替える設定</h3>
<p><a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#axzz3gt2fIbGh">Getting Started Mac OS X</a>の<a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#install">3.2. Install</a>の説明に従って、以下のように設定しました。</p>
<ul>
<li>[システム環境設定]→[省エネルギー]を開きます</li>
<li>[グラフィックスの自動切り替え]のチェックを外します</li>
<li>電源アダプタに繋いでいる場合は[電源アダプタ]、繋いでいない場合は[バッテリー]を選びます</li>
<li>[コンピュータのスリープ]のスライダーを[しない]に調節します。</li>
</ul>
<h2 id="cudaのサンプルを試す">CUDAのサンプルを試す</h2>
<p><a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#axzz3gt2fIbGh">Getting Started Mac OS X</a>の<a href="http://docs.nvidia.com/cuda/cuda-getting-started-guide-for-mac-os-x/index.html#install">3.2. Install</a>の説明に従って、 <code>cuda-install-samples-7.0.sh</code> を使ってサンプルプログラムを取得して試してみました。</p>
<p><code>~/sandbox/cuda</code> という作業用のディレクトリを作って以下の手順で試しました。 <code>cuda-install-samples-7.0.sh</code> はインストール先のディレクトリを引数で指定する必要がありました。</p>
<pre tabindex="0"><code>mkdir -p ~/sandbox/cuda
cd !$
cuda-install-samples-7.0.sh .
</code></pre><p>実行すると <code>NVIDIA_CUDA-7.0_Samples</code> というディレクトリが作成され、配下にサンプルプログラムのソースファイルが展開されていました。</p>
<p>そのうちの1つ <code>asyncAPI</code> というのを試してみました。以下の手順でビルドします。</p>
<pre tabindex="0"><code>cd NVIDIA_CUDA-7.0_Samples/0_Simple/asyncAPI
make
</code></pre><p>実行してみました。</p>
<pre tabindex="0"><code>$ ../../bin/x86_64/darwin/release/asyncAPI
[../../bin/x86_64/darwin/release/asyncAPI] - Starting...
GPU Device 0: &#34;GeForce GT 650M&#34; with compute capability 3.0

CUDA device [GeForce GT 650M]
time spent executing by the GPU: 99.45
time spent by CPU in CUDA calls: 0.05
CPU executed 583004 iterations while waiting for GPU to finish
</code></pre><p>動きました！</p>

</div>


<script src="https://hnakamur.github.io/blog/js/copy-button.js"></script>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-KMMXGG2Z56', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
