<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-JP" lang="ja-JP">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.61.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>GoのMessagePackのライブラリのベンチマークをしてみた &middot; hnakamur&#39;s blog at github</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://hnakamur.github.io/blog/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://hnakamur.github.io/blog/"><h1>hnakamur&#39;s blog at github</h1></a>
      <p class="lead">
       my tech memo 
      </p>
      <p>powered by <a href="http://gohugo.io">Hugo</a></p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>GoのMessagePackのライブラリのベンチマークをしてみた</h1>
  <time datetime=2016-06-04T22:17:52&#43;0900 class="post-date">2016-06-04</time>
  <p><a href="http://qiita.com/yosisa/items/f21d3476bc8d368d7494">Go の msgpack ライブラリ比較 - Qiita</a>の記事が最終更新日から1年以上経過しているとのことなので、現在の最新のコミットで試してみました。</p>
<p><code>github.com/vmihailenco/msgpack</code> を <code>go get</code> すると</p>
<pre><code>$ go get github.com/vmihailenco/msgpack
package github.com/vmihailenco/msgpack: code in directory /home/hnakamur/gocode/src/github.com/vmihailenco/msgpack expects import &quot;gopkg.in/vmihailenco/msgpack.v2&quot;
</code></pre><p>と言われたので <code>go get gopkg.in/vmihailenco/msgpack.v2</code> で取得し、この記事のコードの <code>&quot;github.com/vmihailenco/msgpack&quot;</code> を <code>&quot;gopkg.in/vmihailenco/msgpack.v2&quot;</code> に書き換え <code>msgpack_test.go</code> という名前で保存して試しました。</p>
<p>エンコードは <code>gopkg.in/vmihailenco/msgpack.v2</code> 、デコードは <code>github.com/ugorji/go/codec</code> が速いという結果になりましたが、総合的にはほぼ同等と言えると思います。</p>
<pre><code>$ go test -bench . -benchmem
testing: warning: no tests to run
PASS
BenchmarkCodecEncode-2            500000              3236 ns/op              48 B/op          2 allocs/op
BenchmarkCodecDecode-2            200000              8998 ns/op             264 B/op         25 allocs/op
BenchmarkMsgpackEncode-2          500000              2624 ns/op              48 B/op          2 allocs/op
BenchmarkMsgpackDecode-2          200000             10604 ns/op             448 B/op         35 allocs/op
ok      bitbucket.org/hnakamur/msgpack_experiment       7.146s
</code></pre><p>ベンチマークに使用したライブラリとGoのバージョンは以下の通りです。</p>
<pre><code>$ git -C $GOPATH/src/github.com/ugorji/go rev-parse HEAD
a396ed22fc049df733440d90efe17475e3929ccb
$ git -C $GOPATH/src/gopkg.in/vmihailenco/msgpack.v2 rev-parse HEAD
851cd631b60599a692b136c60eb6eb2899b0e664
$ go version
go version go1.6.2 linux/amd64
</code></pre><p><a href="https://github.com/vmihailenco/msgpack">vmihailenco/msgpack: MessagePack encoding for Golang</a>のベンチマークもやってみました。</p>
<pre><code>$ go test -bench . -benchmem                                          
2016/06/04 22:12:13 
************************************************ 
package github.com/ugorji/go-msgpack has been deprecated (05/29/2013). 
It will be retired anytime from July 1, 2013.
Please update to faster and much much better github.com/ugorji/go/codec.
See https://github.com/ugorji/go/tree/master/codec#readme for more information.
************************************************ 
OK: 27 passed, 1 skipped
PASS
BenchmarkBool-2                         20000000                90.3 ns/op             0 B/op          0 allocs/op
BenchmarkInt0-2                         20000000                96.1 ns/op             0 B/op          0 allocs/op
BenchmarkInt1-2                         10000000               123 ns/op               0 B/op          0 allocs/op
BenchmarkInt2-2                         10000000               123 ns/op               0 B/op          0 allocs/op
BenchmarkInt4-2                         10000000               179 ns/op               0 B/op          0 allocs/op
BenchmarkInt8-2                         10000000               176 ns/op               0 B/op          0 allocs/op
BenchmarkInt0Binary-2                    5000000               340 ns/op              24 B/op          3 allocs/op
BenchmarkInt0UgorjiGoMsgpack-2           3000000               586 ns/op               8 B/op          1 allocs/op
BenchmarkInt0UgorjiGoCodec-2             5000000               360 ns/op               0 B/op          0 allocs/op
BenchmarkTime-2                          5000000               353 ns/op               0 B/op          0 allocs/op
BenchmarkDuration-2                     10000000               180 ns/op               0 B/op          0 allocs/op
BenchmarkByteSlice-2                     1000000              1021 ns/op            1024 B/op          1 allocs/op
BenchmarkByteArray-2                      500000              2741 ns/op            2112 B/op          4 allocs/op
BenchmarkByteSliceUgorjiGoCodec-2        2000000               647 ns/op               0 B/op          0 allocs/op
BenchmarkByteArrayUgorjiGoCodec-2        1000000              2632 ns/op            1088 B/op          3 allocs/op
BenchmarkMapStringString-2               1000000              1898 ns/op              16 B/op          4 allocs/op
BenchmarkMapStringStringPtr-2             500000              2461 ns/op              32 B/op          5 allocs/op
BenchmarkMapStringStringUgorjiGoCodec-2  1000000              1737 ns/op              16 B/op          4 allocs/op
BenchmarkMapIntInt-2                      500000              3424 ns/op             208 B/op         10 allocs/op
BenchmarkStringSlice-2                   3000000               530 ns/op              10 B/op          2 allocs/op
BenchmarkStringSlicePtr-2                1000000              1270 ns/op              26 B/op          3 allocs/op
BenchmarkStructVmihailencoMsgpack-2       100000             12732 ns/op            3152 B/op         27 allocs/op
BenchmarkStructMarshal-2                  300000              6003 ns/op            1808 B/op          8 allocs/op
BenchmarkStructUnmarshal-2                200000              5788 ns/op            1344 B/op         19 allocs/op
BenchmarkStructManual-2                   200000              6610 ns/op            2720 B/op         21 allocs/op
BenchmarkStructUgorjiGoMsgpack-2          100000             17138 ns/op            3616 B/op         70 allocs/op
BenchmarkStructUgorjiGoCodec-2            100000             21833 ns/op            7345 B/op         23 allocs/op
BenchmarkStructJSON-2                      20000             63809 ns/op            7896 B/op         26 allocs/op
BenchmarkStructGOB-2                       20000             96275 ns/op           14664 B/op        278 allocs/op
BenchmarkStructUnmarshalPartially-2       300000              5791 ns/op            2272 B/op         12 allocs/op
BenchmarkCSV-2                            200000              6971 ns/op            8748 B/op         12 allocs/op
BenchmarkCSVMsgpack-2                    1000000              1541 ns/op             384 B/op         13 allocs/op
ok      gopkg.in/vmihailenco/msgpack.v2 58.623s
</code></pre><h2 id="gopkginvmihailencomsgpackv2-gostruct">gopkg.in/vmihailenco/msgpack.v2 でGoのstructをエンコード・デコードするインターフェース</h2>
<p><a href="https://godoc.org/gopkg.in/vmihailenco/msgpack.v2#Marshaler">Marshaler</a> はdeprecatedで<a href="https://godoc.org/gopkg.in/vmihailenco/msgpack.v2#CustomEncoder">CustomEncoder</a>を使えとのことです。<a href="https://godoc.org/gopkg.in/vmihailenco/msgpack.v2#CustomEncoder">CustomEncoder</a> の Example を見ると使い方も簡単そうです。</p>
<h2 id="gopkginvmihailencomsgpackv2-">gopkg.in/vmihailenco/msgpack.v2 を使うことにします</h2>
<p><a href="https://github.com/vmihailenco/msgpack">github.com/vmihailenco/msgpack</a>も<a href="https://github.com/ugorji/go/tree/master/codec">go/codec at master · ugorji/go</a>も活発にメンテナンスされているようです。</p>
<p>APIドキュメント <a href="https://godoc.org/gopkg.in/vmihailenco/msgpack.v2">gopkg.in/vmihailenco/msgpack.v2</a>、<a href="https://godoc.org/github.com/ugorji/go/codec">github.com/ugorji/go/codec</a> を見ると私は前者のほうがしっくりきました。ということで gopkg.in/vmihailenco/msgpack.v2 を使うことにします。</p>

</div>


    </main>

    
  </body>
</html>
